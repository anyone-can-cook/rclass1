<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">

<title>Joining data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="join_data_files/libs/clipboard/clipboard.min.js"></script>
<script src="join_data_files/libs/quarto-html/quarto.js"></script>
<script src="join_data_files/libs/quarto-html/popper.min.js"></script>
<script src="join_data_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="join_data_files/libs/quarto-html/anchor.min.js"></script>
<link href="join_data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="join_data_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="join_data_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="join_data_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="join_data_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="join_data_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="join_data_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#libraries-and-datasets-we-will-use" id="toc-libraries-and-datasets-we-will-use" class="nav-link" data-scroll-target="#libraries-and-datasets-we-will-use"><span class="header-section-number">1.1</span> Libraries and datasets we will use</a></li>
  <li><a href="#lecture-overview" id="toc-lecture-overview" class="nav-link" data-scroll-target="#lecture-overview"><span class="header-section-number">1.2</span> Lecture overview</a></li>
  <li><a href="#nls72-data" id="toc-nls72-data" class="nav-link" data-scroll-target="#nls72-data"><span class="header-section-number">1.3</span> NLS72 data</a></li>
  <li><a href="#relational-databases-and-tables" id="toc-relational-databases-and-tables" class="nav-link" data-scroll-target="#relational-databases-and-tables"><span class="header-section-number">1.4</span> Relational databases and tables</a></li>
  </ul></li>
  <li><a href="#keys" id="toc-keys" class="nav-link" data-scroll-target="#keys"><span class="header-section-number">2</span> Keys</a>
  <ul class="collapse">
  <li><a href="#primary-keys" id="toc-primary-keys" class="nav-link" data-scroll-target="#primary-keys"><span class="header-section-number">2.1</span> Primary keys</a>
  <ul class="collapse">
  <li><a href="#student-exercise" id="toc-student-exercise" class="nav-link" data-scroll-target="#student-exercise"><span class="header-section-number">2.1.1</span> Student exercise</a></li>
  </ul></li>
  <li><a href="#foreign-keys" id="toc-foreign-keys" class="nav-link" data-scroll-target="#foreign-keys"><span class="header-section-number">2.2</span> Foreign keys</a>
  <ul class="collapse">
  <li><a href="#student-exercise-1" id="toc-student-exercise-1" class="nav-link" data-scroll-target="#student-exercise-1"><span class="header-section-number">2.2.1</span> Student exercise</a></li>
  </ul></li>
  <li><a href="#requirements-for-joining-two-tables" id="toc-requirements-for-joining-two-tables" class="nav-link" data-scroll-target="#requirements-for-joining-two-tables"><span class="header-section-number">2.3</span> Requirements for joining two tables</a></li>
  </ul></li>
  <li><a href="#mutating-joins" id="toc-mutating-joins" class="nav-link" data-scroll-target="#mutating-joins"><span class="header-section-number">3</span> Mutating joins</a>
  <ul class="collapse">
  <li><a href="#inner-joins" id="toc-inner-joins" class="nav-link" data-scroll-target="#inner-joins"><span class="header-section-number">3.1</span> Inner joins</a>
  <ul class="collapse">
  <li><a href="#duplicate-keys" id="toc-duplicate-keys" class="nav-link" data-scroll-target="#duplicate-keys"><span class="header-section-number">3.1.1</span> Duplicate keys</a></li>
  <li><a href="#joining-by-multiple-variables" id="toc-joining-by-multiple-variables" class="nav-link" data-scroll-target="#joining-by-multiple-variables"><span class="header-section-number">3.1.2</span> Joining by multiple variables</a></li>
  </ul></li>
  <li><a href="#outer-joins" id="toc-outer-joins" class="nav-link" data-scroll-target="#outer-joins"><span class="header-section-number">3.2</span> Outer joins</a></li>
  </ul></li>
  <li><a href="#filtering-joins" id="toc-filtering-joins" class="nav-link" data-scroll-target="#filtering-joins"><span class="header-section-number">4</span> Filtering joins</a></li>
  <li><a href="#appending-data" id="toc-appending-data" class="nav-link" data-scroll-target="#appending-data"><span class="header-section-number">5</span> Appending data</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix"><span class="header-section-number">6</span> Appendix</a>
  <ul class="collapse">
  <li><a href="#troubleshooting-join-problems" id="toc-troubleshooting-join-problems" class="nav-link" data-scroll-target="#troubleshooting-join-problems"><span class="header-section-number">6.1</span> Troubleshooting join problems</a></li>
  <li><a href="#how-to-think-about-different-types-of-joins-and-perform-one" id="toc-how-to-think-about-different-types-of-joins-and-perform-one" class="nav-link" data-scroll-target="#how-to-think-about-different-types-of-joins-and-perform-one"><span class="header-section-number">6.2</span> How to think about different types of joins and perform one</a>
  <ul class="collapse">
  <li><a href="#types-of-joins" id="toc-types-of-joins" class="nav-link" data-scroll-target="#types-of-joins"><span class="header-section-number">6.2.1</span> Types of joins</a></li>
  <li><a href="#deciding-on-x-and-y-table-in-a-join" id="toc-deciding-on-x-and-y-table-in-a-join" class="nav-link" data-scroll-target="#deciding-on-x-and-y-table-in-a-join"><span class="header-section-number">6.2.2</span> Deciding on <code>x</code> and <code>y</code> table in a join</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Joining data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<section id="libraries-and-datasets-we-will-use" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="libraries-and-datasets-we-will-use"><span class="header-section-number">1.1</span> Libraries and datasets we will use</h2>
<p>Load packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(labelled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> Load datasets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NLS student level data, containing variables about student demographics</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>nls_stu <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">'https://github.com/anyone-can-cook/rclass1/raw/master/data/nls72/nls72stu_percontor_vars.dta'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, schcode, bysex, csex, crace, cbirthm, cbirthd, cbirthyr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># NLS student level data, containing variables about postsecondary education transcripts (PETS)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>nls_stu_pets <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">'https://github.com/ozanj/rclass/raw/master/data/nls72/nls72petsstu_v2.dta'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, reqtrans, numtrans)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># NLS student-transcript level data</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>nls_tran <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">'https://github.com/ozanj/rclass/raw/master/data/nls72/nls72petstrn_v2.dta'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, transnum, findisp, trnsflag, terms, fice, state, cofcon, instype, itype)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># NLS student-transcript-term level data</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>nls_term <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">'https://github.com/ozanj/rclass/raw/master/data/nls72/nls72petstrm_v2.dta'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, transnum, termnum, courses, termtype, season, sortdate, gradcode, transfer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lecture-overview" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="lecture-overview"><span class="header-section-number">1.2</span> Lecture overview</h2>
<p>It is rare for an analysis dataset to consist of data from only one input dataset. For most projects, each analysis dataset contains data from multiple data sources. Therefore, you must become proficient in combining data from multiple data sources.</p>
<p>Two broad topics:</p>
<ol type="1">
<li><strong>Joining</strong> datasets [big topic]
<ul>
<li>Combine two datasets so that the resulting dataset has additional variables</li>
<li>The term “join” comes from the relational databases world; Social science research often uses the term “merge” rather than “join”</li>
</ul></li>
<li><strong>Appending</strong> datasets [small topic]
<ul>
<li>Stack datasets on top of one another so that resulting dataset has more observations, but (typically) the same number of variables</li>
<li>Often, longitudinal datasets are created by appending datasets</li>
</ul></li>
</ol>
<p>Wickham differentiates between <em>mutating joins</em> and <em>filtering joins</em>:</p>
<ul>
<li><strong>Mutating joins</strong> “add new variables to one data frame from matching observations in another”</li>
<li><strong>Filtering joins</strong> “filter observations from one data frame based on whether or not they match an observation in the other table”
<ul>
<li>Doesn’t add new variables</li>
<li>Usually, purpose is to check the quality of mutating joins (e.g., which observations didn’t match)</li>
</ul></li>
</ul>
<p>Our main focus today is on <em>mutating joins</em>. But <em>filtering joins</em> are useful for data quality checks of <em>mutating joins</em>.</p>
</section>
<section id="nls72-data" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="nls72-data"><span class="header-section-number">1.3</span> NLS72 data</h2>
<p>The datasets used for this lecture comes from the <strong>National Longitudinal Survey of 1972 (NLS72)</strong>:</p>
<ul>
<li>Student level data</li>
<li>Student-transcript level data</li>
<li>Student-transcript-term level data</li>
</ul>
<p>These datasets are good for teaching “joining” because you get practice joining data sources with different “observational levels” (e.g., join student level and student-transcript level data)</p>
<p><br></p>
<details>
<summary>
<strong>Investigating student level <code>nls_stu</code> dataframe</strong>
</summary>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">schcode</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">bysex</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">csex</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">crace</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cbirthm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cbirthd</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cbirthyr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">18</td>
<td style="text-align: right;">3000</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">53</td>
</tr>
<tr class="even">
<td style="text-align: right;">67</td>
<td style="text-align: right;">3000</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">53</td>
</tr>
<tr class="odd">
<td style="text-align: right;">83</td>
<td style="text-align: right;">2518</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="even">
<td style="text-align: right;">174</td>
<td style="text-align: right;">2911</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="odd">
<td style="text-align: right;">190</td>
<td style="text-align: right;">800</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">55</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a feel for the data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(nls_stu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "id"       "schcode"  "bysex"    "csex"     "crace"    "cbirthm"  "cbirthd" 
#&gt; [8] "cbirthyr"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(nls_stu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 22,652
#&gt; Columns: 8
#&gt; $ id       &lt;dbl&gt; 18, 67, 83, 174, 190, 232, 315, 380, 414, 430, 497, 521, 554,…
#&gt; $ schcode  &lt;dbl&gt; 3000, 3000, 2518, 2911, 800, 7507, 3000, 9516, 2518, 2701, 28…
#&gt; $ bysex    &lt;dbl+lbl&gt;  2,  1,  2,  1,  2,  2,  1,  1,  1,  1, 99,  1,  1,  2,  …
#&gt; $ csex     &lt;dbl+lbl&gt; 1, 1, 2, 1, 2, 2, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 2, 1, …
#&gt; $ crace    &lt;dbl+lbl&gt; 4, 2, 7, 7, 7, 7, 7, 7, 7, 4, 7, 7, 7, 7, 7, 7, 7, 7, 7, …
#&gt; $ cbirthm  &lt;dbl&gt; 12, 10, 3, 5, 1, 7, 3, 10, 9, 4, 6, 2, 5, 1, 10, 5, 9, 8, 12,…
#&gt; $ cbirthd  &lt;dbl&gt; 9, 14, 10, 11, 5, 8, 1, 24, 3, 17, 11, 13, 28, 24, 9, 24, 20,…
#&gt; $ cbirthyr &lt;dbl&gt; 53, 53, 54, 54, 55, 54, 54, 53, 53, 54, 54, 54, 54, 54, 54, 5…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>nls_stu <span class="sc">%&gt;%</span> <span class="fu">var_label</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $id
#&gt; [1] "unique school code of high school student attended"
#&gt; 
#&gt; $schcode
#&gt; [1] "SCHOOL CODE"
#&gt; 
#&gt; $bysex
#&gt; [1] "SEX OF STUDENT FROM BASE YEAR INSTRUMENT"
#&gt; 
#&gt; $csex
#&gt; [1] "CSEX - SEX OF RESPONDENT"
#&gt; 
#&gt; $crace
#&gt; [1] "RACE COMPOSITE"
#&gt; 
#&gt; $cbirthm
#&gt; [1] "COMPOSITE BIRTH MONTH"
#&gt; 
#&gt; $cbirthd
#&gt; [1] "COMPOSITE BIRTH DAY"
#&gt; 
#&gt; $cbirthyr
#&gt; [1] "COMPOSITE BIRTH YEAR"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can investigate individual variables (e.g., bysex variable)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(nls_stu<span class="sc">$</span>bysex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "haven_labelled" "vctrs_vctr"     "double"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(nls_stu<span class="sc">$</span>bysex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  dbl+lbl [1:22652]  2,  1,  2,  1,  2,  2,  1,  1,  1,  1, 99,  1,  1,  2, ...
#&gt;  @ label       : chr "SEX OF STUDENT FROM BASE YEAR INSTRUMENT"
#&gt;  @ format.stata: chr "%23.0g"
#&gt;  @ labels      : Named num [1:4] 1 2 98 99
#&gt;   ..- attr(*, "names")= chr [1:4] "1. male" "2. female" "98. {ILLEGITIMATE SKIP}" "99. {LEGITIMATE SKIP}"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>nls_stu <span class="sc">%&gt;%</span> <span class="fu">select</span>(bysex) <span class="sc">%&gt;%</span> <span class="fu">var_label</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $bysex
#&gt; [1] "SEX OF STUDENT FROM BASE YEAR INSTRUMENT"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>nls_stu <span class="sc">%&gt;%</span> <span class="fu">select</span>(bysex) <span class="sc">%&gt;%</span> <span class="fu">val_labels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $bysex
#&gt;                 1. male               2. female 98. {ILLEGITIMATE SKIP} 
#&gt;                       1                       2                      98 
#&gt;   99. {LEGITIMATE SKIP} 
#&gt;                      99</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>nls_stu <span class="sc">%&gt;%</span> <span class="fu">count</span>(bysex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 4 × 2
#&gt;   bysex                            n
#&gt;   &lt;dbl+lbl&gt;                    &lt;int&gt;
#&gt; 1  1 [1. male]                  8208
#&gt; 2  2 [2. female]                8340
#&gt; 3 98 [98. {ILLEGITIMATE SKIP}]   135
#&gt; 4 99 [99. {LEGITIMATE SKIP}]    5969</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>nls_stu <span class="sc">%&gt;%</span> <span class="fu">count</span>(bysex) <span class="sc">%&gt;%</span> <span class="fu">as_factor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 4 × 2
#&gt;   bysex                       n
#&gt;   &lt;fct&gt;                   &lt;int&gt;
#&gt; 1 1. male                  8208
#&gt; 2 2. female                8340
#&gt; 3 98. {ILLEGITIMATE SKIP}   135
#&gt; 4 99. {LEGITIMATE SKIP}    5969</code></pre>
</div>
</div>
</details>
<p><br></p>
<details>
<summary>
<strong>Investigating student level <code>nls_stu_pets</code> dataframe</strong>
</summary>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">reqtrans</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numtrans</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">18</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">67</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">83</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">315</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">414</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(nls_stu_pets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "id"       "reqtrans" "numtrans"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(nls_stu_pets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 14,759
#&gt; Columns: 3
#&gt; $ id       &lt;dbl&gt; 18, 67, 83, 315, 414, 430, 802, 836, 935, 1040, 1057, 1099, 1…
#&gt; $ reqtrans &lt;dbl&gt; 1, 1, 1, 2, 1, 1, 2, 2, 3, 2, 1, 3, 1, 2, 1, 3, 2, 3, 1, 1, 1…
#&gt; $ numtrans &lt;dbl&gt; 0, 1, 0, 2, 0, 0, 1, 1, 2, 2, 1, 1, 1, 2, 1, 0, 2, 3, 1, 1, 1…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>nls_stu_pets <span class="sc">%&gt;%</span> <span class="fu">var_label</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $id
#&gt; [1] "unique student identification variable"
#&gt; 
#&gt; $reqtrans
#&gt; [1] "NUMBER OF TRANSCRIPTS REQUESTED"
#&gt; 
#&gt; $numtrans
#&gt; [1] "NUMBER OF TRANSCRIPTS RECEIVED"</code></pre>
</div>
</div>
</details>
<p><br></p>
<details>
<summary>
<strong>Investigating student-transcript level <code>nls_tran</code> dataframe</strong>
</summary>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">transnum</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">findisp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">trnsflag</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">terms</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">fice</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">state</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cofcon</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">instype</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">itype</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">18</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">1009</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">67</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">5694</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">83</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">1166</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">315</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1009</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">315</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1057</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(nls_tran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "id"       "transnum" "findisp"  "trnsflag" "terms"    "fice"    
#&gt;  [7] "state"    "cofcon"   "instype"  "itype"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(nls_tran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 24,253
#&gt; Columns: 10
#&gt; $ id       &lt;dbl&gt; 18, 67, 83, 315, 315, 414, 430, 802, 802, 836, 836, 935, 935,…
#&gt; $ transnum &lt;dbl&gt; 1, 1, 1, 1, 2, 1, 1, 1, 2, 1, 2, 1, 2, 3, 1, 2, 1, 1, 2, 3, 1…
#&gt; $ findisp  &lt;dbl+lbl&gt; 6, 1, 3, 1, 1, 3, 4, 1, 2, 4, 1, 1, 1, 3, 1, 1, 1, 4, 4, …
#&gt; $ trnsflag &lt;dbl+lbl&gt; 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, …
#&gt; $ terms    &lt;dbl&gt; 99, 8, 99, 20, 1, 99, 99, 2, 99, 99, 6, 11, 6, 99, 1, 10, 8, …
#&gt; $ fice     &lt;dbl&gt; 1009, 5694, 1166, 1009, 1057, 1166, 2089, 2865, 3687, 1666, 2…
#&gt; $ state    &lt;dbl&gt; 1, 1, 5, 1, 1, 5, 21, 33, 46, 14, 23, 15, 23, 15, 5, 33, 11, …
#&gt; $ cofcon   &lt;dbl+lbl&gt; 6, 2, 4, 6, 6, 4, 4, 4, 3, 5, 3, 5, 6, 1, 6, 5, 6, 4, 4, …
#&gt; $ instype  &lt;dbl+lbl&gt; 3, 1, 4, 3, 3, 4, 4, 4, 2, 2, 2, 2, 3, 1, 3, 2, 3, 4, 4, …
#&gt; $ itype    &lt;dbl+lbl&gt; 1, 5, 4, 1, 2, 4, 4, 4, 3, 6, 4, 2, 2, 5, 1, 1, 2, 4, 4, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>nls_tran <span class="sc">%&gt;%</span> <span class="fu">var_label</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $id
#&gt; [1] "unique student identification variable"
#&gt; 
#&gt; $transnum
#&gt; [1] "TRANSCRIPT NUMBER"
#&gt; 
#&gt; $findisp
#&gt; [1] "FINAL DISPOSITION"
#&gt; 
#&gt; $trnsflag
#&gt; [1] "TRANSCRIPT FLAG"
#&gt; 
#&gt; $terms
#&gt; [1] "NUMBER OF TERMS ON THIS TRANSCRIPT"
#&gt; 
#&gt; $fice
#&gt; [1] "POSTSECONDARY INSTITUTION ID CODE"
#&gt; 
#&gt; $state
#&gt; [1] "state"
#&gt; 
#&gt; $cofcon
#&gt; [1] "OFFERING &amp; CONTROL"
#&gt; 
#&gt; $instype
#&gt; [1] "INSTITUTION TYPE"
#&gt; 
#&gt; $itype
#&gt; [1] "INSTITUTION TYPE"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>nls_tran <span class="sc">%&gt;%</span> <span class="fu">val_labels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $id
#&gt; NULL
#&gt; 
#&gt; $transnum
#&gt; NULL
#&gt; 
#&gt; $findisp
#&gt;      1. TRANSCRIPT RECEIVED           2. SCHOOL REFUSED 
#&gt;                           1                           2 
#&gt;   3. STUDENT NEVER ATTENDED 4. SCHOOL LOST OR DESTROYED 
#&gt;                           3                           4 
#&gt;            5. SCHOOL CLOSED  6. NO RESPONSE FROM SCHOOL 
#&gt;                           5                           6 
#&gt; 
#&gt; $trnsflag
#&gt;     0. DUMMY TRANSCRIPT 1. REQUESTED &amp; RECEIVED 
#&gt;                       0                       1 
#&gt; 
#&gt; $terms
#&gt; NULL
#&gt; 
#&gt; $fice
#&gt; NULL
#&gt; 
#&gt; $state
#&gt; NULL
#&gt; 
#&gt; $cofcon
#&gt;          1. proprietary      2. PUBLIC &lt; 2-YEAR 3. PRIVATE NFP &lt; 4-YEAR 
#&gt;                       1                       2                       3 
#&gt;        4. PUBLIC 2-YEAR   5. PRIVATE NFP 4-YEAR        6. PUBLIC 4-YEAR 
#&gt;                       4                       5                       6 
#&gt; 
#&gt; $instype
#&gt;   1. proprietary   2. PRIVATE NFP 3. PUBLIC 4-YEAR 4. PUBLIC 2-YEAR 
#&gt;                1                2                3                4 
#&gt;       5. foreign 
#&gt;                5 
#&gt; 
#&gt; $itype
#&gt;   1. Research &amp; Doctoral         2. Comprehensive          3. Liberal Arts 
#&gt;                        1                        2                        3 
#&gt;                4. 2-year      5. Less than 2-year           6. Specialized 
#&gt;                        4                        5                        6 
#&gt; 8. Special comprehensive 
#&gt;                        8</code></pre>
</div>
</div>
</details>
<p><br></p>
<details>
<summary>
<strong>Investigating student-transcript-term level <code>nls_term</code> dataframe</strong>
</summary>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">transnum</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">termnum</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">courses</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">termtype</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sortdate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gradcode</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">transfer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">67</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8101</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">67</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">8104</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">67</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8109</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">67</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8201</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">67</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">8204</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(nls_term)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "id"       "transnum" "termnum"  "courses"  "termtype" "season"   "sortdate"
#&gt; [8] "gradcode" "transfer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(nls_term)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 120,885
#&gt; Columns: 9
#&gt; $ id       &lt;dbl&gt; 67, 67, 67, 67, 67, 67, 67, 67, 315, 315, 315, 315, 315, 315,…
#&gt; $ transnum &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
#&gt; $ termnum  &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12…
#&gt; $ courses  &lt;dbl&gt; 3, 2, 2, 2, 2, 2, 2, 2, 4, 3, 5, 4, 4, 4, 4, 5, 1, 4, 5, 5, 5…
#&gt; $ termtype &lt;dbl+lbl&gt; 4, 4, 4, 4, 4, 4, 4, 4, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, …
#&gt; $ season   &lt;dbl+lbl&gt; 2, 3, 1, 2, 3, 4, 1, 2, 1, 2, 3, 2, 3, 1, 2, 3, 1, 2, 4, …
#&gt; $ sortdate &lt;dbl&gt; 8101, 8104, 8109, 8201, 8204, 8207, 8209, 8301, 7209, 7301, 7…
#&gt; $ gradcode &lt;dbl+lbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
#&gt; $ transfer &lt;dbl+lbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>nls_term <span class="sc">%&gt;%</span> <span class="fu">var_label</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $id
#&gt; [1] "unique student identification variable"
#&gt; 
#&gt; $transnum
#&gt; [1] "TRANSCRIPT NUMBER"
#&gt; 
#&gt; $termnum
#&gt; [1] "TERM NUMBER"
#&gt; 
#&gt; $courses
#&gt; [1] "NUMBER OF COURSES TERM"
#&gt; 
#&gt; $termtype
#&gt; [1] "TYPE OF TERM"
#&gt; 
#&gt; $season
#&gt; [1] "SEASON OF TERM"
#&gt; 
#&gt; $sortdate
#&gt; [1] "DATE OF TERM"
#&gt; 
#&gt; $gradcode
#&gt; [1] "GRADE SCALE TYPE"
#&gt; 
#&gt; $transfer
#&gt; [1] "TRANSFER COURSES FLAG"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>nls_term <span class="sc">%&gt;%</span> <span class="fu">val_labels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $id
#&gt; NULL
#&gt; 
#&gt; $transnum
#&gt; NULL
#&gt; 
#&gt; $termnum
#&gt; NULL
#&gt; 
#&gt; $courses
#&gt; NULL
#&gt; 
#&gt; $termtype
#&gt; 1. VARIABLE LENGTH OR NONCOURSE TERM                          2. semester 
#&gt;                                    1                                    2 
#&gt;                         3. trimester                           4. quarter 
#&gt;                                    3                                    4 
#&gt;             5. CREDIT BY EXAMINATION                         7. {UNKNOWN} 
#&gt;                                    5                                    7 
#&gt; 
#&gt; $season
#&gt;      1. fall    2. winter    3. spring    4. summer 9. {MISSING} 
#&gt;            1            2            3            4            9 
#&gt; 
#&gt; $sortdate
#&gt; NULL
#&gt; 
#&gt; $gradcode
#&gt;  1. LETTER GRADES 2. NUMERIC GRADES 
#&gt;                 1                 2 
#&gt; 
#&gt; $transfer
#&gt;  0. NOT TRANSFER 1. TRANSFER TERM 
#&gt;                0                1</code></pre>
</div>
</div>
</details>
</section>
<section id="relational-databases-and-tables" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="relational-databases-and-tables"><span class="header-section-number">1.4</span> Relational databases and tables</h2>
<p><strong>Traditionally, social scientists store data in “flat files”</strong></p>
<ul>
<li>Flat files are “rectangular” datasets consisting of columns (usually called variables) and rows (usually called observations)</li>
<li>When we want to incorporate variables from two flat files, we “merge” them together</li>
</ul>
<p><strong>The rest of the world stores data in “relational databases”</strong></p>
<ul>
<li>A relational database consists of multiple <strong>tables</strong></li>
<li>Each table is a flat file</li>
<li>A goal of relational databases is to store data using the minimum possible space; therefore, a rule is to never duplicate information across tables</li>
<li>When you need information from multiple tables, you “join” (the database term for “merge”) tables “on the fly” rather than creating some permanent flat file that contains data from multiple tables</li>
<li>Each table in a relational database has a different “observational level”
<ul>
<li>For example, NLS72 has a student level table, a student-transcript level table, etc.</li>
<li>From the perspective of a database person, it wouldn’t make sense to store student level variables (e.g., birth-date) on the student-transcript level table because student birth-date does not vary by transcript, so this would result in needless duplication of data</li>
</ul></li>
<li>Structured Query Language (SQL) is the universally-used programming language for relational databases</li>
</ul>
<p><strong>Real-world examples of relational databases</strong></p>
<ul>
<li>iTunes
<ul>
<li>Behind the scenes, there are separate tables for artist, album, song, genre, etc.</li>
<li>The “library” you see as a user is the result of “on the fly” joins of these tables</li>
</ul></li>
<li>Every social media app (e.g., Twitter, FB, Instagram) you use is a relational database
<ul>
<li>What you see as a user is the result of “on the fly” joins of individual tables running in the background</li>
</ul></li>
<li>Interactive maps typically have relational databases running in the background
<ul>
<li>Clicking on some part of the map triggers a join of tables and you see the result of some analysis based on that join</li>
<li>E.g., our <a href="https://map.emraresearch.org/">off-campus recruiting map</a></li>
</ul></li>
</ul>
<p><strong>Should you think of combining dataframes in R as “merging” flat files or “joining” tables of a relational database?</strong></p>
<ul>
<li>Can think of it either way; but I think better to think of it <em>both</em> ways</li>
<li>For example, you can think of the NLS72 datasets as:
<ul>
<li>A bunch of flat files that we merge</li>
<li>OR a set of tables that comprise a relational database</li>
</ul></li>
<li>Although we are combining flat files, tidyverse uses the terminology (e.g, “keys”, “join”) of relational databases for doing so</li>
</ul>
</section>
</section>
<section id="keys" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Keys</h1>
<p>What are <strong>keys</strong>?</p>
<ul>
<li><strong>Keys</strong> are “the variables used to connect each pair of tables” [<a href="https://r4ds.had.co.nz/relational-data.html#keys">see here</a>]</li>
<li>Even though relational databases often consist of many tables, <strong>relations</strong> are always defined between a <strong>pair</strong> of tables</li>
<li>When joining tables, focus on joining <strong>one</strong> table to <strong>another</strong>; you make this “join” using the <strong>key variable(s)</strong> that define the relationship between these two tables</li>
<li>Even when your analysis requires variables from more than two tables, you proceed by joining one pair of tables at a time</li>
</ul>
<p><br> There are two types of keys: <strong>primary keys</strong> and <strong>foreign keys</strong></p>
<ul>
<li>“The main reason for primary and foreign keys is to enforce data consistency” [<a href="https://stackoverflow.com/a/5771337/6373540">see here</a>]</li>
<li>Although primary and foreign keys do not technically need to be defined in order to perform a join, they are important for maintaining database integrity</li>
</ul>
<section id="primary-keys" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="primary-keys"><span class="header-section-number">2.1</span> Primary keys</h2>
<p>What is a <strong>primary key</strong>?</p>
<ul>
<li>A <strong>primary key</strong> uniquely identifies an observation in its own table</li>
<li>It is a variable (or combination of variables) in a table that uniquely identifies observations in its own table</li>
</ul>
<p><br> <strong>Example</strong>: <code>id</code> is the primary key in the <code>nls_stu</code> table</p>
<p>The variable <code>id</code> (“unique student identification variable”) <em>uniquely</em> identifies observations in the dataset <code>nls_stu</code>. In other words, no two observations in <code>nls_stu</code> have the same value of <code>id</code>.</p>
<p>Let’s confirm that each value of <code>id</code> is associated with only one observation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>nls_stu <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span>  <span class="co"># group by primary key</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_per_id=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span>  <span class="co"># create a measure of number of observations per group</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span>  <span class="co"># ungroup, otherwise frequency table [next step] created separately for each group</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_per_id)  <span class="co"># frequency of number of observations per group</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_id     n
#&gt;      &lt;int&gt; &lt;int&gt;
#&gt; 1        1 22652</code></pre>
</div>
</div>
<p>An alternative way to confirm that no values of <code>id</code> have more than one observation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>nls_stu <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(id) <span class="sc">%&gt;%</span>  <span class="co"># create object that counts the number of obs for each value of id</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n<span class="sc">&gt;</span><span class="dv">1</span>)  <span class="co"># keep only rows where count of obs per id is greater than 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 0 × 2
#&gt; # ℹ 2 variables: id &lt;dbl&gt;, n &lt;int&gt;</code></pre>
</div>
</div>
<p><br> <strong>Example</strong>: <code>id</code> and <code>transnum</code> make up the primary key in the <code>nls_tran</code> table</p>
<p>Sometimes, more than one variable is required to make up the primary key in a table. For example, in the student-transcript level table <code>nls_tran</code>, both <code>id</code> and <code>transnum</code> are needed to uniquely identify the observations in the table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>nls_tran <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id, transnum) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_per_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_key     n
#&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1         1 24253</code></pre>
</div>
</div>
<section id="student-exercise" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="student-exercise"><span class="header-section-number">2.1.1</span> Student exercise</h3>
<p>Which variable(s) make up the primary key in the <code>nls_term</code> table?</p>
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>The variables <code>id</code>, <code>transnum</code>, and <code>termnum</code> make up the primary key for the <code>nls_term</code> table because these variables together uniquely identify each observation in the table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>nls_term <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id, transnum, termnum) <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_per_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_key      n
#&gt;       &lt;int&gt;  &lt;int&gt;
#&gt; 1         1 120885</code></pre>
</div>
</div>
</details>
</section>
</section>
<section id="foreign-keys" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="foreign-keys"><span class="header-section-number">2.2</span> Foreign keys</h2>
<p>What is a <strong>foreign key</strong>?</p>
<ul>
<li>A <strong>foreign key</strong> uniquely identifies an observation in another table</li>
<li>Said differently, it is a variable (or combination of variables) in a table that is the primary key in another table</li>
<li>A foreign key creates a relationship between two tables</li>
</ul>
<p><br> <strong>Example</strong>: With respect to datasets <code>nls_stu</code> and <code>nls_tran</code></p>
<ul>
<li>Recall that the student <code>id</code> is the <em>primary key</em> in <code>nls_stu</code> because it uniquely identifies each observation in the table.</li>
<li>The variable <code>nls_tran$id</code> is the <em>foreign key</em> for <code>nls_stu</code> because it uniquely identifies observations in <code>nls_stu</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>nls_tran <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> ungroup <span class="sc">%&gt;%</span> <span class="fu">count</span>(n_per_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 7 × 2
#&gt;   n_per_key     n
#&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1         1  8022
#&gt; 2         2  4558
#&gt; 3         3  1681
#&gt; 4         4   415
#&gt; 5         5    71
#&gt; 6         6     6
#&gt; 7         7     3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>nls_stu <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> ungroup <span class="sc">%&gt;%</span> <span class="fu">count</span>(n_per_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_key     n
#&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1         1 22652</code></pre>
</div>
</div>
<p><br></p>
<details>
<summary>
<strong>Ozan’s way of thinking about foreign key</strong>
</summary>
<p>Personally, I find the concept <strong>foreign key</strong> a little bit slippery. Here is how I wrap my head around it:</p>
<ul>
<li>First, always remember that “joins” happen between two specific tables, so have two specific tables in mind</li>
<li>Second, to understand <em>foreign key</em> concept, I think of a “focal table” [my term] (e.g., <code>nls_tran</code>) and some “other table” (e.g., <code>nls_stu</code>)</li>
<li>Third, then, the foreign key is a variable (or combination of variables) that satisfies two conditions:
<ol type="1">
<li>Exists in the “focal table” (but may or may not be the primary key for the focal table)</li>
<li>Exists in the “other table” <strong>AND</strong> is the primary key for that “other table”</li>
</ol></li>
</ul>
<p><strong>Example of foreign key</strong></p>
<ul>
<li>With respect to the “focal table” <code>nls_tran</code> and the “other table” <code>nls_stu</code>, the variable <code>id</code> is the <em>foreign key</em> because:
<ul>
<li><code>id</code> exists in the “focal table” <code>nls_trans</code> (though it does not uniquely identifies observations in <code>nls_trans</code>)</li>
<li><code>id</code> exists in the “other table” <code>nls_stu</code> and <code>id</code> uniquely identifies observations in <code>nls_stu</code></li>
</ul></li>
</ul>
</details>
<section id="student-exercise-1" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="student-exercise-1"><span class="header-section-number">2.2.1</span> Student exercise</h3>
<p>With respect to <code>nls_trans</code>, which variable(s) make up the foreign key in the <code>nls_term</code> table?</p>
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>Since <code>id</code> and <code>transnum</code> make up the <em>primary key</em> in the <code>nls_trans</code> table, these variables make up the <em>foreign key</em> in <code>nls_term</code> because they can be used to link the two tables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># id and transnum make up the primary key in nls_trans because they uniquely identify each obs</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>nls_tran <span class="sc">%&gt;%</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id, transnum) <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_per_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_key     n
#&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1         1 24253</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># id and transnum also both exist in nls_term, so they form the foreign key that links the 2 tables</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(nls_term)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] "id"       "transnum" "termnum"  "courses"  "termtype" "season"   "sortdate"
#&gt; [8] "gradcode" "transfer"</code></pre>
</div>
</div>
</details>
</section>
</section>
<section id="requirements-for-joining-two-tables" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="requirements-for-joining-two-tables"><span class="header-section-number">2.3</span> Requirements for joining two tables</h2>
<p>In practice, you join two tables without explicit thinking about “primary key” vs.&nbsp;“foreign key” and “focal table” vs.&nbsp;“other table”</p>
<ul>
<li>Doesn’t matter which data frame you “start with” (e.g., as the “focal table”)</li>
</ul>
<p>The only requirements for joining are:</p>
<ol type="1">
<li>One of the two data frames have a <strong>primary key</strong> (variable or combination of variables that uniquely identify observations) <strong>AND</strong></li>
<li>That variable or combination of variables is available in the other of the two data frames</li>
</ol>
<p>With this in mind, let’s examine the dataframes <code>nls_stu</code> and <code>nls_tran</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># requirement 1: at least one of the two data frames must have a primary key</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># let's check if id is the primary key in nls_stu</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>nls_stu <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> ungroup <span class="sc">%&gt;%</span> <span class="fu">count</span>(n_per_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_key     n
#&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1         1 22652</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># requirement 2: that primary key (id) is available in the other of the two data frames</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(nls_tran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "id"       "transnum" "findisp"  "trnsflag" "terms"    "fice"    
#&gt;  [7] "state"    "cofcon"   "instype"  "itype"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>nls_tran <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(id, transnum) <span class="sc">%&gt;%</span> <span class="fu">select</span>(id,transnum,findisp,itype) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 20 × 4
#&gt;       id transnum findisp                         itype                     
#&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl+lbl&gt;                       &lt;dbl+lbl&gt;                 
#&gt;  1    18        1 6 [6. NO RESPONSE FROM SCHOOL]  1 [1. Research &amp; Doctoral]
#&gt;  2    67        1 1 [1. TRANSCRIPT RECEIVED]      5 [5. Less than 2-year]   
#&gt;  3    83        1 3 [3. STUDENT NEVER ATTENDED]   4 [4. 2-year]             
#&gt;  4   315        1 1 [1. TRANSCRIPT RECEIVED]      1 [1. Research &amp; Doctoral]
#&gt;  5   315        2 1 [1. TRANSCRIPT RECEIVED]      2 [2. Comprehensive]      
#&gt;  6   414        1 3 [3. STUDENT NEVER ATTENDED]   4 [4. 2-year]             
#&gt;  7   430        1 4 [4. SCHOOL LOST OR DESTROYED] 4 [4. 2-year]             
#&gt;  8   802        1 1 [1. TRANSCRIPT RECEIVED]      4 [4. 2-year]             
#&gt;  9   802        2 2 [2. SCHOOL REFUSED]           3 [3. Liberal Arts]       
#&gt; 10   836        1 4 [4. SCHOOL LOST OR DESTROYED] 6 [6. Specialized]        
#&gt; 11   836        2 1 [1. TRANSCRIPT RECEIVED]      4 [4. 2-year]             
#&gt; 12   935        1 1 [1. TRANSCRIPT RECEIVED]      2 [2. Comprehensive]      
#&gt; 13   935        2 1 [1. TRANSCRIPT RECEIVED]      2 [2. Comprehensive]      
#&gt; 14   935        3 3 [3. STUDENT NEVER ATTENDED]   5 [5. Less than 2-year]   
#&gt; 15  1040        1 1 [1. TRANSCRIPT RECEIVED]      1 [1. Research &amp; Doctoral]
#&gt; 16  1040        2 1 [1. TRANSCRIPT RECEIVED]      1 [1. Research &amp; Doctoral]
#&gt; 17  1057        1 1 [1. TRANSCRIPT RECEIVED]      2 [2. Comprehensive]      
#&gt; 18  1099        1 4 [4. SCHOOL LOST OR DESTROYED] 4 [4. 2-year]             
#&gt; 19  1099        2 4 [4. SCHOOL LOST OR DESTROYED] 4 [4. 2-year]             
#&gt; 20  1099        3 1 [1. TRANSCRIPT RECEIVED]      5 [5. Less than 2-year]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#nls_tran %&gt;% group_by(id) %&gt;% summarise(n_per_key=n()) %&gt;% ungroup %&gt;% count(n_per_key)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="mutating-joins" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Mutating joins</h1>
<p>Following Wickham, we’ll explain joins using the hypothetical tables <code>x</code> and <code>y</code>:</p>
<p><img src="https://raw.githubusercontent.com/anyone-can-cook/rclass1/master/assets/images/join-setup.png" class="img-fluid"></p>
<p><em>Note: Credit for examples and images belong to <a href="https://r4ds.had.co.nz/relational-data.html#mutating-joins">Wickham</a></em></p>
<p><br> What is a <strong>join</strong>?</p>
<ul>
<li>A <strong>join</strong> “is a way of connecting each row in <code>x</code> to zero, one, or more rows in <code>y</code>”</li>
<li>Observations in table <code>x</code> matched to observations in table <code>y</code> using a “key” variable</li>
<li>A <strong>key</strong> is a variable (or combination of variables) that exist in both tables and uniquely identifies observations in at least one of the two tables</li>
</ul>
<p><br> There are four types of joins between tables <code>x</code> and <code>y</code>:</p>
<ul>
<li><strong>inner join</strong>: keep all observations that appear in both table <code>x</code> and table <code>y</code></li>
<li><strong>left join</strong>: keep all observations in <code>x</code> (regardless of whether these obs appear in <code>y</code>)</li>
<li><strong>right join</strong>: keep all observations in <code>y</code> (regardless of whether these obs appear in <code>x</code>)</li>
<li><strong>full join</strong>: keep all observations that appear in <code>x</code> or in <code>y</code></li>
</ul>
<p>The last three joins – left, right, full – keep observations that appear in at least one table and are collectively referred to as <strong>outer joins</strong>.</p>
<p><img src="http://r4ds.had.co.nz/diagrams/join-venn.png" class="img-fluid"></p>
<p><br> We will join tables <code>x</code> and <code>y</code> using the <code>join()</code> command from <code>dplyr</code> package. <code>join()</code> is a general command, which has more specific commands for each type of join:</p>
<ul>
<li><code>inner_join()</code></li>
<li><code>left_join()</code></li>
<li><code>right_join()</code></li>
<li><code>full_join()</code></li>
</ul>
<section id="inner-joins" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="inner-joins"><span class="header-section-number">3.1</span> Inner joins</h2>
<p><strong>Inner joins</strong> keep all observations that appear in both table <code>x</code> and table <code>y</code> (i.e., keep observations <code style="background-color:lightgreen">1</code> and <code style="background-color:lavender">2</code>):</p>
<p><img src="https://raw.githubusercontent.com/anyone-can-cook/rclass1/master/assets/images/join-inner.png" class="img-fluid"></p>
<p><br> <strong>The <code>inner_join()</code> function</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>?inner_join</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SYNTAX AND DEFAULT VALUES</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  x,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  y,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="cn">NULL</span>,</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">copy =</span> <span class="cn">FALSE</span>,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">".x"</span>, <span class="st">".y"</span>),</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  ...,</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">na_matches =</span> <span class="fu">c</span>(<span class="st">"na"</span>, <span class="st">"never"</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Function: Perform inner join between dataframes <code>x</code> and <code>y</code></li>
<li>Arguments:
<ul>
<li><code>x</code>, <code>y</code>: Dataframes to join</li>
<li><code>by</code>: Variable(s) to join by
<ul>
<li>If joining by single variable: <code>inner_join(x, y, by = "keyvar")</code></li>
<li>If joining by multiple variables: <code>inner_join(x, y, by = c("keyvar1", "keyvar2", ...))</code></li>
<li>If variables to join by have different names: <code>inner_join(x, y, by = c("keyvarx" = "keyvary", ...))</code></li>
</ul></li>
</ul></li>
</ul>
<p><br> <strong>Example</strong>: Using <code>inner_join()</code> to join <code>x</code> and <code>y</code></p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `x`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">val_x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">x1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">x2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">x3</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `y`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">val_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">y1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">y2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">y3</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p>We want to join <code>x</code> and <code>y</code> by the common variable <code>key</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(x, y, <span class="at">by =</span> <span class="st">"key"</span>)  <span class="co"># Equivalent to: inner_join(x, y, by = c("key" = "key"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 2 × 3
#&gt;     key val_x val_y
#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
#&gt; 1     1 x1    y1   
#&gt; 2     2 x2    y2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">by =</span> <span class="st">"key"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 2 × 3
#&gt;     key val_x val_y
#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
#&gt; 1     1 x1    y1   
#&gt; 2     2 x2    y2</code></pre>
</div>
</div>
<p><br> This is an example of a <strong>one-to-one</strong> relationship because <code>key</code> uniquely identifies observations in both table <code>x</code> and <code>y</code>. In other words, <code>key</code> can be the <em>primary key</em> for both <code>x</code> and <code>y</code>, as well as <em>foreign key</em> when we think about the relationship between the tables. <!-- https://stackoverflow.com/a/30517805/6373540 --></p>
<p><br></p>
<details>
<summary>
<strong>Example</strong>: One-to-one inner join between <code>nls_stu</code> and <code>nls_stu_pets</code>
</summary>
<p>Recall that <code>nls_stu</code> and <code>nls_stu_pets</code> are both student level data</p>
<ul>
<li><code>nls_stu</code> contains info on student demographics and <code>nls_stu_pets</code> contains info on student postsecondary education transcripts (PETS). It makes sense that we’ll want to join the tables by student, namely using the student <code>id</code> variable. This will be a one-to-one join because <code>id</code> uniquely identifies the observations in both <code>nls_stu</code> and <code>nls_stu_pets</code>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>nls_stu <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_per_id=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">count</span>(n_per_id) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_id     n
#&gt;      &lt;int&gt; &lt;int&gt;
#&gt; 1        1 22652</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>nls_stu_pets <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_per_id=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">count</span>(n_per_id) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_id     n
#&gt;      &lt;int&gt; &lt;int&gt;
#&gt; 1        1 14759</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the nls_stu and nls_stu_pets by id variable</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>nls_stu_stu <span class="ot">&lt;-</span> nls_stu <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(nls_stu_pets, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Joined dataframe now have variables from both nls_stu and nls_stu_pets</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(nls_stu_stu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "id"       "schcode"  "bysex"    "csex"     "crace"    "cbirthm" 
#&gt;  [7] "cbirthd"  "cbirthyr" "reqtrans" "numtrans"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a few obs and selected variables from joined dataframe</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>nls_stu_stu <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, bysex, crace, reqtrans, numtrans) <span class="sc">%&gt;%</span> <span class="fu">as_factor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 14,759 × 5
#&gt;       id bysex                 crace           reqtrans numtrans
#&gt;    &lt;dbl&gt; &lt;fct&gt;                 &lt;fct&gt;              &lt;dbl&gt;    &lt;dbl&gt;
#&gt;  1    18 2. female             4. PUERTO RICAN        1        0
#&gt;  2    67 1. male               2. black               1        1
#&gt;  3    83 2. female             7. white               1        0
#&gt;  4   315 1. male               7. white               2        2
#&gt;  5   414 1. male               7. white               1        0
#&gt;  6   430 1. male               4. PUERTO RICAN        1        0
#&gt;  7   802 2. female             7. white               2        1
#&gt;  8   836 1. male               7. white               2        1
#&gt;  9   935 99. {LEGITIMATE SKIP} 7. white               3        2
#&gt; 10  1040 1. male               7. white               2        2
#&gt; # ℹ 14,749 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare number of obs in input datasets to joined dataset</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nls_stu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 22652</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nls_stu_pets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 14759</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember inner join only keeps obs that are common in both tables, so it makes sense that the joined dataset cannot have more rows than either input datasets</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nls_stu_stu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 14759</code></pre>
</div>
</div>
</details>
<section id="duplicate-keys" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="duplicate-keys"><span class="header-section-number">3.1.1</span> Duplicate keys</h3>
<p>There are times when the key variable(s) we join by do not uniquely identify observations in both the tables. For example, the table on the right (<code>y</code>) below has unique values for <code>key</code> but the table on the left (<code>x</code>) contains multiple observations with the same value:</p>
<p><img src="https://raw.githubusercontent.com/anyone-can-cook/rclass1/master/assets/images/join-many-to-one.png" class="img-fluid"></p>
<p>This represents a <strong>one-to-many</strong> relationship, where one observation in <code>y</code> matches to multiple observations in <code>x</code>. Since <code>key</code> uniquely identifies observations in <code>y</code>, it is the <em>primary key</em> in table <code>y</code> and the <em>foreign key</em> in table <code>x</code>.</p>
<p><br> <strong>Example</strong>: Using <code>inner_join()</code> to join <code>x</code> and <code>y</code></p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `x`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">val_x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">x1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">x2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">x3</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">x4</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `y`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">val_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">y1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">y2</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p>We can confirm that <code>x</code> and <code>y</code> have a <strong>many-to-one</strong> relationship because <code>key</code> does not uniquely identify observations in <code>x</code> but does uniquely identify observations in <code>y</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">count</span>(n_per_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_key     n
#&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1         2     2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>y <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">count</span>(n_per_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_key     n
#&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1         1     2</code></pre>
</div>
</div>
<p>We want to join <code>x</code> and <code>y</code> by the common variable <code>key</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(x, y, <span class="at">by =</span> <span class="st">"key"</span>)  <span class="co"># Equivalent to: inner_join(x, y, by = c("key" = "key"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 4 × 3
#&gt;     key val_x val_y
#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
#&gt; 1     1 x1    y1   
#&gt; 2     2 x2    y2   
#&gt; 3     2 x3    y2   
#&gt; 4     1 x4    y1</code></pre>
</div>
</div>
<p><br></p>
<details>
<summary>
<strong>Summary of the types of relationships</strong>
</summary>
<p>General rule of thumb for joining two tables:</p>
<ul>
<li><strong>Key variable should uniquely identify observations in at least one of the tables you are joining</strong></li>
</ul>
<p>Depending on whether the key variable uniquely identifies observations in table <code>x</code> and/or table <code>y</code> you will have:</p>
<ul>
<li><strong>one-to-one</strong> join: key variable uniquely identifies observations in table <code>x</code> and uniquely identifies observations in table <code>y</code>
<ul>
<li>The join between <code>nls_stu</code> and <code>nls_stu_pets</code> was a one-to-one join; the variable <code>id</code> uniquely identifies observations in both tables</li>
<li>In the relational database world one-to-one joins are rare and are considered special cases of one-to-many or many-to-one joins
<ul>
<li>Why? if tables can be joined via one-to-one join, then they should already be part of the same table.</li>
</ul></li>
</ul></li>
<li><strong>one-to-many</strong> join: key variable uniquely identifies observatiosn in table <code>x</code> and does not uniquely identify observations in table <code>y</code>
<ul>
<li>Each observation from table <code>x</code> may match to multiple observations from table <code>y</code></li>
<li>E.g., Joining <code>nls_stu</code> and <code>nls_trans</code>: <em>one</em> observation (student) in <code>nls_stu</code> has <em>many</em> observations in <code>nls_trans</code> (transcripts)</li>
</ul></li>
<li><strong>many-to-one</strong> join: key variable does not uniquely identify observations in table <code>x</code> and does uniquely identify observations in table <code>y</code>
<ul>
<li>Each observation from table <code>y</code> may match to multiple observations from table <code>x</code></li>
<li>E.g., Joining <code>nls_trans</code> and <code>nls_stu</code>: <em>many</em> observations (transcripts) in <code>nls_trans</code> have <em>one</em> observation in <code>nls_stu</code> (student)</li>
</ul></li>
<li><strong>many-to-many</strong> join: key variable does not uniquely identify observations in table <code>x</code> and does not uniquely identify observations in table <code>y</code>
<ul>
<li>This is usually an error</li>
</ul></li>
</ul>
</details>
<p><br></p>
<details>
<summary>
<strong>Example</strong>: One-to-many inner join between <code>nls_stu</code> and <code>nls_trans</code>
</summary>
<p>Recall that <code>nls_stu</code> contains student level demographics data, where the student <code>id</code> variable uniquely identifies each observation in the table. <code>nls_trans</code> on the other hand is student-transcript level data, so <code>id</code> does not uniquely identify each observation. Thus, if we join by <code>id</code>, it would be a one-to-many relationship:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># id uniquely identify obs in nls_stu</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>nls_stu <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">count</span>(n_per_key) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_key     n
#&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1         1 22652</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># id does not uniquely identify obs in nls_tran</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>nls_tran <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">count</span>(n_per_key) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 7 × 2
#&gt;   n_per_key     n
#&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1         1  8022
#&gt; 2         2  4558
#&gt; 3         3  1681
#&gt; 4         4   415
#&gt; 5         5    71
#&gt; 6         6     6
#&gt; 7         7     3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the nls_stu and nls_tran by id variable</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>nls_stu_tran <span class="ot">&lt;-</span> nls_stu <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(nls_tran, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Joined dataframe now have variables from both nls_stu and nls_tran</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(nls_stu_tran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;  [1] "id"       "schcode"  "bysex"    "csex"     "crace"    "cbirthm" 
#&gt;  [7] "cbirthd"  "cbirthyr" "transnum" "findisp"  "trnsflag" "terms"   
#&gt; [13] "fice"     "state"    "cofcon"   "instype"  "itype"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a few obs and selected variables from joined dataframe</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>nls_stu_tran <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, transnum, bysex, findisp, trnsflag) <span class="sc">%&gt;%</span> <span class="fu">as_factor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 24,253 × 5
#&gt;       id transnum bysex     findisp                     trnsflag               
#&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;     &lt;fct&gt;                       &lt;fct&gt;                  
#&gt;  1    18        1 2. female 6. NO RESPONSE FROM SCHOOL  0. DUMMY TRANSCRIPT    
#&gt;  2    67        1 1. male   1. TRANSCRIPT RECEIVED      1. REQUESTED &amp; RECEIVED
#&gt;  3    83        1 2. female 3. STUDENT NEVER ATTENDED   0. DUMMY TRANSCRIPT    
#&gt;  4   315        1 1. male   1. TRANSCRIPT RECEIVED      1. REQUESTED &amp; RECEIVED
#&gt;  5   315        2 1. male   1. TRANSCRIPT RECEIVED      1. REQUESTED &amp; RECEIVED
#&gt;  6   414        1 1. male   3. STUDENT NEVER ATTENDED   0. DUMMY TRANSCRIPT    
#&gt;  7   430        1 1. male   4. SCHOOL LOST OR DESTROYED 0. DUMMY TRANSCRIPT    
#&gt;  8   802        1 2. female 1. TRANSCRIPT RECEIVED      1. REQUESTED &amp; RECEIVED
#&gt;  9   802        2 2. female 2. SCHOOL REFUSED           0. DUMMY TRANSCRIPT    
#&gt; 10   836        1 1. male   4. SCHOOL LOST OR DESTROYED 0. DUMMY TRANSCRIPT    
#&gt; # ℹ 24,243 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare number of obs in input datasets to joined dataset</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nls_stu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 22652</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nls_tran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 24253</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Since each id in nls_stu may match to more than one observation in nls_tran, it makes sense that the joined dataset may have more rows than nls_stu</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nls_stu_tran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 24253</code></pre>
</div>
</div>
</details>
</section>
<section id="joining-by-multiple-variables" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="joining-by-multiple-variables"><span class="header-section-number">3.1.2</span> Joining by multiple variables</h3>
<p>Thus far, tables have been joined by a single “key” variable using this syntax:</p>
<ul>
<li><code>inner_join(x, y, by = "keyvar")</code></li>
</ul>
<p>Often, multiple variables form the “key”. Specify this using this syntax:</p>
<ul>
<li><code>inner_join(x, y, by = c("keyvar1", "keyvar2", ...))</code></li>
</ul>
<p><br> <strong>Example</strong>: Joining <code>nls_tran</code> and <code>nls_term</code> by multiple variables</p>
<p>Recall that the student-transcript level dataset <code>nls_tran</code> is uniquely identified by the combination of two variables: <code>id</code> and <code>transnum</code>. Together, these variables form the <em>primary key</em> of <code>nls_tran</code> and <em>foreign key</em> of <code>nls_term</code>, the table we want to join <code>nls_tran</code> with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join nls_tran and nls_term by multiple variables</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(nls_tran, nls_term, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"transnum"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 120,807 × 17
#&gt;       id transnum findisp     trnsflag terms  fice state cofcon  instype itype  
#&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl+lbl&gt;   &lt;dbl+lb&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+l&gt;
#&gt;  1    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  2    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  3    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  4    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  5    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  6    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  7    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  8    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  9   315        1 1 [1. TRAN… 1 [1. R…    20  1009     1 6 [6. … 3 [3. … 1 [1. …
#&gt; 10   315        1 1 [1. TRAN… 1 [1. R…    20  1009     1 6 [6. … 3 [3. … 1 [1. …
#&gt; # ℹ 120,797 more rows
#&gt; # ℹ 7 more variables: termnum &lt;dbl&gt;, courses &lt;dbl&gt;, termtype &lt;dbl+lbl&gt;,
#&gt; #   season &lt;dbl+lbl&gt;, sortdate &lt;dbl&gt;, gradcode &lt;dbl+lbl&gt;, transfer &lt;dbl+lbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Equivalent to: inner_join(nls_tran, nls_term, by = c("id" = "id", "transnum" = "transnum"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="outer-joins" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="outer-joins"><span class="header-section-number">3.2</span> Outer joins</h2>
<p><strong>Outer joins</strong> keep observations that appear in at least one table. Recall tables <code>x</code> and <code>y</code>:</p>
<p><img src="https://raw.githubusercontent.com/anyone-can-cook/rclass1/master/assets/images/join-setup.png" class="img-fluid"></p>
<p><br> To perform each of the 3 types of <strong>outer joins</strong>:</p>
<ul>
<li><strong>Left join</strong>: keep all observations in <code>x</code>, regardless of whether they appear in <code>y</code> (i.e., keep observations <code style="background-color:lightgreen">1</code>, <code style="background-color:lavender">2</code>, and <code style="background-color:peachpuff">3</code>)</li>
<li><strong>Right join</strong>: keep all observations in <code>y</code>, regardless of whether they appear in <code>x</code> (i.e., keep observations <code style="background-color:lightgreen">1</code>, <code style="background-color:lavender">2</code>, and <code style="background-color:palegoldenrod">4</code>)</li>
<li><strong>Full join</strong>: keep all observations that appear in <code>x</code> or in <code>y</code> (i.e., keep observations <code style="background-color:lightgreen">1</code>, <code style="background-color:lavender">2</code>, <code style="background-color:peachpuff">3</code>, and <code style="background-color:palegoldenrod">4</code>)</li>
</ul>
<p>Note that any unmatched rows will have <code>NA</code> values in the column. As explained by Wickham, “These joins work by adding an additional ‘virtual’ observation to each table. This observation has a key that always matches (if no other key matches), and a value filled with <code>NA</code>.”</p>
<p><img src="https://raw.githubusercontent.com/anyone-can-cook/rclass1/master/assets/images/join-outer.png" class="img-fluid"></p>
<p><br></p>
<details>
<summary>
<strong>Example</strong>: Left joins between <code>nls_stu</code>, <code>nls_stu_pets</code>, and <code>nls_tran</code>
</summary>
<p>The <strong>left join</strong> is the most commonly used outer join in social science research (more common than inner join too). This is because we often start with some dataset <code>x</code> (e.g., <code>nls_stu</code>) and we want to add variables from dataset <code>y</code>.</p>
<ul>
<li>Usually, we want to keep observations from <code>x</code> regardless of whether they match with <code>y</code></li>
<li>Usually, we are uninterested in observations from <code>y</code> that did not match with <code>x</code></li>
</ul>
<p>In this example, we will:</p>
<ul>
<li>Start with <code>nls_stu</code></li>
<li>Perform a left join with <code>nls_stu_pets</code></li>
<li>Then perform a left join with <code>nls_tran</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recall that id uniquely identifies both nls_stu and nls_stu_pets</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>nls_stu <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">count</span>(n_per_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_key     n
#&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1         1 22652</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>nls_stu_pets <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">count</span>(n_per_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_key     n
#&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1         1 14759</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join nls_stu with nls_stu_pets (one-to-one)</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>nls_stu_pets_stu <span class="ot">&lt;-</span> nls_stu <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(nls_stu_pets, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Investigate data structure of merged object</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nls_stu_pets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 14759</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nls_stu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 22652</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nls_stu_pets_stu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 22652</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recall that id and transnum (not id alone) uniquely identifies nls_tran</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>nls_tran <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id, transnum) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">count</span>(n_per_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_key     n
#&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1         1 24253</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join nls_stu_pets_stu with nls_tran (one-to-many)</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>nls_stu_pets_stu_tran <span class="ot">&lt;-</span> nls_stu_pets_stu <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(nls_tran, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Investigate data structure of merged object</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nls_stu_pets_stu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 22652</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nls_tran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 24253</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(nls_stu_pets_stu_tran)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 32149</code></pre>
</div>
</div>
</details>
</section>
</section>
<section id="filtering-joins" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Filtering joins</h1>
<p>What are <strong>filtering joins</strong>?</p>
<ul>
<li><strong>Filtering joins</strong> filter rows from <code>x</code> based on the presence or absence of matches in <code>y</code></li>
<li>Unlike <em>mutating joins</em> which results in an object with variables (columns) from both <code>x</code> and <code>y</code>, <em>filtering joins</em> only retains variables from <code>x</code></li>
<li>In other words, filtering joins keeps observations (rows) from the <code>x</code> dataframe depending on whether or not it has a match in <code>y</code></li>
</ul>
<p><br> There are two types of filtering joins:</p>
<ul>
<li><code>anti_join(x, y)</code>: return all rows from <code>x</code> without a match in <code>y</code></li>
<li><code>semi_join(x, y)</code>: return all rows from <code>x</code> with a match in <code>y</code></li>
</ul>
<p><br> <strong>Example</strong>: Using <code>anti_join()</code> and <code>semi_join()</code></p>
<p>Imagine we have the following tables <code>x</code> and <code>y</code>:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `x`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">val_x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">x1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">x2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">x3</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">x5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">x6</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">x7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">x8</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `y`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">val_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">y1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">y2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">y3</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">y4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">y5</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: left;">y6</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><strong>Semi join</strong> returns all rows from <code>x</code> where there are matching values in <code>y</code>: <code>semi_join(x, y, by = "key")</code></p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Semi join</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">val_x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">x1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">x2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">x3</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">x5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">x6</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><strong>Anti join</strong> returns all rows from <code>x</code> where there are <em>no</em> matching values in <code>y</code>: <code>anti_join(x, y, by = "key")</code></p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Anti join</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">val_x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">x7</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">x8</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p>We can see which rows from <code>x</code> have or do not have a match in <code>y</code> from the <strong>left join</strong>: <code>left_join(x, y, by = "key")</code></p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Left join</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">val_x</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">val_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">x1</td>
<td style="text-align: left;">y1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">x1</td>
<td style="text-align: left;">y2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">x2</td>
<td style="text-align: left;">y3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">x3</td>
<td style="text-align: left;">y3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">x5</td>
<td style="text-align: left;">y4</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">x6</td>
<td style="text-align: left;">y5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">x7</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">x8</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p>Note that the row from <code>x</code> where <code>key == 1</code> and <code>val_x == x1</code> appears twice in the left join because it has a one-to-many relationship with <code>y</code>. However, this row is not duplicated in the semi join.</p>
<p><br></p>
<details>
<summary>
<strong>Example</strong>: Using <code>anti_join()</code> to diagnose mismatches in mutating joins
</summary>
<p>A primary use of <strong>filtering joins</strong> is as an investigative tool to diagnose problems with <em>mutating joins</em>. We can use <code>anti_join()</code> to investigate the rows that did not have a match during the join.</p>
<p>For example, consider an inner join between <code>nls_tran</code>, which contains info on postsecondary transcripts, and <code>nls_term</code>, which contains term level info for each transcript:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># id and transnum uniquely identify obs in nls_trans</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>nls_tran <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id, transnum) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_per_key=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">count</span>(n_per_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   n_per_key     n
#&gt;       &lt;int&gt; &lt;int&gt;
#&gt; 1         1 24253</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 24253 unique student transcripts (rows) in nls_tran</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>nls_tran <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 24253</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inner_join</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>nls_tran <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(nls_term, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"transnum"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 120,807 × 17
#&gt;       id transnum findisp     trnsflag terms  fice state cofcon  instype itype  
#&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl+lbl&gt;   &lt;dbl+lb&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl+l&gt; &lt;dbl+l&gt; &lt;dbl+l&gt;
#&gt;  1    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  2    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  3    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  4    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  5    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  6    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  7    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  8    67        1 1 [1. TRAN… 1 [1. R…     8  5694     1 2 [2. … 1 [1. … 5 [5. …
#&gt;  9   315        1 1 [1. TRAN… 1 [1. R…    20  1009     1 6 [6. … 3 [3. … 1 [1. …
#&gt; 10   315        1 1 [1. TRAN… 1 [1. R…    20  1009     1 6 [6. … 3 [3. … 1 [1. …
#&gt; # ℹ 120,797 more rows
#&gt; # ℹ 7 more variables: termnum &lt;dbl&gt;, courses &lt;dbl&gt;, termtype &lt;dbl+lbl&gt;,
#&gt; #   season &lt;dbl+lbl&gt;, sortdate &lt;dbl&gt;, gradcode &lt;dbl+lbl&gt;, transfer &lt;dbl+lbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># figure out number of obs from nls_tran that merged w/ nls_term</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>nls_tran <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(nls_term, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"transnum"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id,transnum) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>() <span class="sc">%&gt;%</span> <span class="co"># keep one obs per each combination of id,transnum</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>() <span class="co"># number of number of obs from nls_tran that had merged with nls_term by id,transnum</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 18855</code></pre>
</div>
</div>
<p><br> As seen, <strong>18855</strong> of the <strong>24253</strong> student transcripts (rows) in <code>nls_tran</code> have a match in <code>nls_term</code>, leaving a remaining <strong>5398</strong> student transcripts that did not match to any term level info. We can use <code>anti_join()</code> to investigate these unmatched rows to see why these transcripts do not have any term level data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create object of observations that didn't merge</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>tran_term_anti <span class="ot">&lt;-</span> nls_tran <span class="sc">%&gt;%</span> <span class="fu">anti_join</span>(nls_term, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"transnum"</span>))</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 5398 unmatched student transcripts from nls_tran</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(tran_term_anti)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 5398</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can investigate the findisp variable of the unmatched rows</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(tran_term_anti<span class="sc">$</span>findisp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; $label
#&gt; [1] "FINAL DISPOSITION"
#&gt; 
#&gt; $format.stata
#&gt; [1] "%27.0g"
#&gt; 
#&gt; $labels
#&gt;      1. TRANSCRIPT RECEIVED           2. SCHOOL REFUSED 
#&gt;                           1                           2 
#&gt;   3. STUDENT NEVER ATTENDED 4. SCHOOL LOST OR DESTROYED 
#&gt;                           3                           4 
#&gt;            5. SCHOOL CLOSED  6. NO RESPONSE FROM SCHOOL 
#&gt;                           5                           6 
#&gt; 
#&gt; $class
#&gt; [1] "haven_labelled" "vctrs_vctr"     "double"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># None of the unmatched rows has "TRANSCRIPT RECEIVED" status, which could explain why they had no match</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>tran_term_anti <span class="sc">%&gt;%</span> <span class="fu">select</span>(findisp) <span class="sc">%&gt;%</span> <span class="fu">count</span>(findisp) <span class="sc">%&gt;%</span> <span class="fu">as_factor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; # A tibble: 5 × 2
#&gt;   findisp                         n
#&gt;   &lt;fct&gt;                       &lt;int&gt;
#&gt; 1 2. SCHOOL REFUSED             272
#&gt; 2 3. STUDENT NEVER ATTENDED    2565
#&gt; 3 4. SCHOOL LOST OR DESTROYED  1113
#&gt; 4 5. SCHOOL CLOSED              210
#&gt; 5 6. NO RESPONSE FROM SCHOOL   1238</code></pre>
</div>
</div>
</details>
</section>
<section id="appending-data" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Appending data</h1>
<p><strong>Appending data</strong> involve “stacking” multiple datasets (which typically have the same variables) on top of one another.</p>
<p><br> <strong>The <code>bind_rows()</code> function</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>?bind_rows</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SYNTAX AND DEFAULT VALUES</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(..., <span class="at">.id =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Function: Bind rows of multiple dataframes into one</li>
<li>Arguments:
<ul>
<li><code>...</code>: Dataframes to bind</li>
</ul></li>
</ul>
<p><br> <strong>Example</strong>: Using <code>bind_rows()</code> to bind <code>time1</code> and <code>time2</code></p>
<p>The most common practical use of stacking is creating “longitudinal dataset” when input data are released separately for each time period. <em>Longitudinal data</em> has one row per time period for a person/place/observation.</p>
<p>Imagine we have the following tables <code>time1</code> and <code>time2</code>:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `time1`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">income</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">200</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `time2`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">income</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">70</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">120</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">220</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><br> Use <code>bind_rows()</code> to stack the dataframes on top of one another:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(time1, time2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">income</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">200</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">70</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">120</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">220</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><br></p>
<details>
<summary>
<strong>Example</strong>: Creating longitudinal dataset from IPEDS data
</summary>
<p>IPEDS collects annual survey data from colleges/universities. We will create a longitudinal dataset about university characteristics by appending/stacking annual data from the 2014-15, 2015-16, and 2016-17 academic years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load 2014-15 IPEDS data</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>admit14_15 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"https://github.com/anyone-can-cook/rclass1/raw/master/data/ipeds/ic/ic14_15_admit.dta"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(unitid, endyear, sector, <span class="fu">contains</span>(<span class="st">"numapply"</span>), <span class="fu">contains</span>(<span class="st">"numadmit"</span>))</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load 2015-16 IPEDS data</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>admit15_16 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"https://github.com/anyone-can-cook/rclass1/raw/master/data/ipeds/ic/ic15_16_admit.dta"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(unitid, endyear, sector, <span class="fu">contains</span>(<span class="st">"numapply"</span>), <span class="fu">contains</span>(<span class="st">"numadmit"</span>))</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Load 2016-17 IPEDS data</span></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>admit16_17 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"https://github.com/anyone-can-cook/rclass1/raw/master/data/ipeds/ic/ic16_17_admit.dta"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(unitid, endyear, sector, <span class="fu">contains</span>(<span class="st">"numapply"</span>), <span class="fu">contains</span>(<span class="st">"numadmit"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `admit14_15`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">unitid</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">endyear</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sector</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplymen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplywom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplytot</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitmen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitwom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmittot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">100654</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3852</td>
<td style="text-align: right;">6049</td>
<td style="text-align: right;">9901</td>
<td style="text-align: right;">1977</td>
<td style="text-align: right;">3227</td>
<td style="text-align: right;">5204</td>
</tr>
<tr class="even">
<td style="text-align: right;">100663</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2293</td>
<td style="text-align: right;">3417</td>
<td style="text-align: right;">5710</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">2889</td>
<td style="text-align: right;">4893</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100706</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1165</td>
<td style="text-align: right;">939</td>
<td style="text-align: right;">2104</td>
<td style="text-align: right;">981</td>
<td style="text-align: right;">745</td>
<td style="text-align: right;">1726</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `admit15_16`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">unitid</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">endyear</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sector</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplymen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplywom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplytot</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitmen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitwom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmittot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">100654</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3030</td>
<td style="text-align: right;">4871</td>
<td style="text-align: right;">7901</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">3167</td>
<td style="text-align: right;">5166</td>
</tr>
<tr class="even">
<td style="text-align: right;">100663</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2686</td>
<td style="text-align: right;">4986</td>
<td style="text-align: right;">7672</td>
<td style="text-align: right;">1710</td>
<td style="text-align: right;">2926</td>
<td style="text-align: right;">4636</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100706</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1801</td>
<td style="text-align: right;">1507</td>
<td style="text-align: right;">3308</td>
<td style="text-align: right;">1509</td>
<td style="text-align: right;">1177</td>
<td style="text-align: right;">2686</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `admit16_17`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">unitid</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">endyear</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sector</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplymen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplywom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplytot</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitmen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitwom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmittot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">100654</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2725</td>
<td style="text-align: right;">4318</td>
<td style="text-align: right;">7043</td>
<td style="text-align: right;">2276</td>
<td style="text-align: right;">3878</td>
<td style="text-align: right;">6154</td>
</tr>
<tr class="even">
<td style="text-align: right;">100663</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3510</td>
<td style="text-align: right;">5949</td>
<td style="text-align: right;">9459</td>
<td style="text-align: right;">2062</td>
<td style="text-align: right;">3437</td>
<td style="text-align: right;">5499</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100706</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2385</td>
<td style="text-align: right;">2160</td>
<td style="text-align: right;">4545</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">1537</td>
<td style="text-align: right;">3467</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><br> Use <code>bind_rows()</code> to stack the dataframes on top of one another:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>admit_append <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(admit14_15, admit15_16, admit16_17)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The stacked dataframe has 9 columns and 6514 rows (sum of rows from the 3 input dataframes)</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(admit_append)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 6514    9</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>admit_append <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(unitid, endyear) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">unitid</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">endyear</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sector</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplymen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplywom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplytot</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitmen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitwom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmittot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">100654</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3852</td>
<td style="text-align: right;">6049</td>
<td style="text-align: right;">9901</td>
<td style="text-align: right;">1977</td>
<td style="text-align: right;">3227</td>
<td style="text-align: right;">5204</td>
</tr>
<tr class="even">
<td style="text-align: right;">100654</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3030</td>
<td style="text-align: right;">4871</td>
<td style="text-align: right;">7901</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">3167</td>
<td style="text-align: right;">5166</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100654</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2725</td>
<td style="text-align: right;">4318</td>
<td style="text-align: right;">7043</td>
<td style="text-align: right;">2276</td>
<td style="text-align: right;">3878</td>
<td style="text-align: right;">6154</td>
</tr>
<tr class="even">
<td style="text-align: right;">100663</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2293</td>
<td style="text-align: right;">3417</td>
<td style="text-align: right;">5710</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">2889</td>
<td style="text-align: right;">4893</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100663</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2686</td>
<td style="text-align: right;">4986</td>
<td style="text-align: right;">7672</td>
<td style="text-align: right;">1710</td>
<td style="text-align: right;">2926</td>
<td style="text-align: right;">4636</td>
</tr>
<tr class="even">
<td style="text-align: right;">100663</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3510</td>
<td style="text-align: right;">5949</td>
<td style="text-align: right;">9459</td>
<td style="text-align: right;">2062</td>
<td style="text-align: right;">3437</td>
<td style="text-align: right;">5499</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100706</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1165</td>
<td style="text-align: right;">939</td>
<td style="text-align: right;">2104</td>
<td style="text-align: right;">981</td>
<td style="text-align: right;">745</td>
<td style="text-align: right;">1726</td>
</tr>
<tr class="even">
<td style="text-align: right;">100706</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1801</td>
<td style="text-align: right;">1507</td>
<td style="text-align: right;">3308</td>
<td style="text-align: right;">1509</td>
<td style="text-align: right;">1177</td>
<td style="text-align: right;">2686</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100706</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2385</td>
<td style="text-align: right;">2160</td>
<td style="text-align: right;">4545</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">1537</td>
<td style="text-align: right;">3467</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
</details>
<p><br></p>
<details>
<summary>
<strong>Example</strong>: Appending datasets where not all columns match
</summary>
<p>If we try appending datasets where not all columns match, this will result in <code>NA</code> being filled for observations where columns do not match.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove some variables from 2014-15 dataframe</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>admit14_15 <span class="ot">&lt;-</span> admit14_15 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"numadmit"</span>))</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove some variables from 2015-16 dataframe</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>admit15_16 <span class="ot">&lt;-</span> admit15_16 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"numapply"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `admit14_15`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">unitid</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">endyear</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sector</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplymen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplywom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplytot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">100654</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3852</td>
<td style="text-align: right;">6049</td>
<td style="text-align: right;">9901</td>
</tr>
<tr class="even">
<td style="text-align: right;">100663</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2293</td>
<td style="text-align: right;">3417</td>
<td style="text-align: right;">5710</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100706</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1165</td>
<td style="text-align: right;">939</td>
<td style="text-align: right;">2104</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `admit15_16`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">unitid</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">endyear</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sector</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitmen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitwom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmittot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">100654</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">3167</td>
<td style="text-align: right;">5166</td>
</tr>
<tr class="even">
<td style="text-align: right;">100663</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1710</td>
<td style="text-align: right;">2926</td>
<td style="text-align: right;">4636</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100706</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1509</td>
<td style="text-align: right;">1177</td>
<td style="text-align: right;">2686</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Table `admit16_17`</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">unitid</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">endyear</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sector</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplymen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplywom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplytot</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitmen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitwom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmittot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">100654</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2725</td>
<td style="text-align: right;">4318</td>
<td style="text-align: right;">7043</td>
<td style="text-align: right;">2276</td>
<td style="text-align: right;">3878</td>
<td style="text-align: right;">6154</td>
</tr>
<tr class="even">
<td style="text-align: right;">100663</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3510</td>
<td style="text-align: right;">5949</td>
<td style="text-align: right;">9459</td>
<td style="text-align: right;">2062</td>
<td style="text-align: right;">3437</td>
<td style="text-align: right;">5499</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100706</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2385</td>
<td style="text-align: right;">2160</td>
<td style="text-align: right;">4545</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">1537</td>
<td style="text-align: right;">3467</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><br> Use <code>bind_rows()</code> to stack the dataframes on top of one another:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>admit_append <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(admit14_15, admit15_16, admit16_17)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="co"># NA's are filled for missing values after the datasets are appended together</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>admit_append <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(unitid, endyear) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">unitid</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">endyear</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sector</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplymen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplywom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numapplytot</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitmen</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmitwom</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">numadmittot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">100654</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3852</td>
<td style="text-align: right;">6049</td>
<td style="text-align: right;">9901</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">100654</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">3167</td>
<td style="text-align: right;">5166</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100654</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2725</td>
<td style="text-align: right;">4318</td>
<td style="text-align: right;">7043</td>
<td style="text-align: right;">2276</td>
<td style="text-align: right;">3878</td>
<td style="text-align: right;">6154</td>
</tr>
<tr class="even">
<td style="text-align: right;">100663</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2293</td>
<td style="text-align: right;">3417</td>
<td style="text-align: right;">5710</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100663</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1710</td>
<td style="text-align: right;">2926</td>
<td style="text-align: right;">4636</td>
</tr>
<tr class="even">
<td style="text-align: right;">100663</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3510</td>
<td style="text-align: right;">5949</td>
<td style="text-align: right;">9459</td>
<td style="text-align: right;">2062</td>
<td style="text-align: right;">3437</td>
<td style="text-align: right;">5499</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100706</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1165</td>
<td style="text-align: right;">939</td>
<td style="text-align: right;">2104</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">100706</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1509</td>
<td style="text-align: right;">1177</td>
<td style="text-align: right;">2686</td>
</tr>
<tr class="odd">
<td style="text-align: right;">100706</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2385</td>
<td style="text-align: right;">2160</td>
<td style="text-align: right;">4545</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">1537</td>
<td style="text-align: right;">3467</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
</details>
</section>
<section id="appendix" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Appendix</h1>
<section id="troubleshooting-join-problems" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="troubleshooting-join-problems"><span class="header-section-number">6.1</span> Troubleshooting join problems</h2>
<p><br></p>
<details>
<summary>
<strong>Overcoming join problems before they arise</strong>
</summary>
<ol type="1">
<li>Start by investigating the data structure of tables you are going to merge
<ul>
<li>Identify the primary key in each table
<ul>
<li>This investigation should be based on your understanding of the data and reading data documentation rather than checking if each combination of variables is a primary key</li>
</ul></li>
<li>Does either table have missing or strange values (e.g., <code>-8</code>) for the primary key; if so, these observations won’t match</li>
</ul></li>
<li>Before joining, make sure that key you will use for joining uniquely identifies observations in at least one of the datasets and that the key variable(s) is present in both datasets
<ul>
<li>Investigate whether key variables have different names across the two tables. If different, then you will have to adjust syntax of your join statement accordingly.</li>
</ul></li>
<li>Before joining, you also want to make sure the key variable in one table and key variable in another table are the same type (both numeric or both string, etc.)
<ul>
<li>You could use the <code>typeof()</code> function or the <code>str()</code> function<br>
</li>
<li>Change type with this command <code>x$key &lt;- as.double(x$key)</code> or <code>x$key &lt;- as.character(x$key)</code></li>
<li>If you try to join with key variables of different type, you will get this error message: <span style="color:red">Can’t join on ‘key’ x ‘key’ because of incompatible types (character / numeric)</span><br>
</li>
</ul></li>
<li>Think about which observations you want retained after joining
<ul>
<li>Think about which dataset should be the <code>x</code> table and which should be the <code>y</code> table</li>
<li>Think about whether you want an inner, left, right, or full join</li>
</ul></li>
<li>Since mutating joins keep all variables in <code>x</code> and <code>y</code>, you may want to keep only specific variables in <code>x</code> and/or <code>y</code> as a prior step to joining
<ul>
<li>Make sure that non-key variables from tables have different names; if duplicate names exist, the default is to add <code>.x</code> and <code>.y</code> to the end of the variable name. For example, if you have two tables with non-key variables with the name <code>type</code> and you join them, you will end up with variables (columns) <code>type.x</code> and <code>type.y</code>.</li>
</ul></li>
</ol>
</details>
<p><br></p>
<details>
<summary>
<strong>Overcoming join problems when they do arise</strong>
</summary>
<ul>
<li>Identify which observations don’t match
<ul>
<li><code>anti_join()</code> is your friend here</li>
</ul></li>
<li>Investigate the reasons that observations don’t match
<ul>
<li>Investigating joins is a craft that takes some practice getting good at; this is essentially an exercise in exploratory data analysis for the purpose of data quality</li>
<li>First, you have to <em>care</em> about data quality</li>
<li>Identifying causes for non-matches usually involves consulting data documentation for both tables and performing basic descriptive statistics (e.g., frequency tables) on specific variables that documentation suggests may be relevant for whether observations match or not</li>
</ul></li>
</ul>
</details>
</section>
<section id="how-to-think-about-different-types-of-joins-and-perform-one" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="how-to-think-about-different-types-of-joins-and-perform-one"><span class="header-section-number">6.2</span> How to think about different types of joins and perform one</h2>
<p>We noticed that many students were having trouble with understanding the difference between the different types of joins and how to use them. We hope that this section can help clarify some of the frequently asked questions.</p>
<section id="types-of-joins" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="types-of-joins"><span class="header-section-number">6.2.1</span> Types of joins</h3>
<p>Oftentimes, we have a primary table that we are interested in - for example, a table of recruiting events where each observation is an event held at a specific location. In order to understand more about each event, we can join in other data sources to it, such as zip code level data obtained from the Census.</p>
<p><img src="http://r4ds.had.co.nz/diagrams/join-venn.png" class="img-fluid"></p>
<p><em>Source: <a href="https://r4ds.had.co.nz/relational-data.html#mutating-joins">R for Data Science</a> by Wickham</em></p>
<p>The main difference between the types of joins is which rows they keep from each of the 2 tables you are joining (i.e., what rows you see in the end result of the join). For example, if our recruiting events data is the <code>x</code> (left) table and zip code data is the <code>y</code> (right) table:</p>
<ul>
<li><strong>Inner join</strong>: The result only includes events at a zip code that has Census data available <strong>and</strong> Census zip codes where at least 1 event occurred
<ul>
<li>Any event at a zip code that does not have Census data <strong>and</strong> any Census zip code where no events occurred will be dropped</li>
</ul></li>
<li><strong>Left join</strong>: The result includes <em>all</em> recruiting events in our original table, whether or not Census data for the event’s zip code is available or not
<ul>
<li>Any Census zip code where no events occurred will be dropped</li>
</ul></li>
<li><strong>Right join</strong>: The result includes <em>all</em> zip codes in the Census data, whether or not any events occurred there
<ul>
<li>Any event at a zip code that does not have Census data will be dropped</li>
</ul></li>
<li><strong>Full join</strong>: The result includes <em>all</em> recruiting events in our original table <strong>and</strong> <em>all</em> zip codes in the Census data
<ul>
<li>No observations in either of the original tables will be dropped</li>
</ul></li>
</ul>
<p>When deciding which type of join to use, we need to consider what our focus is. Here, we want to analyze the recruiting events, so we would want the end result of our join to include all events in our original events table, where each event has zip code data attached when available. According to the bulleted list above, that would be a <strong>left join</strong> using the recruiting events data as the <code>x</code> (left) table and zip code data as the <code>y</code> (right) table.</p>
<p>What about an <strong>inner join</strong>? You may wonder, if we have an event at a zip code that does not have any zip code level data, what is the point of keeping that observation when we can’t conduct any analysis on zip code characteristics? The answer may depend on your goal for the join. But oftentimes, we are joining more than 2 tables. For example, we may want to join zip code level data, HS level data, and university level data to each event. Not all events will have a match in each of the 3 data sources, but left joins will allow us to keep all events in the end result regardless. This is useful because the recruiting events are our main focus, and we can then choose whichever type of analysis we want to perform (zip code, HS, or univ-level).</p>
</section>
<section id="deciding-on-x-and-y-table-in-a-join" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="deciding-on-x-and-y-table-in-a-join"><span class="header-section-number">6.2.2</span> Deciding on <code>x</code> and <code>y</code> table in a join</h3>
<p>As seen in the Venn diagram above, each join function takes in 2 arguments - we refer to the 1st arg <code>x</code> as the <strong>left table</strong> and the 2nd arg <code>y</code> as the <strong>right table</strong>. Which table we choose to be the <code>x</code> and which to be the <code>y</code> only matters when we are performing a left or right join, since inner and full joins are symmetrical.</p>
<p>In our previous example, if we use the recruiting events table for <code>x</code> and zip code table for <code>y</code>, then a <strong>left join</strong> will keep all observations in the recruiting events table and drop all Census zip codes where no events occurred. But if we were to use the zip code table for <code>x</code> and recruiting events table for <code>y</code>, then it would be a <strong>right join</strong> that keeps all recruiting events and drop any Census zip code where no events occurred.</p>
<p>Given the above 2 options to get the same results, performing a <strong>left join</strong> is more conventional and can be easier to visualize. For example, imagine performing a series of left joins to the recruiting events table (e.g., left join zip code level data to each event, left join HS level data to each event that occurred at a HS, left join university level data to each event that occurred at a university), we can think of it as continually chaining the tables from left to right.</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>