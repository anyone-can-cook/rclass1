<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">

<title>Into the tidyverse: dplyr, select, filter, and pipes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="into_the_tidyverse_files/libs/clipboard/clipboard.min.js"></script>
<script src="into_the_tidyverse_files/libs/quarto-html/quarto.js"></script>
<script src="into_the_tidyverse_files/libs/quarto-html/popper.min.js"></script>
<script src="into_the_tidyverse_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="into_the_tidyverse_files/libs/quarto-html/anchor.min.js"></script>
<link href="into_the_tidyverse_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="into_the_tidyverse_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="into_the_tidyverse_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="into_the_tidyverse_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="into_the_tidyverse_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#libraries-we-will-use-today" id="toc-libraries-we-will-use-today" class="nav-link" data-scroll-target="#libraries-we-will-use-today"><span class="header-section-number">1.1</span> Libraries we will use today</a></li>
  <li><a href="#data-for-sections-on-select-filter-and-arrange-functions" id="toc-data-for-sections-on-select-filter-and-arrange-functions" class="nav-link" data-scroll-target="#data-for-sections-on-select-filter-and-arrange-functions"><span class="header-section-number">1.2</span> Data for sections on <code>select()</code>, <code>filter()</code>, and <code>arrange()</code> functions</a></li>
  <li><a href="#data-for-sections-on-pipes-and-mutate-function" id="toc-data-for-sections-on-pipes-and-mutate-function" class="nav-link" data-scroll-target="#data-for-sections-on-pipes-and-mutate-function"><span class="header-section-number">1.3</span> Data for sections on pipes <code>%&gt;%</code> and <code>mutate()</code> function</a>
  <ul class="collapse">
  <li><a href="#data-frame-wwlist-prospects-purchased-by-western-washington-u." id="toc-data-frame-wwlist-prospects-purchased-by-western-washington-u." class="nav-link" data-scroll-target="#data-frame-wwlist-prospects-purchased-by-western-washington-u."><span class="header-section-number">1.3.1</span> Data frame <code>wwlist</code>, “prospects” purchased by Western Washington U.</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#investigating-data-patterns" id="toc-investigating-data-patterns" class="nav-link" data-scroll-target="#investigating-data-patterns"><span class="header-section-number">2</span> Investigating data patterns</a>
  <ul class="collapse">
  <li><a href="#introduction-to-the-dplyr-library" id="toc-introduction-to-the-dplyr-library" class="nav-link" data-scroll-target="#introduction-to-the-dplyr-library"><span class="header-section-number">2.0.1</span> Introduction to the <code>dplyr</code> library</a></li>
  <li><a href="#select-variables" id="toc-select-variables" class="nav-link" data-scroll-target="#select-variables"><span class="header-section-number">2.1</span> select() variables</a></li>
  <li><a href="#rename-variables" id="toc-rename-variables" class="nav-link" data-scroll-target="#rename-variables"><span class="header-section-number">2.2</span> Rename variables</a></li>
  <li><a href="#count-function" id="toc-count-function" class="nav-link" data-scroll-target="#count-function"><span class="header-section-number">2.3</span> <code>count()</code> function</a></li>
  <li><a href="#filter-rows" id="toc-filter-rows" class="nav-link" data-scroll-target="#filter-rows"><span class="header-section-number">2.4</span> filter() rows</a>
  <ul class="collapse">
  <li><a href="#logical-operators-for-comparisons" id="toc-logical-operators-for-comparisons" class="nav-link" data-scroll-target="#logical-operators-for-comparisons"><span class="header-section-number">2.4.1</span> Logical operators for comparisons</a></li>
  <li><a href="#filters-and-comparisons-demonstration" id="toc-filters-and-comparisons-demonstration" class="nav-link" data-scroll-target="#filters-and-comparisons-demonstration"><span class="header-section-number">2.4.2</span> Filters and comparisons, Demonstration</a></li>
  <li><a href="#filters-and-comparisons" id="toc-filters-and-comparisons" class="nav-link" data-scroll-target="#filters-and-comparisons"><span class="header-section-number">2.4.3</span> Filters and comparisons, <code>&gt;=</code></a></li>
  <li><a href="#filters-and-comparisons-not-equals" id="toc-filters-and-comparisons-not-equals" class="nav-link" data-scroll-target="#filters-and-comparisons-not-equals"><span class="header-section-number">2.4.4</span> Filters and comparisons, not equals (<code>!=</code>)</a></li>
  <li><a href="#filters-and-comparisons-in-operator" id="toc-filters-and-comparisons-in-operator" class="nav-link" data-scroll-target="#filters-and-comparisons-in-operator"><span class="header-section-number">2.4.5</span> Filters and comparisons, <code>%in%</code> operator</a></li>
  <li><a href="#identifying-data-type-and-possible-values-helpful-for-filtering" id="toc-identifying-data-type-and-possible-values-helpful-for-filtering" class="nav-link" data-scroll-target="#identifying-data-type-and-possible-values-helpful-for-filtering"><span class="header-section-number">2.4.6</span> Identifying data type and possible values helpful for filtering</a></li>
  <li><a href="#filtering-and-missing-values" id="toc-filtering-and-missing-values" class="nav-link" data-scroll-target="#filtering-and-missing-values"><span class="header-section-number">2.4.7</span> Filtering and missing values</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">2.4.8</span> Exercises</a></li>
  </ul></li>
  <li><a href="#arrange-rows-i.e.-sort-rows" id="toc-arrange-rows-i.e.-sort-rows" class="nav-link" data-scroll-target="#arrange-rows-i.e.-sort-rows"><span class="header-section-number">2.5</span> arrange() rows (i.e., sort rows)</a>
  <ul class="collapse">
  <li><a href="#arrange-function" id="toc-arrange-function" class="nav-link" data-scroll-target="#arrange-function"><span class="header-section-number">2.5.1</span> <code>arrange()</code> function</a></li>
  <li><a href="#arrange-missing-values-sorted-at-the-end" id="toc-arrange-missing-values-sorted-at-the-end" class="nav-link" data-scroll-target="#arrange-missing-values-sorted-at-the-end"><span class="header-section-number">2.5.2</span> <code>arrange()</code>, missing values sorted at the end</a></li>
  <li><a href="#exercise-arranging" id="toc-exercise-arranging" class="nav-link" data-scroll-target="#exercise-arranging"><span class="header-section-number">2.5.3</span> Exercise, arranging</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#pipes" id="toc-pipes" class="nav-link" data-scroll-target="#pipes"><span class="header-section-number">3</span> Pipes</a>
  <ul class="collapse">
  <li><a href="#what-are-pipes" id="toc-what-are-pipes" class="nav-link" data-scroll-target="#what-are-pipes"><span class="header-section-number">3.1</span> What are “pipes”, %&gt;%</a></li>
  <li><a href="#compare-data-tasks-with-and-without-pipes" id="toc-compare-data-tasks-with-and-without-pipes" class="nav-link" data-scroll-target="#compare-data-tasks-with-and-without-pipes"><span class="header-section-number">3.2</span> Compare data tasks, with and without pipes</a></li>
  <li><a href="#count-function-with-pipes" id="toc-count-function-with-pipes" class="nav-link" data-scroll-target="#count-function-with-pipes"><span class="header-section-number">3.3</span> <code>count()</code> function with pipes <code>%&gt;%</code></a></li>
  <li><a href="#pipe-operators-and-new-lines" id="toc-pipe-operators-and-new-lines" class="nav-link" data-scroll-target="#pipe-operators-and-new-lines"><span class="header-section-number">3.4</span> pipe operators and new lines</a></li>
  <li><a href="#the-power-of-pipes" id="toc-the-power-of-pipes" class="nav-link" data-scroll-target="#the-power-of-pipes"><span class="header-section-number">3.5</span> The power of pipes</a></li>
  <li><a href="#which-objects-and-functions-are-pipeable" id="toc-which-objects-and-functions-are-pipeable" class="nav-link" data-scroll-target="#which-objects-and-functions-are-pipeable"><span class="header-section-number">3.6</span> Which objects and functions are pipeable</a>
  <ul class="collapse">
  <li><a href="#practice-exercise-run-the-following-code-with-and-without-pipes-work-through-on-your-own" id="toc-practice-exercise-run-the-following-code-with-and-without-pipes-work-through-on-your-own" class="nav-link" data-scroll-target="#practice-exercise-run-the-following-code-with-and-without-pipes-work-through-on-your-own"><span class="header-section-number">3.6.1</span> Practice exercise: Run the following code with and without pipes [Work through on your own]</a></li>
  <li><a href="#student-exercises-with-pipes" id="toc-student-exercises-with-pipes" class="nav-link" data-scroll-target="#student-exercises-with-pipes"><span class="header-section-number">3.6.2</span> Student exercises with pipes</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#creating-variables-using-mutate" id="toc-creating-variables-using-mutate" class="nav-link" data-scroll-target="#creating-variables-using-mutate"><span class="header-section-number">4</span> Creating variables using mutate</a>
  <ul class="collapse">
  <li><a href="#introduce-mutate-function" id="toc-introduce-mutate-function" class="nav-link" data-scroll-target="#introduce-mutate-function"><span class="header-section-number">4.1</span> Introduce mutate() function</a></li>
  <li><a href="#mutate-to-create-multiple-variables-at-once" id="toc-mutate-to-create-multiple-variables-at-once" class="nav-link" data-scroll-target="#mutate-to-create-multiple-variables-at-once"><span class="header-section-number">4.2</span> <code>mutate()</code> to create multiple variables at once</a></li>
  <li><a href="#mutate-removing-variables-created-by-mutate" id="toc-mutate-removing-variables-created-by-mutate" class="nav-link" data-scroll-target="#mutate-removing-variables-created-by-mutate"><span class="header-section-number">4.3</span> <code>mutate()</code>, removing variables created by <code>mutate()</code></a>
  <ul class="collapse">
  <li><a href="#student-exercise-using-mutate" id="toc-student-exercise-using-mutate" class="nav-link" data-scroll-target="#student-exercise-using-mutate"><span class="header-section-number">4.3.1</span> Student exercise using mutate()</a></li>
  </ul></li>
  <li><a href="#using-if_else-function-within-mutate" id="toc-using-if_else-function-within-mutate" class="nav-link" data-scroll-target="#using-if_else-function-within-mutate"><span class="header-section-number">4.4</span> Using if_else() function within mutate()</a>
  <ul class="collapse">
  <li><a href="#if_else-within-mutate-to-create-01-indicator-variables" id="toc-if_else-within-mutate-to-create-01-indicator-variables" class="nav-link" data-scroll-target="#if_else-within-mutate-to-create-01-indicator-variables"><span class="header-section-number">4.4.1</span> <code>if_else()</code> within <code>mutate()</code> to create 0/1 indicator variables</a></li>
  <li><a href="#student-exercises-if_else" id="toc-student-exercises-if_else" class="nav-link" data-scroll-target="#student-exercises-if_else"><span class="header-section-number">4.4.2</span> Student exercises <code>if_else()</code></a></li>
  </ul></li>
  <li><a href="#using-recode-function-within-mutate" id="toc-using-recode-function-within-mutate" class="nav-link" data-scroll-target="#using-recode-function-within-mutate"><span class="header-section-number">4.5</span> Using recode() function within mutate()</a>
  <ul class="collapse">
  <li><a href="#student-exercise-using-recode-within-mutate" id="toc-student-exercise-using-recode-within-mutate" class="nav-link" data-scroll-target="#student-exercise-using-recode-within-mutate"><span class="header-section-number">4.5.1</span> Student exercise using <code>recode()</code> within <code>mutate()</code></a></li>
  </ul></li>
  <li><a href="#using-case_when-function-within-mutate" id="toc-using-case_when-function-within-mutate" class="nav-link" data-scroll-target="#using-case_when-function-within-mutate"><span class="header-section-number">4.6</span> Using case_when() function within mutate()</a>
  <ul class="collapse">
  <li><a href="#student-exercise-using-case_when-within-mutate" id="toc-student-exercise-using-case_when-within-mutate" class="nav-link" data-scroll-target="#student-exercise-using-case_when-within-mutate"><span class="header-section-number">4.6.1</span> Student exercise using <code>case_when()</code> within <code>mutate()</code></a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Into the tidyverse: dplyr, select, filter, and pipes</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<section id="libraries-we-will-use-today" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="libraries-we-will-use-today"><span class="header-section-number">1.1</span> Libraries we will use today</h2>
<p>“Load” the package we will use today (output omitted)</p>
<ul>
<li><strong>you must run this code chunk</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If package not yet installed, then must install before you load. Install in “console” rather than .qmd file</p>
<ul>
<li>Generic syntax: <code>install.packages("package_name")</code></li>
<li>Install “tidyverse”: <code>install.packages("tidyverse")</code></li>
</ul>
<p>Note: when we load package, name of package is not in quotes; but when we install package, name of package is in quotes:</p>
<ul>
<li><code>install.packages("tidyverse")</code></li>
<li><code>library(tidyverse)</code></li>
</ul>
</section>
<section id="data-for-sections-on-select-filter-and-arrange-functions" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="data-for-sections-on-select-filter-and-arrange-functions"><span class="header-section-number">1.2</span> Data for sections on <code>select()</code>, <code>filter()</code>, and <code>arrange()</code> functions</h2>
<p><strong>Load .Rdata data frames, <code>df_event</code> and <code>df_school</code></strong></p>
<p>Data on off-campus recruiting events by public universities</p>
<ul>
<li>Data frame object <code>df_event</code>
<ul>
<li>One observation per university, recruiting event</li>
</ul></li>
<li>Data frame object <code>df_school</code>
<ul>
<li>One observation per high school (visited and non-visited)</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># remove all objects in current environment</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "/Users/patriciamartin/Desktop/GitHub/rclass1-redesign/lectures/updated_lectures/into_the_tidyverse"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load dataset with one obs per recruiting event</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://github.com/ozanj/rclass/raw/master/data/recruiting/recruit_event_somevars.RData"</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#load("../../data/recruiting/recruit_event_somevars.Rdata")</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#load dataset with one obs per high school</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://github.com/ozanj/rclass/raw/master/data/recruiting/recruit_school_somevars.RData"</span>))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#load("../../data/recruiting/recruit_school_somevars.Rdata")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-for-sections-on-pipes-and-mutate-function" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="data-for-sections-on-pipes-and-mutate-function"><span class="header-section-number">1.3</span> Data for sections on pipes <code>%&gt;%</code> and <code>mutate()</code> function</h2>
<p><strong>Load .Rdata data frame <code>wwlist</code>, “prospects” purchased by Western Washington U.</strong></p>
<p>Note: we won’t use this data frame until the lecture section on “pipes”</p>
<ul>
<li>You can ignore <code>wwlist</code> data frame for lecture sections on select(), filter(), and arrange() functions</li>
</ul>
<p>The “Student list” business</p>
<ul>
<li>Universities identify/target “prospects” by buying “student lists” from College Board/ACT (e.g., $.50+ per prospect)</li>
<li>Prospect lists contain contact info (e.g., address, email), academic achievement, socioeconomic, demographic characteristics</li>
<li>Universities choose which prospects to purchase by filtering on criteria like zip-code, GPA, test score range, etc.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load prospect list data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://github.com/ozanj/rclass/raw/master/data/prospect_list/wwlist_merged.RData"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Object <code>wwlist</code></p>
<ul>
<li>De-identified list of prospective students purchased by Western Washington University from College Board</li>
<li>We collected these data using public records requests request</li>
</ul>
<section id="data-frame-wwlist-prospects-purchased-by-western-washington-u." class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="data-frame-wwlist-prospects-purchased-by-western-washington-u."><span class="header-section-number">1.3.1</span> Data frame <code>wwlist</code>, “prospects” purchased by Western Washington U.</h3>
<p>Observations on <code>wwlist</code></p>
<ul>
<li>each observation represents a prospective student</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(wwlist)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "list"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(wwlist)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 268396     41</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Variables on <code>wwlist</code></p>
<ul>
<li><p>some vars provide de-identified data on individual prospects</p>
<ul>
<li>e.g., <code>psat_range</code>, <code>state</code>, <code>sex</code>, <code>ethn_code</code></li>
</ul></li>
<li><p>some vars provide data about zip-code student lives in</p>
<ul>
<li>e.g., <code>med_inc</code>, <code>pop_total</code>, <code>pop_black</code></li>
</ul></li>
<li><p>some vars provide data about school student enrolled in</p>
<ul>
<li>e.g., <code>fr_lunch</code> is number of students on free/reduced lunch</li>
<li>note: bad merge between prospect-level data and school-level data</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(wwlist)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wwlist)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(wwlist) <span class="co"># tidyverse function, similar to str()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Variable <code>firstgen</code> identifies whether prospect is a first-generation college student</p>
<p>Imagine we want to isolate all the first-generation prospects</p>
<ol type="1">
<li>Investigate variable type/structure.</li>
</ol>
<ul>
<li>A dichotomous var, but stored as character in <code>wwlist</code>. So must use quotes (<code>''</code> or <code>""</code>) to filter/subset based on values of <code>firstgen</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wwlist<span class="sc">$</span>firstgen)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  chr [1:268396] NA "N" "N" "N" NA "N" "N" "Y" "Y" "N" "N" "N" "N" "N" "N" ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Create frequency table to identify possible values of <code>firstgen</code></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(wwlist<span class="sc">$</span>firstgen, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      N      Y   &lt;NA&gt; </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 193333  65046  10017</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Isolate all the first-gen prospects (output omitted)</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(wwlist, firstgen <span class="sc">==</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="investigating-data-patterns" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Investigating data patterns</h1>
<section id="introduction-to-the-dplyr-library" class="level3" data-number="2.0.1">
<h3 data-number="2.0.1" class="anchored" data-anchor-id="introduction-to-the-dplyr-library"><span class="header-section-number">2.0.1</span> Introduction to the <code>dplyr</code> library</h3>
<p><code>dplyr</code>, a package within the <code>tidyverse</code> suite of packages, provide tools for manipulating data frames</p>
<ul>
<li>Wickham describes functions within <code>dplyr</code> as a set of “verbs” that fall in the broader categories of <strong>subsetting</strong>, <strong>sorting</strong>, and <strong>transforming</strong></li>
</ul>
<table class="table">
<colgroup>
<col style="width: 34%">
<col style="width: 65%">
</colgroup>
<thead>
<tr class="header">
<th>Today</th>
<th>Upcoming weeks</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Subsetting data</strong></td>
<td><strong>Transforming data</strong></td>
</tr>
<tr class="even">
<td>- <code>select()</code> variables</td>
<td>- <code>mutate()</code> creates new variables</td>
</tr>
<tr class="odd">
<td>- <code>filter()</code> observations</td>
<td>- <code>summarize()</code> calculates across rows</td>
</tr>
<tr class="even">
<td><strong>Sorting data</strong></td>
<td>- <code>group_by()</code> to calculate across rows within groups</td>
</tr>
<tr class="odd">
<td>- <code>arrange()</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>All <code>dplyr</code> verbs (i.e., functions) work as follows</p>
<ol type="1">
<li>first argument is a data frame</li>
<li>subsequent arguments describe what to do with variables and observations in data frame
<ul>
<li>refer to variable names without quotes</li>
</ul></li>
<li>result of the function is a new data frame</li>
</ol>
</section>
<section id="select-variables" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="select-variables"><span class="header-section-number">2.1</span> select() variables</h2>
<p><strong>Select variables using <code>select()</code> function</strong></p>
<p>Printing observations is key to investigating data, but datasets often have hundreds, thousands of variables</p>
<p><code>select()</code> function selects <strong>columns</strong> of data (i.e., variables) you specify</p>
<ul>
<li>first argument is the name of data frame object</li>
<li>remaining arguments are variable names, which are separated by commas and without quotes</li>
</ul>
<p>Without <strong>assignment</strong> (<code>&lt;-</code>), <code>select()</code> by itself simply prints selected vars</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#?select</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(df_event,instnm,event_date,event_type,event_state,med_inc)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 18,680 × 5</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    instnm      event_date event_type event_state med_inc</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;date&gt;     &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 UM Amherst  2017-10-12 public hs  MA           71714.</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 UM Amherst  2017-10-04 public hs  MA           89122.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 UM Amherst  2017-10-25 public hs  MA           70136.</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 UM Amherst  2017-10-26 public hs  MA           70136.</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Stony Brook 2017-10-02 public hs  MA           71024.</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 USCC        2017-09-18 private hs MA           71024.</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 UM Amherst  2017-09-18 private hs MA           71024.</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 UM Amherst  2017-09-26 public hs  MA           97225 </span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 UM Amherst  2017-09-26 private hs MA           97225 </span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 UM Amherst  2017-10-12 public hs  MA           77800.</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 18,670 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Recall that all <code>dplyr</code> functions (e.g., <code>select()</code>) return a new data frame object</p>
<ul>
<li><strong>type</strong> equals “list”</li>
<li><strong>length</strong> equals number of vars you select</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fu">select</span>(df_event,instnm,event_date,event_type,event_state,med_inc))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "list"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">select</span>(df_event,instnm,event_date,event_type,event_state,med_inc))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>glimpse()</code>: tidyverse function for viewing data frames</p>
<ul>
<li>a cross between <code>str()</code> and simply printing data</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>?glimpse</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df_event)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>glimpse()</code> a <code>select()</code> set of variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(<span class="fu">select</span>(df_event,instnm,event_date,event_type,event_state,med_inc))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 18,680</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Columns: 5</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ instnm      &lt;chr&gt; "UM Amherst", "UM Amherst", "UM Amherst", "UM Amherst", "S…</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ event_date  &lt;date&gt; 2017-10-12, 2017-10-04, 2017-10-25, 2017-10-26, 2017-10-0…</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ event_type  &lt;chr&gt; "public hs", "public hs", "public hs", "public hs", "publi…</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ event_state &lt;chr&gt; "MA", "MA", "MA", "MA", "MA", "MA", "MA", "MA", "MA", "MA"…</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ med_inc     &lt;dbl&gt; 71713.5, 89121.5, 70136.5, 70136.5, 71023.5, 71023.5, 7102…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With <strong>assignment</strong> (<code>&lt;-</code>), <code>select()</code> creates a new object containing only the variables you specify</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>event_small <span class="ot">&lt;-</span> <span class="fu">select</span>(df_event,instnm,event_date,event_type,event_state,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  med_inc)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(event_small)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 18,680</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Columns: 5</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ instnm      &lt;chr&gt; "UM Amherst", "UM Amherst", "UM Amherst", "UM Amherst", "S…</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ event_date  &lt;date&gt; 2017-10-12, 2017-10-04, 2017-10-25, 2017-10-26, 2017-10-0…</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ event_type  &lt;chr&gt; "public hs", "public hs", "public hs", "public hs", "publi…</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ event_state &lt;chr&gt; "MA", "MA", "MA", "MA", "MA", "MA", "MA", "MA", "MA", "MA"…</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ med_inc     &lt;dbl&gt; 71713.5, 89121.5, 70136.5, 70136.5, 71023.5, 71023.5, 7102…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Select helper functions</strong></p>
<p><code>select()</code> can use “helper functions” <code>starts_with()</code>, <code>contains()</code>, and <code>ends_with()</code> to choose columns</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>?select</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#names(df_event)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(df_event,instnm,<span class="fu">starts_with</span>(<span class="st">"event"</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 18,680 × 8</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    instnm      event_date event_type event_state event_inst event_name          </span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;date&gt;     &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;               </span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 UM Amherst  2017-10-12 public hs  MA          In-State   Amherst-Pelham Regi…</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 UM Amherst  2017-10-04 public hs  MA          In-State   Hampshire County Co…</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 UM Amherst  2017-10-25 public hs  MA          In-State   Chicopee High Schoo…</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 UM Amherst  2017-10-26 public hs  MA          In-State   Chicopee Comprehens…</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Stony Brook 2017-10-02 public hs  MA          Out-State  Easthampton High Sc…</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 USCC        2017-09-18 private hs MA          Out-State  Williston Northampt…</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 UM Amherst  2017-09-18 private hs MA          In-State   Williston-Northampt…</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 UM Amherst  2017-09-26 public hs  MA          In-State   Granby Jr Sr High S…</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 UM Amherst  2017-09-26 private hs MA          In-State   MacDuffie School Vi…</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 UM Amherst  2017-10-12 public hs  MA          In-State   Smith Academy Visit </span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 18,670 more rows</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: event_location_name &lt;chr&gt;, event_datetime_start &lt;dttm&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--

### Exercise

The data frame `df_school` has one observation for each high school and indicators for whether the high school received a recruiting visit.

::: {.cell}

```{.r .cell-code}
names(df_school)
```
:::
1. Use `select()` to familiarize yourself with variables in the data frame
1. Practice using the `contains()` and `ends_with()` helper functions to to choose variables


-->
</section>
<section id="rename-variables" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="rename-variables"><span class="header-section-number">2.2</span> Rename variables</h2>
<p><code>rename()</code> function renames variables within a data frame object</p>
<p>Syntax:</p>
<ul>
<li><code>rename(obj_name, new_name = old_name,...)</code> </li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(df_event, <span class="at">g12_offered =</span> g12offered, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">titlei =</span> titlei_status_pub)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df_event)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Variable names do not change permanently unless we combine rename with assignment </p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>rename_event <span class="ot">&lt;-</span> <span class="fu">rename</span>(df_event, <span class="at">g12_offered =</span> g12offered, <span class="at">titlei =</span> titlei_status_pub)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rename_event)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(rename_event)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="count-function" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="count-function"><span class="header-section-number">2.3</span> <code>count()</code> function</h2>
<p><code>count()</code> function from <code>dplyr</code> package counts the unique values of one or more variables.</p>
<p><strong>Syntax</strong> [see help file for full syntax]</p>
<ul>
<li><code>count(x,...)</code></li>
</ul>
<p><strong>Arguments</strong> [see help file for full arguments]</p>
<ul>
<li><code>x</code>: an object, often a data frame</li>
<li><code>...</code>: variables to group by</li>
</ul>
<p>Examples of using <code>count()</code></p>
<ul>
<li>Without vars in <code>...</code> argument, counts number of obs in object</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(df_school)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># df_school %&gt;% count() # same as above but using pipes</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">count</span>(df_school))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># #df_school %&gt;% count() %&gt;% str() # same as above but using pipes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>With vars in <code>...</code> argument, counts number of obs per variable value</p>
<ul>
<li>This is the best way to create frequency table, better than <code>table()</code></li>
<li>note: by default, <code>count()</code> always shows <code>NAs</code> [this is good!]</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(df_school,school_type)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># df_school %&gt;% count(school_type) # same as above but using pipes</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">count</span>(df_school,school_type))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># df_school %&gt;% count(school_type) %&gt;% str() # same as above but using pipes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="filter-rows" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="filter-rows"><span class="header-section-number">2.4</span> filter() rows</h2>
<p><strong>The <code>filter()</code> function</strong></p>
<p><code>filter()</code> allows you to <strong>select observations</strong> based on values of variables</p>
<ul>
<li>Arguments
<ul>
<li>first argument is name of data frame</li>
<li>subsequent arguments are <em>logical expressions</em> to filter the data frame</li>
<li>Multiple expressions separated by commas work as <strong>AND</strong> operators (e.g., condtion 1 <code>TRUE</code> AND condition 2 <code>TRUE</code>)</li>
</ul></li>
<li>What is the result of a <code>filter()</code> command?
<ul>
<li><code>filter()</code> returns a data frame consisting of rows where the condition is <code>TRUE</code></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>?filter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Example from data frame object <code>df_school</code>, each obs is a high school</p>
<ul>
<li>Show all obs where the high school received 1 visit from UC Berkeley (110635) [output omitted]</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df_school,visits_by_110635 <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that resulting object is list, consisting of obs where condition <code>TRUE</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(df_school)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 21301</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">filter</span>(df_school,visits_by_110635 <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 528</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>The <code>filter()</code> function</strong></p>
<p><strong>Task</strong>: Count the number of high schools that received 1 visit from UC Berkeley.</p>
<p><strong>[dplyr]</strong> Using <code>filter()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">filter</span>(df_school, visits_by_110635 <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 528</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Filter, character variables</strong></p>
<p>Use single quotes <code>''</code> or double quotes <code>""</code> to refer to values of character variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(<span class="fu">select</span>(df_school, school_type, state_code))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 21,301</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Columns: 2</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ school_type &lt;chr&gt; "public", "public", "public", "public", "public", "public"…</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ state_code  &lt;chr&gt; "AK", "AK", "AK", "AK", "AK", "AK", "AK", "AK", "AK", "AK"…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Identify all private high schools in CA that got 1 visit by particular universities</p>
<ul>
<li>Visited once by UC Berkeley (ID=110635)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df_school,visits_by_110635 <span class="sc">==</span> <span class="dv">1</span>, school_type <span class="sc">==</span> <span class="st">"private"</span>, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>       state_code <span class="sc">==</span> <span class="st">"CA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Visited once by University of Alabama (ID=100751)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df_school,visits_by_100751 <span class="sc">==</span> <span class="dv">1</span>, school_type <span class="sc">==</span> <span class="st">"private"</span>, </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>       state_code <span class="sc">==</span> <span class="st">"CA"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Visited once by Berkeley and University of Alabama</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df_school,visits_by_100751 <span class="sc">==</span> <span class="dv">1</span>, visits_by_110635 <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>       school_type <span class="sc">==</span> <span class="st">"private"</span>, state_code <span class="sc">==</span> <span class="st">"CA"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Filter by multiple conditions</strong></p>
<p><strong>Task</strong>: Count the number of private high schools in CA that received 1 visit each from UC Berkeley and University of Alabama.</p>
<p>Using <code>filter()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">filter</span>(df_school, visits_by_100751 <span class="sc">==</span> <span class="dv">1</span>, visits_by_110635 <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>            school_type <span class="sc">==</span> <span class="st">"private"</span>, state_code <span class="sc">==</span> <span class="st">"CA"</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="logical-operators-for-comparisons" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="logical-operators-for-comparisons"><span class="header-section-number">2.4.1</span> Logical operators for comparisons</h3>
<p>logical operators useful for: filter obs w/ <code>filter()</code>; create variables w/ <code>mutate()</code></p>
<ul>
<li>logical operators also work when using Base R functions</li>
</ul>
<table class="table">
<thead>
<tr class="header">
<th>Operator symbol</th>
<th>Operator meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>==</code></td>
<td>Equal to</td>
</tr>
<tr class="even">
<td><code>!=</code></td>
<td>Not equal to</td>
</tr>
<tr class="odd">
<td><code>&gt;</code></td>
<td>greater than</td>
</tr>
<tr class="even">
<td><code>&gt;=</code></td>
<td>greater than or equal to</td>
</tr>
<tr class="odd">
<td><code>&lt;</code></td>
<td>less than</td>
</tr>
<tr class="even">
<td><code>&lt;=</code></td>
<td>less than or equal to</td>
</tr>
<tr class="odd">
<td><code>&amp;</code></td>
<td>AND</td>
</tr>
<tr class="even">
<td><code>|</code></td>
<td>OR</td>
</tr>
<tr class="odd">
<td><code>%in%</code></td>
<td>includes</td>
</tr>
</tbody>
</table>
<ul>
<li>Visualization of “Boolean” operators (e.g., AND, OR, AND NOT)</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="transform-logical.png" class="img-fluid figure-img" style="width:40.0%"></p>
<figcaption>“Boolean” operations, x=left circle, y=right circle, from Wichkam (2018)</figcaption>
</figure>
</div>
</section>
<section id="filters-and-comparisons-demonstration" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="filters-and-comparisons-demonstration"><span class="header-section-number">2.4.2</span> Filters and comparisons, Demonstration</h3>
<p>Schools visited by Bama (100751) and/or Berkeley (110635)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Berkeley AND Bama</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df_school,visits_by_100751 <span class="sc">&gt;=</span> <span class="dv">1</span>, visits_by_110635 <span class="sc">&gt;=</span> <span class="dv">1</span>) </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df_school,visits_by_100751 <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> visits_by_110635 <span class="sc">&gt;=</span> <span class="dv">1</span>) <span class="co"># same same</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Berkeley OR Bama</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df_school,visits_by_100751 <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">|</span> visits_by_110635 <span class="sc">&gt;=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Apply <code>count()</code> function on top of <code>filter()</code> function to count the number of observations that satisfy criteria</p>
<ul>
<li>Avoids printing individual observations</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of schools that get visit by Berkeley AND Bama</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_school, visits_by_100751 <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> visits_by_110635 <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   247</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of schools that get visit by Berkeley OR Bama</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_school, visits_by_100751 <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">|</span> visits_by_110635 <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  2763</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Note: You could also use any of the base R equivalents from the Base R lecture</li>
</ul>
</section>
<section id="filters-and-comparisons" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="filters-and-comparisons"><span class="header-section-number">2.4.3</span> Filters and comparisons, <code>&gt;=</code></h3>
<p>Number of public high schools that are at least 50% Black in Alabama compared to number of schools that received visit by Bama:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># at least 50% black</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_school, school_type <span class="sc">==</span> <span class="st">"public"</span>, pct_black <span class="sc">&gt;=</span> <span class="dv">50</span>, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>             state_code <span class="sc">==</span> <span class="st">"AL"</span>))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    86</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># at least 50% black and received visit by Bama</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_school, school_type <span class="sc">==</span> <span class="st">"public"</span>, pct_black <span class="sc">&gt;=</span> <span class="dv">50</span>, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>             state_code <span class="sc">==</span> <span class="st">"AL"</span>, visits_by_100751 <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    21</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Number of public high schools that are at least 50% White in Alabama compared to number of schools that received visit by Bama:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># at least 50% white</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_school, school_type <span class="sc">==</span> <span class="st">"public"</span>, pct_white <span class="sc">&gt;=</span> <span class="dv">50</span>, </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>             state_code <span class="sc">==</span> <span class="st">"AL"</span>))</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   238</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># at least 50% white and received visit by Bama</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_school, school_type <span class="sc">==</span> <span class="st">"public"</span>, pct_white <span class="sc">&gt;=</span> <span class="dv">50</span>, </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>             state_code <span class="sc">==</span> <span class="st">"AL"</span>, visits_by_100751 <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    82</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filters-and-comparisons-not-equals" class="level3" data-number="2.4.4">
<h3 data-number="2.4.4" class="anchored" data-anchor-id="filters-and-comparisons-not-equals"><span class="header-section-number">2.4.4</span> Filters and comparisons, not equals (<code>!=</code>)</h3>
<p>Count the number of high schools visited by University of Colorado (126614) that are not located in CO</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#number of high schools visited by U Colorado</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_school, visits_by_126614 <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  1056</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">#number of high schools visited by U Colorado not located in CO</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_school, visits_by_126614 <span class="sc">&gt;=</span> <span class="dv">1</span>, state_code <span class="sc">!=</span> <span class="st">"CO"</span>))</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   873</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co">#number of high schools visited by U Colorado located in CO</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">#count(filter(df_school, visits_by_126614 &gt;= 1, state_code == "CO"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filters-and-comparisons-in-operator" class="level3" data-number="2.4.5">
<h3 data-number="2.4.5" class="anchored" data-anchor-id="filters-and-comparisons-in-operator"><span class="header-section-number">2.4.5</span> Filters and comparisons, <code>%in%</code> operator</h3>
<p>What if you wanted to count the number of schools visited by Bama (100751) in a group of states?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_school,visits_by_100751 <span class="sc">&gt;=</span> <span class="dv">1</span>, state_code <span class="sc">==</span> <span class="st">"MA"</span> <span class="sc">|</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>               state_code <span class="sc">==</span> <span class="st">"VT"</span> <span class="sc">|</span> state_code <span class="sc">==</span> <span class="st">"ME"</span>))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   108</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Easier way to do this is with <code>%in%</code> operator</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_school,visits_by_100751 <span class="sc">&gt;=</span> <span class="dv">1</span>, state_code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MA"</span>,<span class="st">"ME"</span>,<span class="st">"VT"</span>)))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   108</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Select the private high schools that got either 2 or 3 visits from Bama</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_school, visits_by_100751 <span class="sc">%in%</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, school_type <span class="sc">==</span> <span class="st">"private"</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   183</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="identifying-data-type-and-possible-values-helpful-for-filtering" class="level3" data-number="2.4.6">
<h3 data-number="2.4.6" class="anchored" data-anchor-id="identifying-data-type-and-possible-values-helpful-for-filtering"><span class="header-section-number">2.4.6</span> Identifying data type and possible values helpful for filtering</h3>
<ul>
<li><code>typeof()</code> and <code>str()</code> shows internal data type of a variable</li>
<li><code>table()</code> to show potential values of categorical variables</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(df_event<span class="sc">$</span>event_type)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "character"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df_event<span class="sc">$</span>event_type)  <span class="co"># double quotes indicate character</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  chr [1:18680] "public hs" "public hs" "public hs" "public hs" "public hs" ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df_event<span class="sc">$</span>event_type, <span class="at">useNA=</span><span class="st">"always"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2yr college 4yr college       other  private hs   public hs        &lt;NA&gt; </span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         951         531        2001        3774       11423           0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(df_event<span class="sc">$</span>med_inc)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "double"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df_event<span class="sc">$</span>med_inc)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  num [1:18680] 71714 89122 70136 70136 71024 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we know <code>event_type</code> is a character, we can filter values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_event, event_type <span class="sc">==</span> <span class="st">"public hs"</span>, event_state <span class="sc">==</span><span class="st">"CA"</span>))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  1100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#below code would return an error because variables are character</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#count(filter(df_event, event_type == public hs, event_state ==CA))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-and-missing-values" class="level3" data-number="2.4.7">
<h3 data-number="2.4.7" class="anchored" data-anchor-id="filtering-and-missing-values"><span class="header-section-number">2.4.7</span> Filtering and missing values</h3>
<p>Wickham (2018) states:</p>
<ul>
<li>“<code>filter()</code> only includes rows where condition is TRUE; it excludes both <code>FALSE</code> and <code>NA</code> values. To preserve missing values, ask for them explicitly:”</li>
</ul>
<p>Investigate var <code>df_event$fr_lunch</code>, number of free/reduced lunch students</p>
<ul>
<li>only available for visits to public high schools</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#visits to public HS with less than 50 students on free/reduced lunch</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_event,event_type <span class="sc">==</span> <span class="st">"public hs"</span>, fr_lunch<span class="sc">&lt;</span><span class="dv">50</span>))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   910</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#visits to public HS, where free/reduced lunch missing</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_event,event_type <span class="sc">==</span> <span class="st">"public hs"</span>, <span class="fu">is.na</span>(fr_lunch)))</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    26</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#visits to public HS, where free/reduced is less than 50 OR is missing</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_event,event_type <span class="sc">==</span> <span class="st">"public hs"</span>, fr_lunch<span class="sc">&lt;</span><span class="dv">50</span> <span class="sc">|</span> <span class="fu">is.na</span>(fr_lunch)))</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   936</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercises" class="level3" data-number="2.4.8">
<h3 data-number="2.4.8" class="anchored" data-anchor-id="exercises"><span class="header-section-number">2.4.8</span> Exercises</h3>
<p>Use the data from df_event, which has one observation for each off-campus recruiting event a university attends</p>
<ol type="1">
<li>Count the number of events attended by the University of Pittsburgh (Pitt) <code>univ_id == 215293</code><br>
</li>
<li>Count the number of recruiting events by Pitt at public or private high schools<br>
</li>
<li>Count the number of recruiting events by Pitt at public or private high schools located in the state of PA<br>
</li>
<li>Count the number of recruiting events by Pitt at public high schools not located in PA where median income is less than 100,000<br>
</li>
<li>Count the number of recruiting events by Pitt at public high schools not located in PA where median income is greater than or equal to 100,000<br>
</li>
<li>Count the number of out-of-state recruiting events by Pitt at private high schools or public high schools with median income of at least 100,000</li>
</ol>
<details>
<summary>
<strong>Solutions</strong>
</summary>
<ol type="1">
<li>Count the number of events attended by the University of Pittsburgh (Pitt) <code>univ_id == 215293</code></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_event, univ_id <span class="sc">==</span> <span class="dv">215293</span>))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  1225</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Count the number of recruiting events by Pitt at public or private high schools</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df_event<span class="sc">$</span>event_type)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  chr [1:18680] "public hs" "public hs" "public hs" "public hs" "public hs" ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df_event<span class="sc">$</span>event_type, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2yr college 4yr college       other  private hs   public hs        &lt;NA&gt; </span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         951         531        2001        3774       11423           0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_event, univ_id <span class="sc">==</span> <span class="dv">215293</span>, event_type <span class="sc">==</span> <span class="st">"private hs"</span> <span class="sc">|</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>               event_type <span class="sc">==</span> <span class="st">"public hs"</span>))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  1030</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Count the number of recruiting events by Pitt at public or private high schools located in the state of PA</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_event, univ_id <span class="sc">==</span> <span class="dv">215293</span>, event_type <span class="sc">==</span> <span class="st">"private hs"</span> <span class="sc">|</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>               event_type <span class="sc">==</span> <span class="st">"public hs"</span>, event_state <span class="sc">==</span> <span class="st">"PA"</span>))</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   262</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Count the number of recruiting events by Pitt at public high schools not located in PA where median income is less than 100,000</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_event, univ_id <span class="sc">==</span> <span class="dv">215293</span>, event_type <span class="sc">==</span> <span class="st">"public hs"</span>,</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>             event_state <span class="sc">!=</span> <span class="st">"PA"</span>, med_inc <span class="sc">&lt;</span> <span class="dv">100000</span>))</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   213</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="5" type="1">
<li>Count the number of recruiting events by Pitt at public high schools not located in PA where median income is greater than or equal to 100,000</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_event, univ_id <span class="sc">==</span> <span class="dv">215293</span>, event_type <span class="sc">==</span> <span class="st">"public hs"</span>,</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>             event_state <span class="sc">!=</span> <span class="st">"PA"</span>, med_inc <span class="sc">&gt;=</span> <span class="dv">100000</span>))</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   344</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="6" type="1">
<li>Count the number of out-of-state recruiting events by Pitt at private high schools or public high schools with median income of at least 100,000</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(df_event, univ_id <span class="sc">==</span> <span class="dv">215293</span>, event_state <span class="sc">!=</span> <span class="st">"PA"</span>, </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>             (event_type <span class="sc">==</span> <span class="st">"public hs"</span> <span class="sc">&amp;</span> med_inc <span class="sc">&gt;=</span> <span class="dv">100000</span>) <span class="sc">|</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>               event_type <span class="sc">==</span> <span class="st">"private hs"</span>))</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   553</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p><br></p>
</section>
</section>
<section id="arrange-rows-i.e.-sort-rows" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="arrange-rows-i.e.-sort-rows"><span class="header-section-number">2.5</span> arrange() rows (i.e., sort rows)</h2>
<section id="arrange-function" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="arrange-function"><span class="header-section-number">2.5.1</span> <code>arrange()</code> function</h3>
<p><code>arrange()</code> function “arranges” rows in a data frame; said different, it sorts observations</p>
<p>Syntax: <code>arrange(x,...)</code></p>
<ul>
<li>First argument, <code>x</code>, is a data frame</li>
<li>Subsequent arguments are a “comma separated list of unquoted variable names”</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df_event</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(df_event, event_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Data frame goes back to previous order unless you <strong>assign</strong> the new order</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df_event</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>df_event <span class="ot">&lt;-</span> <span class="fu">arrange</span>(df_event, event_date)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>df_event</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Ascending and descending order</strong></p>
<ul>
<li><code>arrange()</code> sorts in <strong>ascending</strong> order by default</li>
<li>use <code>desc()</code> to sort a column by descending order</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(df_event, <span class="fu">desc</span>(event_date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Can sort by multiple variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(df_event, univ_id, <span class="fu">desc</span>(event_date), <span class="fu">desc</span>(med_inc))</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co">#sort by university and descending by size of 12th grade class; combine with select</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">arrange</span>(df_event, univ_id, <span class="fu">desc</span>(g12)),instnm,event_type,event_date,g12)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="arrange-missing-values-sorted-at-the-end" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="arrange-missing-values-sorted-at-the-end"><span class="header-section-number">2.5.2</span> <code>arrange()</code>, missing values sorted at the end</h3>
<p>Missing values automatically sorted at the end, regardless of whether you sort ascending or descending</p>
<p>Below, we sort by university, then by date of event, then by ID of high school</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">#by university, date, ascending school id</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">arrange</span>(df_event, univ_id, <span class="fu">desc</span>(event_date), school_id),</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>       instnm,event_date,event_type,school_id)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="co">#by university, date, descending school id</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">arrange</span>(df_event, univ_id, <span class="fu">desc</span>(event_date), <span class="fu">desc</span>(school_id)),</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>       instnm,event_date,event_type,school_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Can sort by <code>is.na</code> to put missing values first</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">arrange</span>(df_event, univ_id, <span class="fu">desc</span>(event_date), <span class="fu">desc</span>(<span class="fu">is.na</span>(school_id))),</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>       instnm,event_date,event_type,school_id)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 18,680 × 4</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    instnm event_date event_type school_id   </span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;chr&gt;      &lt;chr&gt;       </span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Bama   2017-12-18 other      &lt;NA&gt;        </span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Bama   2017-12-18 private hs A9106483    </span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Bama   2017-12-15 other      &lt;NA&gt;        </span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Bama   2017-12-15 public hs  484473005095</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Bama   2017-12-15 public hs  062927004516</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Bama   2017-12-14 other      &lt;NA&gt;        </span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Bama   2017-12-13 other      &lt;NA&gt;        </span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Bama   2017-12-13 public hs  130387001439</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Bama   2017-12-13 private hs 00071151    </span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Bama   2017-12-13 public hs  063386005296</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 18,670 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercise-arranging" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="exercise-arranging"><span class="header-section-number">2.5.3</span> Exercise, arranging</h3>
<p>Use the data from df_event, which has one observation for each off-campus recruiting event a university attends</p>
<ol type="1">
<li>Sort ascending by “univ_id” and descending by “event_date”<br>
</li>
<li>Select four variables in total and sort ascending by “univ_id” and descending by “event_date”<br>
</li>
<li>Now using the same variables from above, sort by <code>is.na</code> to put missing values in “school_id” first</li>
</ol>
<details>
<summary>
<strong>Solutions</strong>
</summary>
<ol type="1">
<li>Sort ascending by “univ_id” and descending by “event_date”<br>
</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(df_event, univ_id, <span class="fu">desc</span>(event_date))</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 18,680 × 33</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    instnm univ_id instst   pid event_date event_type zip   school_id    ipeds_id</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;  &lt;int&gt; &lt;date&gt;     &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;           &lt;int&gt;</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Bama    100751 AL      7115 2017-12-18 private hs 77089 A9106483           NA</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Bama    100751 AL      7121 2017-12-18 other      &lt;NA&gt;  &lt;NA&gt;               NA</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Bama    100751 AL      7114 2017-12-15 public hs  75165 484473005095       NA</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Bama    100751 AL      7100 2017-12-15 public hs  93012 062927004516       NA</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Bama    100751 AL      7073 2017-12-15 other      98027 &lt;NA&gt;               NA</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Bama    100751 AL      7072 2017-12-14 other      98007 &lt;NA&gt;               NA</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Bama    100751 AL      7118 2017-12-13 public hs  31906 130387001439       NA</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Bama    100751 AL      7099 2017-12-13 private hs 90293 00071151           NA</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Bama    100751 AL      7109 2017-12-13 public hs  92630 063386005296       NA</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Bama    100751 AL      7071 2017-12-13 other      98032 &lt;NA&gt;               NA</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 18,670 more rows</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 24 more variables: event_state &lt;chr&gt;, event_inst &lt;chr&gt;, med_inc &lt;dbl&gt;,</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   pop_total &lt;dbl&gt;, pct_white_zip &lt;dbl&gt;, pct_black_zip &lt;dbl&gt;,</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   pct_asian_zip &lt;dbl&gt;, pct_hispanic_zip &lt;dbl&gt;, pct_amerindian_zip &lt;dbl&gt;,</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   pct_nativehawaii_zip &lt;dbl&gt;, pct_tworaces_zip &lt;dbl&gt;,</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   pct_otherrace_zip &lt;dbl&gt;, fr_lunch &lt;dbl&gt;, titlei_status_pub &lt;fct&gt;,</span></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   total_12 &lt;dbl&gt;, school_type_pri &lt;int&gt;, school_type_pub &lt;int&gt;, …</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Select four variables in total and sort ascending by “univ_id” and descending by “event_date”<br>
</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">arrange</span>(df_event, univ_id, <span class="fu">desc</span>(event_date)), univ_id, event_date, </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>       instnm, event_type)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 18,680 × 4</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    univ_id event_date instnm event_type</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;     </span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  100751 2017-12-18 Bama   private hs</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  100751 2017-12-18 Bama   other     </span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  100751 2017-12-15 Bama   public hs </span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  100751 2017-12-15 Bama   public hs </span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  100751 2017-12-15 Bama   other     </span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  100751 2017-12-14 Bama   other     </span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  100751 2017-12-13 Bama   public hs </span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  100751 2017-12-13 Bama   private hs</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  100751 2017-12-13 Bama   public hs </span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  100751 2017-12-13 Bama   other     </span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 18,670 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Select the variables “univ_id”, “event_date”, and “school_id” and sort by <code>is.na</code> to put missing values in “school_id” first.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">arrange</span>(df_event, univ_id, <span class="fu">desc</span>(event_date), <span class="fu">desc</span>(<span class="fu">is.na</span>(school_id))), </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>       univ_id, event_date, school_id)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 18,680 × 3</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    univ_id event_date school_id   </span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt; &lt;date&gt;     &lt;chr&gt;       </span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1  100751 2017-12-18 &lt;NA&gt;        </span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2  100751 2017-12-18 A9106483    </span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3  100751 2017-12-15 &lt;NA&gt;        </span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4  100751 2017-12-15 484473005095</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5  100751 2017-12-15 062927004516</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6  100751 2017-12-14 &lt;NA&gt;        </span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7  100751 2017-12-13 &lt;NA&gt;        </span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8  100751 2017-12-13 130387001439</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9  100751 2017-12-13 00071151    </span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10  100751 2017-12-13 063386005296</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 18,670 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p><br></p>
</section>
</section>
</section>
<section id="pipes" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Pipes</h1>
<section id="what-are-pipes" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="what-are-pipes"><span class="header-section-number">3.1</span> What are “pipes”, %&gt;%</h2>
<p><strong>Pipes</strong> are a means of performing multiple steps in a single line of code</p>
<ul>
<li>When writing code, the pipe symbol is <code>%&gt;%</code></li>
<li>The pipe operator <code>%&gt;%</code> is created by the <strong>magrittr</strong> package, which is not part of base R</li>
<li>However, the magrittr package is automatically loaded when you load the tidyverse package</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>?magrittr<span class="sc">::</span><span class="st">`</span><span class="at">%&gt;%</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>pipe syntax: <code>LHS %&gt;% RHS</code></p>
<ul>
<li><code>LHS</code> (refers to “left hand side” of the pipe) is an object or function</li>
<li><code>RHS</code> (refers to “right hand side” of the pipe) is a function</li>
</ul>
<p>How pipes work:</p>
<ul>
<li>Object created by <code>LHS</code> becomes the first argument of the function (<code>RHS</code>) to the right of the <code>%&gt;%</code> pipe symbol</li>
<li>Basic code flow: <code>object %&gt;% function1 %&gt;% function2 %&gt;% function3</code><br>
</li>
<li>Output of <code>some_function1</code> becomes the input (the first argument) of the function <code>some_function2</code> to the right of the <code>%&gt;%</code> pipe symbol</li>
</ul>
<p>Example of using pipes to calculate mean value of atomic vector</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="co"># an atomic vector</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="co"># calculate mean without pipes</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">%&gt;%</span> <span class="fu">mean</span>() <span class="co"># calculate mean with pipes</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>no pipe: (1) write function; (2) data object <code>1:10</code> is 1st argument of <code>mean()</code></li>
<li>pipe: (1) write data object; (2) “pipe” (verb) object as 1st argument of <code>mean()</code></li>
</ul>
<p>Intuitive mnemonic device for understanding pipes</p>
<ul>
<li>whenever you see a pipe <code>%&gt;%</code> think of the words “<strong>and then…</strong>”</li>
</ul>
<p>Example: isolate all the first-generation prospects [output omitted]</p>
<ul>
<li>in words: start with object <code>wwlist</code> <strong>and then</strong> filter first generation students</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>below code in words:</p>
<ul>
<li>start with <code>wwlist</code> <strong>and then</strong> select a few vars <strong>and then</strong> filter <strong>and then</strong> sort <strong>and then</strong> investigate the structure of object</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">select</span>(firstgen, state, med_inc_zip) <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>, state <span class="sc">==</span> <span class="st">"WA"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(med_inc_zip)) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; tibble [32,428 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ firstgen   : chr [1:32428] "Y" "Y" "Y" "Y" ...</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ state      : chr [1:32428] "WA" "WA" "WA" "WA" ...</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ med_inc_zip: num [1:32428] 216720 216720 216720 216720 216720 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Example: apply “structure” function <code>str()</code> to <code>wwlist</code> with and without pipes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wwlist) <span class="co"># without pipe</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">str</span>() <span class="co"># with pipe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I use the <code>str()</code> when I add new <code>%&gt;%</code>; shows what kind of object being piped in</p>
<ul>
<li>task: select a few vars from <code>wwlist</code>; isolate first-gen students in WA; sort descending by income (output omitted)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">select</span>(firstgen, state, med_inc_zip) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">select</span>(firstgen, state, med_inc_zip) <span class="sc">%&gt;%</span> </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>, state <span class="sc">==</span> <span class="st">"WA"</span>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">select</span>(firstgen, state, med_inc_zip) <span class="sc">%&gt;%</span> </span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>, state <span class="sc">==</span> <span class="st">"WA"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(med_inc_zip)) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compare-data-tasks-with-and-without-pipes" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="compare-data-tasks-with-and-without-pipes"><span class="header-section-number">3.2</span> Compare data tasks, with and without pipes</h2>
<p>Task: Using object <code>wwlist</code> print data for “first-gen” prospects (<code>firstgen == "Y"</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># without pipes</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(wwlist, firstgen <span class="sc">==</span> <span class="st">"Y"</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># with pipes</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Comparing the two approaches:</p>
<ul>
<li>“without pipes”, object <code>wwlist</code> is the first argument <code>filter()</code> function</li>
<li>In “pipes” approach, you don’t specify object <code>wwlist</code> as first argument in <code>filter()</code>
<ul>
<li>Why? Because <code>%&gt;%</code> “pipes” the object to the left of the <code>%&gt;%</code> operator into the function to the right of the <code>%&gt;%</code> operator</li>
</ul></li>
</ul>
<p><strong>Task</strong>: Using object <code>wwlist</code>, print data for “first-gen” prospects for selected variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Without pipes</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">filter</span>(wwlist, firstgen <span class="sc">==</span> <span class="st">"Y"</span>), state, hs_city, sex)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co">#With pipes</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(state, hs_city, sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Comparing the two approaches:</strong></p>
<ul>
<li>In the “without pipes” approach, code is written “inside out”
<ul>
<li>The first step in the task – identifying the object – is the innermost part of code</li>
<li>The last step in task – selecting variables to print – is the outermost part of code</li>
</ul></li>
<li>In “pipes” approach the left-to-right order of code matches how we think about the task
<ul>
<li>First, we start with an object <strong><em>and then</em></strong> (<code>%&gt;%</code>) we use <code>filter()</code> to isolate first-gen students <strong><em>and then</em></strong> (<code>%&gt;%</code>) we select which variables to print</li>
</ul></li>
</ul>
<p><code>str()</code> helpful to understand object piped in from one function to another</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">#object that was "piped" into `select()` from `filter()`</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co">#object that was created after `select()` function</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(state, hs_city, sex) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="count-function-with-pipes" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="count-function-with-pipes"><span class="header-section-number">3.3</span> <code>count()</code> function with pipes <code>%&gt;%</code></h2>
<p>Recall <code>count()</code> function from <code>dplyr</code> package counts the number of obs by group</p>
<p><strong>Syntax</strong> [see help file for full syntax]</p>
<ul>
<li><code>count(x,...)</code></li>
</ul>
<p><strong>Arguments</strong> [see help file for full arguments]</p>
<ul>
<li><code>x</code>: an object, often a data frame</li>
<li><code>...</code>: variables to group by</li>
</ul>
<p>Examples of using <code>count()</code></p>
<ul>
<li>Without vars in <code>...</code> argument, counts number of obs in object</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(wwlist)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">count</span>() <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>With vars in <code>...</code> argument, counts number of obs per variable value</p>
<ul>
<li>This is the best way to create frequency table, better than <code>table()</code></li>
<li>note: by default, <code>count()</code> always shows <code>NAs</code> [this is good!]</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(wwlist,school_category)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">count</span>(school_category)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">count</span>(school_category) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pipe-operators-and-new-lines" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="pipe-operators-and-new-lines"><span class="header-section-number">3.4</span> pipe operators and new lines</h2>
<p>Often want to insert line breaks to make long line of code more readable</p>
<ul>
<li>When inserting line breaks, <strong>pipe operator <code>%&gt;%</code> should be the last thing before a line break, not the first thing after a line break</strong></li>
</ul>
<p><strong>This works</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, hs_city, sex) <span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>This works too</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>,</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>                  state <span class="sc">!=</span> <span class="st">"WA"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, hs_city, sex) <span class="sc">%&gt;%</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>This doesn’t work</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>) </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">%&gt;%</span> <span class="fu">select</span>(state, hs_city, sex) </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">%&gt;%</span> <span class="fu">count</span>(sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-power-of-pipes" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="the-power-of-pipes"><span class="header-section-number">3.5</span> The power of pipes</h2>
<p>You might be thinking, “what’s the big deal?”</p>
<p><strong>Task</strong>:</p>
<ul>
<li>in one line of code, modify <code>wwlist</code> and create bar chart that counts number of prospects purchased by race/ethnicity, separately for in-state vs.&nbsp;out-of-state</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span>  <span class="fu">filter</span>(<span class="fu">is.na</span>(state)<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co"># drop obs where variable state missing</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co"># create out-of-state indicator; create recoded ethnicity var</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">out_state =</span> <span class="fu">as_factor</span>(<span class="fu">if_else</span>(state <span class="sc">!=</span> <span class="st">"WA"</span>, <span class="st">"out-of-state"</span>, <span class="st">"in-state"</span>)),</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ethn_race =</span> <span class="fu">recode</span>(ethn_code,</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"american indian or alaska native"</span> <span class="ot">=</span> <span class="st">"nativeam"</span>,</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"asian or native hawaiian or other pacific islander"</span> <span class="ot">=</span> <span class="st">"api"</span>,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"black or african american"</span> <span class="ot">=</span> <span class="st">"black"</span>,</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cuban"</span> <span class="ot">=</span> <span class="st">"latinx"</span>,</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"mexican/mexican american"</span> <span class="ot">=</span> <span class="st">"latinx"</span>,</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"not reported"</span> <span class="ot">=</span> <span class="st">"not_reported"</span>,</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"other-2 or more"</span> <span class="ot">=</span> <span class="st">"multirace"</span>,</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"other spanish/hispanic"</span> <span class="ot">=</span> <span class="st">"latinx"</span>,</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"puerto rican"</span> <span class="ot">=</span> <span class="st">"latinx"</span>,</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"white"</span> <span class="ot">=</span> <span class="st">"white"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(out_state) <span class="sc">%&gt;%</span> <span class="co"># group_by "in-state" vs. "out-of-state"</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(ethn_race) <span class="sc">%&gt;%</span>  <span class="co"># count of number of prospects purchased by race</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>ethn_race, <span class="at">y=</span>n)) <span class="sc">+</span>  <span class="co"># plot</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"number of prospects"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"race/ethnicity"</span>) <span class="sc">+</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>() <span class="sc">+</span>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> out_state) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Task</strong>:</p>
<ul>
<li>in one line of code, modify <code>wwlist</code> and create bar chart of median income (in zip-code) of prospects purchased by race/ethnicity, separately for in-state vs.&nbsp;out-of-state</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span>  <span class="fu">filter</span>(<span class="fu">is.na</span>(state)<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co"># drop obs where variable state missing</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co"># create out-of-state indicator; create recoded ethnicity var</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">out_state =</span> <span class="fu">as_factor</span>(<span class="fu">if_else</span>(state <span class="sc">!=</span> <span class="st">"WA"</span>, <span class="st">"out-of-state"</span>, <span class="st">"in-state"</span>)),</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ethn_race =</span> <span class="fu">recode</span>(ethn_code,</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"american indian or alaska native"</span> <span class="ot">=</span> <span class="st">"nativeam"</span>,</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"asian or native hawaiian or other pacific islander"</span> <span class="ot">=</span> <span class="st">"api"</span>,</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"black or african american"</span> <span class="ot">=</span> <span class="st">"black"</span>,</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cuban"</span> <span class="ot">=</span> <span class="st">"latinx"</span>,</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"mexican/mexican american"</span> <span class="ot">=</span> <span class="st">"latinx"</span>,</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"not reported"</span> <span class="ot">=</span> <span class="st">"not_reported"</span>,</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"other-2 or more"</span> <span class="ot">=</span> <span class="st">"multirace"</span>,</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"other spanish/hispanic"</span> <span class="ot">=</span> <span class="st">"latinx"</span>,</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"puerto rican"</span> <span class="ot">=</span> <span class="st">"latinx"</span>,</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"white"</span> <span class="ot">=</span> <span class="st">"white"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(out_state, ethn_race) <span class="sc">%&gt;%</span> <span class="co"># group_by "out-state" and ethnicity</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">avg_inc_zip =</span> <span class="fu">mean</span>(med_inc_zip, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="co"># calculate avg. inc</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>out_state, <span class="at">y=</span>avg_inc_zip)) <span class="sc">+</span> </span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"avg. income in zip code"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>() <span class="sc">+</span>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> ethn_race) <span class="co"># plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Example R script from Ben Skinner, which creates analysis data for <a href="https://link.springer.com/article/10.1007%2Fs11162-018-9507-1">Skinner (2018)</a></p>
<ul>
<li><a href="https://github.com/btskinner/colchoice_rep/blob/master/scripts/makedata.r">Link to R script</a></li>
</ul>
<p>Other relevant links</p>
<ul>
<li><a href="https://github.com/btskinner/colchoice_rep">Link to Github repository for Skinner (2018)</a></li>
<li><a href="https://link.springer.com/article/10.1007%2Fs11162-018-9507-1">Link to published paper</a></li>
<li><a href="https://github.com/btskinner">Link to Skinner’s Github page</a>
<ul>
<li>A lot of cool stuff here</li>
</ul></li>
<li><a href="https://www.btskinner.io/">Link to Skinner’s personal website</a>
<ul>
<li>A lot of cool stuff here</li>
</ul></li>
</ul>
</section>
<section id="which-objects-and-functions-are-pipeable" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="which-objects-and-functions-are-pipeable"><span class="header-section-number">3.6</span> Which objects and functions are pipeable</h2>
<p>Which objects and functions are “pipeable” (i.e., work with pipes)</p>
<ul>
<li>function is pipeable if it takes a data object as first argument and returns an object of same type</li>
<li>In general, doesn’t seem to be any limit on which kinds of objects are pipeable (could be atomic vector, list, data frame)</li>
</ul>
<div class="cell" data-result="hide">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># applying pipes to atomic vectors</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">%&gt;%</span> mean</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">%&gt;%</span> mean <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  num 5.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But some pipeable functions restrict which kinds of data objects they accept</p>
<ul>
<li>In particular, the <code>dplyr</code> functions (e.g., <code>filter</code>, <code>arrange</code>, etc.) expect the first argument to be a data frame.</li>
<li><code>dpylr</code> functions won’t even accept a list as first argument, even though data frames are a particular class of list</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(wwlist)  <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(wwlist) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="fu">as.list</span>(wwlist)  <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="co"># as.list(wwlist) %&gt;% filter(firstgen == "Y") %&gt;% str() # error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="practice-exercise-run-the-following-code-with-and-without-pipes-work-through-on-your-own" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="practice-exercise-run-the-following-code-with-and-without-pipes-work-through-on-your-own"><span class="header-section-number">3.6.1</span> Practice exercise: Run the following code with and without pipes [Work through on your own]</h3>
<p>Task:</p>
<ul>
<li>Count the number “first-generation” prospects from the state of Washington</li>
</ul>
<p>Without pipes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(wwlist, firstgen <span class="sc">==</span> <span class="st">"Y"</span>, state <span class="sc">==</span> <span class="st">"WA"</span>))</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 32428</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With pipes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>, state <span class="sc">==</span> <span class="st">"WA"</span>) <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 32428</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Task</strong>: frequency table of <code>school_type</code> for non first-gen prospects from WA</p>
<p><strong>Without pipes</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="ot">&lt;-</span> <span class="fu">filter</span>(wwlist, firstgen <span class="sc">==</span> <span class="st">"N"</span>, state <span class="sc">==</span> <span class="st">"WA"</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(wwlist_temp<span class="sc">$</span>school_type, <span class="at">useNA =</span> <span class="st">"always"</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; private  public    &lt;NA&gt; </span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      11   46146   12489</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(wwlist_temp) <span class="co"># cuz we don't need after creating table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>With pipes</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"N"</span>, state <span class="sc">==</span> <span class="st">"WA"</span>) <span class="sc">%&gt;%</span> <span class="fu">count</span>(school_type)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   school_type     n</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 private        11</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 public      46146</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 &lt;NA&gt;        12489</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Comparison of two approaches</strong></p>
<ul>
<li>without pipes, task requires multiple lines of code (this is quite common)
<ul>
<li>first line creates object; second line analyzes object</li>
</ul></li>
<li>with pipes, task can be completed in one line of code and you aren’t left with objects you don’t care about</li>
</ul>
</section>
<section id="student-exercises-with-pipes" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="student-exercises-with-pipes"><span class="header-section-number">3.6.2</span> Student exercises with pipes</h3>
<ol type="1">
<li><p>Using object <code>wwlist</code> select the following variables (state, firstgen, ethn_code) and assign <code>&lt;-</code> them to object <code>wwlist_temp</code>. (ex. wwlist_temp &lt;- wwlist)</p></li>
<li><p>Using the object you just created <code>wwlist_temp</code>, create a frequency table of <code>ethn_code</code> for first-gen prospects from California.</p></li>
<li><p><strong>Bonus</strong>: Try doing question 1 and 2 together. Use original object <code>wwlist</code>, but do not assign to a new object.</p></li>
</ol>
<p>Once finished you can <code>rm(wwlist_temp)</code></p>
<details>
<summary>
<strong>Solutions pipes <code>%&gt;%</code></strong>
</summary>
<ol type="1">
<li>Using object <code>wwlist</code> select the following variables (state, firstgen, ethn_code) and assign them to object <code>wwlist_temp</code></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="ot">&lt;-</span> wwlist <span class="sc">%&gt;%</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, firstgen, ethn_code) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Using the object you just created <code>wwlist_temp</code>, create a frequency table of <code>ethn_code</code> for first-gen prospects from California.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co">#names(wwlist)</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="sc">%&gt;%</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>, state <span class="sc">==</span> <span class="st">"CA"</span>) <span class="sc">%&gt;%</span> <span class="fu">count</span>(ethn_code)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    ethn_code                                              n</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;                                              &lt;int&gt;</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 american indian or alaska native                       4</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 asian or native hawaiian or other pacific islander    86</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 black or african american                             10</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 cuban                                                  1</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 mexican/mexican american                             643</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 not reported                                         113</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 other spanish/hispanic                               179</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 other-2 or more                                     4197</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 puerto rican                                           8</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 white                                               2933</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li><strong>Bonus</strong>: Try doing question 1 and 2 together.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, firstgen, ethn_code) <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(firstgen <span class="sc">==</span> <span class="st">"Y"</span>, state <span class="sc">==</span> <span class="st">"CA"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(ethn_code)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    ethn_code                                              n</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;                                              &lt;int&gt;</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 american indian or alaska native                       4</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 asian or native hawaiian or other pacific islander    86</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 black or african american                             10</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 cuban                                                  1</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 mexican/mexican american                             643</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 not reported                                         113</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 other spanish/hispanic                               179</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 other-2 or more                                     4197</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 puerto rican                                           8</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 white                                               2933</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(wwlist_temp)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(wwlist_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p><br></p>
</section>
</section>
</section>
<section id="creating-variables-using-mutate" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Creating variables using mutate</h1>
<p>We will load the data frame <strong><code>df_school_all</code></strong>. This data frame is based on data from the recruiting project. It contains one observation per US high school and variables identifying the number of visits by particular universities.</p>
<p><strong>Data frame <code>df_school_all</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://github.com/ozanj/rclass/raw/master/data/recruiting/recruit_school_allvars.RData"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Our plan for learning how to create new variables</strong></p>
<p>Recall that <code>dplyr</code> package within <code>tidyverse</code> provide a set of functions that can be described as “verbs”: <strong>subsetting</strong>, <strong>sorting</strong>, and <strong>transforming</strong></p>
<table class="table">
<colgroup>
<col style="width: 36%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th>What we’ve done</th>
<th>Where we’re going</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Subsetting data</strong></td>
<td><strong>Transforming data</strong></td>
</tr>
<tr class="even">
<td>- <code>select()</code> variables</td>
<td>- <code>mutate()</code> creates new variables</td>
</tr>
<tr class="odd">
<td>- <code>filter()</code> observations</td>
<td>- <code>summarize()</code> calculates across rows</td>
</tr>
<tr class="even">
<td><strong>Sorting data</strong></td>
<td>- <code>group_by()</code> to calculate across rows within groups</td>
</tr>
<tr class="odd">
<td>- <code>arrange()</code></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Today</strong></p>
<ul>
<li>We’ll use <code>mutate()</code> to create new variables based on calculations across columns within a row</li>
</ul>
<p><strong>Next week</strong></p>
<ul>
<li>We’ll combine <code>mutate()</code> with <code>summarize()</code> and <code>group_by()</code> to create variables based on calculations across rows</li>
</ul>
<p><strong>Create new data frame based on <code>df_school_all</code></strong></p>
<p>Recall, data frame <code>df_school_all</code> has one obs per US high school and then variables identifying number of visits by particular universities</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df_school_all)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] "state_code"         "school_type"        "ncessch"           </span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [4] "name"               "address"            "city"              </span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7] "zip_code"           "pct_white"          "pct_black"         </span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [10] "pct_hispanic"       "pct_asian"          "pct_amerindian"    </span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] "pct_other"          "num_fr_lunch"       "total_students"    </span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [16] "num_took_math"      "num_prof_math"      "num_took_rla"      </span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [19] "num_prof_rla"       "avgmedian_inc_2564" "latitude"          </span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [22] "longitude"          "visits_by_196097"   "visits_by_186380"  </span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [25] "visits_by_215293"   "visits_by_201885"   "visits_by_181464"  </span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [28] "visits_by_139959"   "visits_by_218663"   "visits_by_100751"  </span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [31] "visits_by_199193"   "visits_by_110635"   "visits_by_110653"  </span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [34] "visits_by_126614"   "visits_by_155317"   "visits_by_106397"  </span></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [37] "visits_by_149222"   "visits_by_166629"   "total_visits"      </span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [40] "inst_196097"        "inst_186380"        "inst_215293"       </span></span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [43] "inst_201885"        "inst_181464"        "inst_139959"       </span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [46] "inst_218663"        "inst_100751"        "inst_199193"       </span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [49] "inst_110635"        "inst_110653"        "inst_126614"       </span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [52] "inst_155317"        "inst_106397"        "inst_149222"       </span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [55] "inst_166629"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create new version of data frame, called <code>school_v2</code>, which we’ll use to introduce how to create new variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="ot">&lt;-</span> df_school_all <span class="sc">%&gt;%</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"inst_"</span>)) <span class="sc">%&gt;%</span> <span class="co"># remove vars that start with "inst_"</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>( <span class="co"># rename selected variables</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_berkeley =</span> visits_by_110635,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_boulder =</span> visits_by_126614,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_bama =</span> visits_by_100751,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_stonybrook =</span> visits_by_196097,</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_rutgers =</span> visits_by_186380,</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_pitt =</span> visits_by_215293,</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_cinci =</span> visits_by_201885,</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_nebraska =</span> visits_by_181464,</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_georgia =</span> visits_by_139959,</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_scarolina =</span> visits_by_218663,</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_ncstate =</span> visits_by_199193,</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_irvine =</span> visits_by_110653,</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_kansas =</span> visits_by_155317,</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_arkansas =</span> visits_by_106397,</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_sillinois =</span> visits_by_149222,</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">visits_by_umass =</span> visits_by_166629,</span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_took_read =</span> num_took_rla,</span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_prof_read =</span> num_prof_rla,</span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">med_inc =</span> avgmedian_inc_2564</span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(school_v2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="introduce-mutate-function" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="introduce-mutate-function"><span class="header-section-number">4.1</span> Introduce mutate() function</h2>
<p><code>mutate()</code> is <strong>dplyr</strong> approach to creating variables (not <strong>Base R</strong> approach)</p>
<p>Description of <code>mutate()</code></p>
<ul>
<li>Creates new columns (variables) that are functions of existing columns</li>
<li>After creating a new variable using <code>mutate()</code>, every row of data is retained</li>
<li><code>mutate()</code> works best with pipes <code>%&gt;%</code></li>
</ul>
<p><strong>Investigate <code>mutate()</code> syntax</strong></p>
<p><strong>Usage (i.e., syntax)</strong></p>
<ul>
<li><code>mutate(.data,...)</code></li>
</ul>
<p><strong>Arguments</strong></p>
<ul>
<li><code>.data</code>: a data frame
<ul>
<li>if using <code>mutate()</code> after pipe operator <code>%&gt;%</code>, then this argument can be omitted
<ul>
<li>Why? Because data frame object to left of <code>%&gt;%</code> “piped in” to first argument of <code>mutate()</code></li>
</ul></li>
</ul></li>
<li><code>...</code>: expressions used to create new variables
<ul>
<li>“Name-value pairs of expressions”</li>
<li>“The name of each argument will be the name of a new variable, and the value will be its corresponding value.”</li>
<li>“Use a <code>NULL</code> value in mutate to drop a variable.”</li>
<li>“New variables overwrite existing variables of the same name”</li>
</ul></li>
</ul>
<p><strong>Value</strong></p>
<ul>
<li>returns a (data frame) object that contains the original input data frame and new variables that were created by <code>mutate()</code></li>
</ul>
<p><strong>Task</strong>:</p>
<ul>
<li>Using data frame <code>school_v2</code> create new variable that measures the pct of students on free/reduced lunch (output omitted)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create new dataset with fewer vars; not necessary to do this</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>school_sml <span class="ot">&lt;-</span> school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ncessch, school_type, num_fr_lunch, total_students)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="co">#print obs </span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(school_sml, <span class="dv">10</span>)</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="co"># create new var</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>school_sml <span class="sc">%&gt;%</span> </span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_fr_lunch =</span> num_fr_lunch<span class="sc">/</span>total_students) </span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a><span class="co">#362/501</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a><span class="co"># remove data frame object</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(school_sml) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Can create variables using standard mathematical or logical operators</strong> [output omitted]</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co">#glimpse(school_v2)</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_code,school_type,ncessch,med_inc,num_fr_lunch,total_students,num_took_math) <span class="sc">%&gt;%</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co"># each argument creates a new variable, name of argument is name of variable</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">one =</span> <span class="dv">1</span>,</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">med_inc000 =</span> med_inc<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_fr_lunch =</span> num_fr_lunch<span class="sc">/</span>total_students<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">took_math_na =</span> <span class="fu">is.na</span>(num_took_math)<span class="sc">==</span><span class="dv">1</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_code,school_type,ncessch,one,med_inc,med_inc000,num_fr_lunch,total_students,pct_fr_lunch,num_took_math,took_math_na)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Can create variables using “helper functions” called within <code>mutate()</code></strong> [output omitted]</p>
<ul>
<li>These are standalone functions can be called <em>within</em> <code>mutate()</code>
<ul>
<li>e.g., <code>if_else()</code>, <code>recode()</code>, <code>case_when()</code></li>
</ul></li>
<li>will walk through helper functions in more detail in subsequent sections of lecture</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_code,ncessch,name,school_type) <span class="sc">%&gt;%</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">public =</span> <span class="fu">if_else</span>(school_type <span class="sc">==</span> <span class="st">"public"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>New variable not retained unless we <strong>assign</strong> <code>&lt;-</code> it to an object (existing or new)</p>
<ul>
<li><strong><code>mutate()</code> without assignment</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">pct_fr_lunch =</span> num_fr_lunch<span class="sc">/</span>total_students)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(school_v2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><strong><code>mutate()</code> with assignment</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>school_v2_temp <span class="ot">&lt;-</span> school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_fr_lunch =</span> num_fr_lunch<span class="sc">/</span>total_students)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(school_v2_temp)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(school_v2_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mutate-to-create-multiple-variables-at-once" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="mutate-to-create-multiple-variables-at-once"><span class="header-section-number">4.2</span> <code>mutate()</code> to create multiple variables at once</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_fr_lunch =</span> num_fr_lunch<span class="sc">/</span>total_students,</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">pct_prof_math=</span> num_prof_math<span class="sc">/</span>num_took_math) <span class="sc">%&gt;%</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(num_fr_lunch, total_students, pct_fr_lunch, </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>         num_prof_math, num_took_math, pct_prof_math)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or we could write code this way:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(num_fr_lunch, total_students, num_prof_math, num_took_math) <span class="sc">%&gt;%</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_fr_lunch =</span> num_fr_lunch<span class="sc">/</span>total_students,</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pct_prof_math=</span> num_prof_math<span class="sc">/</span>num_took_math) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>mutate()</code> can use variables previously created within <code>mutate()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(num_prof_math, num_took_math, num_took_read,num_prof_read) <span class="sc">%&gt;%</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_prof_math =</span> num_prof_math<span class="sc">/</span>num_took_math,</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pct_prof_read =</span> num_prof_read<span class="sc">/</span>num_took_read,</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">avg_pct_prof_math_read =</span> (pct_prof_math <span class="sc">+</span> pct_prof_read)<span class="sc">/</span><span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mutate-removing-variables-created-by-mutate" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="mutate-removing-variables-created-by-mutate"><span class="header-section-number">4.3</span> <code>mutate()</code>, removing variables created by <code>mutate()</code></h2>
<p>Within <code>mutate()</code> use syntax <code>var_name = NULL</code> to remove variable from data frame</p>
<ul>
<li>note: Variable not permanently removed from data frame unless you use assignment <code>&lt;-</code> to create new data frame or overwrite existing data frame</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(school_v2)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(num_prof_math, num_took_math, num_took_read,num_prof_read) <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(num_prof_math, num_took_math, num_took_read,num_prof_read) <span class="sc">%&gt;%</span> </span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_prof_math =</span> <span class="cn">NULL</span>, <span class="at">num_took_math =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="co">#But variables not permanently removed because we didn't use assignment</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(school_v2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Why would we remove variables within <code>mutate()</code> rather <code>select()</code>?</p>
<ul>
<li>remove temporary “work” variables used to create desired variable</li>
<li>Example: measure of average of pct who passed math and pct who passed reading</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(num_prof_math, num_took_math, num_took_read,num_prof_read) <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_prof_math =</span> num_prof_math<span class="sc">/</span>num_took_math, <span class="co"># create work var</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pct_prof_read =</span> num_prof_read<span class="sc">/</span>num_took_read, <span class="co"># create work var</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">avg_pct_prof_math_read =</span> (pct_prof_math <span class="sc">+</span> pct_prof_read)<span class="sc">/</span><span class="dv">2</span>, <span class="co">#create analysis var</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">pct_prof_math =</span> <span class="cn">NULL</span>, <span class="co"># remove work var</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">pct_prof_read =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span> <span class="co"># remove work var</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="student-exercise-using-mutate" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="student-exercise-using-mutate"><span class="header-section-number">4.3.1</span> Student exercise using mutate()</h3>
<ol type="1">
<li><p>Using the object <code>school_v2</code>, select the following variables (<code>num_prof_math</code>, <code>num_took_math</code>, <code>num_prof_read</code>, <code>num_took_read</code>) and create a measure of percent proficient in math <code>pct_prof_math</code> and percent proficient in reading <code>pct_prof_read</code>.</p></li>
<li><p>Now using the code for question 1, filter schools where at least 50% of students are proficient in math <strong>&amp;</strong> reading.</p></li>
<li><p>Count the number of schools from question 2.</p></li>
<li><p>Using <code>school_v2</code>, using <code>mutate()</code> combined with <code>is.na()</code> create a dichotomous indicator variable <code>med_inc_na</code> that identifies whether <code>med_inc</code> is missing (<code>NA</code>) or not. And then use syntax <code>count(var_name)</code> to create frequency table of variable <code>med_inc_na</code>. How many observations are missing?</p></li>
</ol>
<details>
<summary>
<strong>Solutions for exercise using <code>mutate()</code></strong>
</summary>
<ol type="1">
<li>Using the object <code>school_v2</code>, select the following variables (<code>num_prof_math</code>, <code>num_took_math</code>, <code>num_prof_read</code>, <code>num_took_read</code>) and create a measure of percent proficient in math <code>pct_prof_math</code> and percent proficient in reading <code>pct_prof_read</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(num_prof_math, num_took_math, num_prof_read, num_took_read) <span class="sc">%&gt;%</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_prof_math =</span> num_prof_math<span class="sc">/</span>num_took_math,</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pct_prof_read =</span> num_prof_read<span class="sc">/</span>num_took_read) </span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 21,301 × 6</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    num_prof_math num_took_math num_prof_read num_took_read pct_prof_math</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1         24.8            146         25.0            147         0.17 </span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2          1.7             17          1.7             17         0.1  </span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3          3.5             14          3.5             14         0.25 </span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4          3               30          3               30         0.1  </span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5          2.8             28          2.8             28         0.1  </span></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6          2.5             25          2.4             24         0.1  </span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7          1.55            62          1.55            62         0.025</span></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8          2.1             21          2.2             22         0.1  </span></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9          2.3             23          2.3             23         0.1  </span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10          1.9             19          1.9             19         0.1  </span></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 21,291 more rows</span></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 1 more variable: pct_prof_read &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Now using the code for question 1, filter schools where at least 50% of students are proficient in math <strong>&amp;</strong> reading.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(num_prof_math, num_took_math, num_prof_read, num_took_read) <span class="sc">%&gt;%</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_prof_math =</span> num_prof_math<span class="sc">/</span>num_took_math,</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pct_prof_read =</span> num_prof_read<span class="sc">/</span>num_took_read) <span class="sc">%&gt;%</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pct_prof_math <span class="sc">&gt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> pct_prof_read <span class="sc">&gt;=</span> <span class="fl">0.5</span>) </span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 7,760 × 6</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    num_prof_math num_took_math num_prof_read num_took_read pct_prof_math</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1         135.            260         149.            261         0.52 </span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2         299.            475         418             475         0.63 </span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3         213.            410         332.            410         0.52 </span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4          54.6           105          96.6           105         0.52 </span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5         111.            121         118.            121         0.92 </span></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6        1057.           1994        1477.           2204         0.53 </span></span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7         100.            103         125.            128         0.975</span></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8          56.4            99          84.4           148         0.57 </span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9         445.            586         392.            594         0.76 </span></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10          56.0            59          53.1            61         0.95 </span></span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 7,750 more rows</span></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 1 more variable: pct_prof_read &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Count the number of schools from question 2.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(num_prof_math, num_took_math, num_prof_read, num_took_read) <span class="sc">%&gt;%</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_prof_math =</span> num_prof_math<span class="sc">/</span>num_took_math,</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pct_prof_read =</span> num_prof_read<span class="sc">/</span>num_took_read) <span class="sc">%&gt;%</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pct_prof_math <span class="sc">&gt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> pct_prof_read <span class="sc">&gt;=</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  7760</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Using <code>school_v2</code>, using <code>mutate()</code> combined with <code>is.na()</code> create a dichotomous indicator variable <code>med_inc_na</code> that identifies whether <code>med_inc</code> is missing (<code>NA</code>) or not. And then use syntax <code>count(var_name)</code> to create frequency table of variable <code>med_inc_na</code>. How many observations are missing?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">med_inc_na =</span> <span class="fu">is.na</span>(med_inc)) <span class="sc">%&gt;%</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(med_inc_na)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   med_inc_na     n</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;lgl&gt;      &lt;int&gt;</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 FALSE      20677</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 TRUE         624</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p><br></p>
</section>
</section>
<section id="using-if_else-function-within-mutate" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="using-if_else-function-within-mutate"><span class="header-section-number">4.4</span> Using if_else() function within mutate()</h2>
<p><strong>Description</strong></p>
<ul>
<li>if <code>&lt;condition&gt;</code> <code>TRUE</code>, assign value; if <code>&lt;condition&gt;</code> <code>FALSE</code> assign value</li>
</ul>
<p><strong>Usage (i.e., syntax)</strong></p>
<ul>
<li><code>if_else(logical condition, true, false, missing = NULL)</code></li>
</ul>
<p><strong>Arguments</strong></p>
<ul>
<li><code>logical condition</code>: a condition that evaluates to <code>TRUE</code> or <code>FALSE</code></li>
<li><code>true</code>: value to assign if condition <code>TRUE</code></li>
<li><code>false</code>: value to assign if condition <code>FALSE</code></li>
<li><code>missing</code>: value to assign to rows that have value <code>NA</code> for condition
<ul>
<li>default is <code>missing = NULL</code>; means that if condition is <code>NA</code>, then new_var == <code>NA</code></li>
<li>But can assign different values to <code>NA</code>s, e.g., <code>missing = -9</code></li>
</ul></li>
</ul>
<p><strong>Value</strong></p>
<ul>
<li>“Where condition is TRUE, the matching value from true, where it’s FALSE, the matching value from false, otherwise NA.”</li>
<li>Unless otherwise specified, <code>NA</code>s in “input” var(s) assigned <code>NA</code> in “output var”</li>
</ul>
<p><strong>Example</strong>: Create 0/1 indicator of whether got at least one visit from Berkeley</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">got_visit_berkeley =</span> <span class="fu">if_else</span>(visits_by_berkeley<span class="sc">&gt;</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(got_visit_berkeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="if_else-within-mutate-to-create-01-indicator-variables" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="if_else-within-mutate-to-create-01-indicator-variables"><span class="header-section-number">4.4.1</span> <code>if_else()</code> within <code>mutate()</code> to create 0/1 indicator variables</h3>
<p>We often create dichotomous (0/1) indicator variables of whether something happened (or whether something is TRUE)</p>
<ul>
<li>Variables that are of substantive interest to project
<ul>
<li>e.g., did student graduate from college</li>
</ul></li>
<li>Variables that help you investigate data, check quality
<ul>
<li>e.g., indicator of whether an observation is missing/non-missing for a particular variable</li>
</ul></li>
</ul>
<p><strong>Task</strong></p>
<ul>
<li>Create 0/1 indicator if school has median income greater than $100,000</li>
</ul>
<p>Usually a good idea to investigate “input” variables <strong>before</strong> creating analysis vars</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(school_v2<span class="sc">$</span>med_inc) <span class="co"># investigate variable type</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">count</span>(med_inc) <span class="co"># frequency count, but this isn't very helpful</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(med_inc)) <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="co"># shows number of obs w/ missing med_inc</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(med_inc) <span class="sc">%&gt;%</span> </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inc_gt_100k=</span> <span class="fu">if_else</span>(med_inc<span class="sc">&gt;</span><span class="dv">100000</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(inc_gt_100k) <span class="co"># note how NA values of med_inc treated</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   inc_gt_100k     n</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1           0 18632</span></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2           1  2045</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3          NA   624</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Task</strong>:</p>
<ul>
<li>Create 0/1 indicator if school has median income greater than $100,000.</li>
</ul>
<p>This time, let’s experiment with the <code>missing</code> argument of <code>if_else()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co">#what we wrote before</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(med_inc) <span class="sc">%&gt;%</span> </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inc_gt_100k=</span> <span class="fu">if_else</span>(med_inc<span class="sc">&gt;</span><span class="dv">100000</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(inc_gt_100k)</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="co">#manually write out the default value for `missing`</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(med_inc) <span class="sc">%&gt;%</span> </span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inc_gt_100k=</span> <span class="fu">if_else</span>(med_inc<span class="sc">&gt;</span><span class="dv">100000</span>,<span class="dv">1</span>,<span class="dv">0</span>, <span class="at">missing =</span> <span class="cn">NULL</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(inc_gt_100k) <span class="co"># note how NA values of med_inc treated</span></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(med_inc) <span class="sc">%&gt;%</span> </span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inc_gt_100k=</span> <span class="fu">if_else</span>(med_inc<span class="sc">&gt;</span><span class="dv">100000</span>,<span class="dv">1</span>,<span class="dv">0</span>, <span class="at">missing =</span> <span class="cn">NA_real_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(inc_gt_100k) <span class="co"># note how NA values of med_inc treated</span></span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a><span class="co"># NA can be coerced to any other vector type except raw: </span></span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a><span class="co"># NA_integer_, NA_real_, NA_complex_ and NA_character_</span></span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-17"><a href="#cb125-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we give missing values in condition the value of -9 in new variable</span></span>
<span id="cb125-18"><a href="#cb125-18" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(med_inc) <span class="sc">%&gt;%</span> </span>
<span id="cb125-19"><a href="#cb125-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inc_gt_100k=</span> <span class="fu">if_else</span>(med_inc<span class="sc">&gt;</span><span class="dv">100000</span>,<span class="dv">1</span>,<span class="dv">0</span>, <span class="at">missing =</span> <span class="sc">-</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb125-20"><a href="#cb125-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(inc_gt_100k) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Task</strong></p>
<ul>
<li>Create 0/1 indicator variable <code>nonmiss_math</code> which indicates whether school has non-missing values for the variable <code>num_took_math</code>
<ul>
<li>note: <code>num_took_math</code> refers to number of students at a school that took state math proficiency test</li>
</ul></li>
</ul>
<p>Usually a good to investigate “input” variables before creating analysis vars</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">count</span>(num_took_math) <span class="co"># this isn't very helpful</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(num_took_math)) <span class="sc">%&gt;%</span> <span class="fu">count</span>(num_took_math) <span class="co"># shows number of obs w/ missing num_took_math</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(num_took_math) <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nonmiss_math=</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(num_took_math),<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(nonmiss_math) <span class="co"># note how NA values treated</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   nonmiss_math     n</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1            0  4103</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2            1 17198</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="student-exercises-if_else" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="student-exercises-if_else"><span class="header-section-number">4.4.2</span> Student exercises <code>if_else()</code></h3>
<ol type="1">
<li>Using the object <code>school_v2</code>, create 0/1 indicator variable <code>in_state_berkeley</code> that equals <code>1</code> if the high school is in the same state as UC Berkeley (i.e., <code>state_code=="CA"</code>).<br>
</li>
<li>Create 0/1 indicator <code>berkeley_and_irvine</code> of whether a school got at least one visit from UC Berkeley <strong>AND</strong> from UC Irvine.<br>
</li>
<li>Create 0/1 indicator <code>berkeley_or_irvine</code> of whether a school got at least one visit from UC Berkeley <strong>OR</strong> from UC Irvine.</li>
</ol>
<details>
<summary>
<strong>Solutions <code>if_else()</code></strong>
</summary>
<ol type="1">
<li>Using the object <code>school_v2</code>, create 0/1 indicator variable <code>in_state_berkeley</code> that equals <code>1</code> if the high school is in the same state as UC Berkeley (i.e., <code>state_code=="CA"</code>).</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(school_v2<span class="sc">$</span>state_code) <span class="co"># investigate input variable</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(state_code)) <span class="sc">%&gt;%</span> <span class="fu">count</span>() <span class="co"># investigate input var</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Create var</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">in_state_berkeley=</span><span class="fu">if_else</span>(state_code<span class="sc">==</span><span class="st">"CA"</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(in_state_berkeley)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Create 0/1 indicator <code>berkeley_and_irvine</code> of whether a school got at least one visit from UC Berkeley <strong>AND</strong> from UC Irvine.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co">#investigate input vars</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(visits_by_berkeley, visits_by_irvine) <span class="sc">%&gt;%</span> <span class="fu">str</span>() </span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(visits_by_berkeley)) <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(visits_by_irvine)) <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="co">#create variable</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">berkeley_and_irvine=</span><span class="fu">if_else</span>(visits_by_berkeley<span class="sc">&gt;</span><span class="dv">0</span> </span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>    <span class="sc">&amp;</span> visits_by_irvine<span class="sc">&gt;</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(berkeley_and_irvine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Create 0/1 indicator <code>berkeley_or_irvine</code> of whether a school got at least one visit from UC Berkeley <strong>OR</strong> from UC Irvine.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">berkeley_or_irvine=</span><span class="fu">if_else</span>(visits_by_berkeley<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">|</span> visits_by_irvine<span class="sc">&gt;</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(berkeley_or_irvine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p><br></p>
</section>
</section>
<section id="using-recode-function-within-mutate" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="using-recode-function-within-mutate"><span class="header-section-number">4.5</span> Using recode() function within mutate()</h2>
<p><strong>Description</strong>: Recodes values of a variable</p>
<p><strong>Usage (i.e., syntax)</strong></p>
<ul>
<li>recode(.x, …, .default = NULL, .missing = NULL)</li>
</ul>
<p><strong>Arguments</strong> [see help file for further details]</p>
<ul>
<li><code>.x</code> A vector (e.g., variable) to modify</li>
<li><code>...</code> Specifications for recode, of form <code>current_value = new_recoded_value</code></li>
<li><code>.default</code>: If supplied, all values not otherwise matched given this value.</li>
<li><code>.missing</code>: If supplied, any missing values in .x replaced by this value.</li>
</ul>
<p><strong>Example</strong>: Using data frame <code>wwlist</code>, create new 0/1 indicator <code>public_school</code> from variable <code>school_type</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wwlist<span class="sc">$</span>school_type)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">count</span>(school_type)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="ot">&lt;-</span> wwlist <span class="sc">%&gt;%</span> <span class="fu">select</span>(school_type) <span class="sc">%&gt;%</span> </span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">public_school =</span> <span class="fu">recode</span>(school_type,<span class="st">"public"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"private"</span> <span class="ot">=</span> <span class="dv">0</span>))</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n=</span><span class="dv">10</span>)</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wwlist_temp<span class="sc">$</span>public_school) <span class="co"># note: numeric variable</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="sc">%&gt;%</span> <span class="fu">count</span>(public_school) <span class="co"># note the NAs</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(wwlist_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Recoding <code>school_type</code> could have been accomplished using <code>if_else()</code></p>
<ul>
<li>Use <code>recode()</code> when new variable has more than two categories</li>
</ul>
<p><strong>Task</strong>: Create <code>school_catv2</code> based on <code>school_category</code> with these categories:</p>
<ul>
<li>“regular”; “alternative”; “special”; “vocational”</li>
</ul>
<p>Investigate input var</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wwlist<span class="sc">$</span>school_category) <span class="co"># character variable</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">count</span>(school_category) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Recode</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="ot">&lt;-</span> wwlist <span class="sc">%&gt;%</span> <span class="fu">select</span>(school_category) <span class="sc">%&gt;%</span> </span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">school_catv2 =</span> <span class="fu">recode</span>(school_category,</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Alternative Education School"</span> <span class="ot">=</span> <span class="st">"alternative"</span>,</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Alternative/other"</span> <span class="ot">=</span> <span class="st">"alternative"</span>,</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Regular elementary or secondary"</span> <span class="ot">=</span> <span class="st">"regular"</span>,</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Regular School"</span> <span class="ot">=</span> <span class="st">"regular"</span>,</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Special Education School"</span> <span class="ot">=</span> <span class="st">"special"</span>,</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Special program emphasis"</span> <span class="ot">=</span> <span class="st">"special"</span>,</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Vocational Education School"</span> <span class="ot">=</span> <span class="st">"vocational"</span>)</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wwlist_temp<span class="sc">$</span>school_catv2) <span class="co"># character variable created</span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="sc">%&gt;%</span> <span class="fu">count</span>(school_catv2)</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(wwlist_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Task</strong>: Create <code>school_catv2</code> based on <code>school_category</code> with these categories:</p>
<ul>
<li>“regular”; “alternative”; “special”; “vocational”</li>
<li>This time use the <code>.missing</code> argument to recode <code>NAs</code> to “unknown”</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="ot">&lt;-</span> wwlist <span class="sc">%&gt;%</span> <span class="fu">select</span>(school_category) <span class="sc">%&gt;%</span> </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">school_catv2 =</span> <span class="fu">recode</span>(school_category,</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Alternative Education School"</span> <span class="ot">=</span> <span class="st">"alternative"</span>,</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Alternative/other"</span> <span class="ot">=</span> <span class="st">"alternative"</span>,</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Regular elementary or secondary"</span> <span class="ot">=</span> <span class="st">"regular"</span>,</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Regular School"</span> <span class="ot">=</span> <span class="st">"regular"</span>,</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Special Education School"</span> <span class="ot">=</span> <span class="st">"special"</span>,</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Special program emphasis"</span> <span class="ot">=</span> <span class="st">"special"</span>,</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Vocational Education School"</span> <span class="ot">=</span> <span class="st">"vocational"</span>,</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.missing =</span> <span class="st">"unknown"</span>)</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wwlist_temp<span class="sc">$</span>school_catv2)</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="sc">%&gt;%</span> <span class="fu">count</span>(school_catv2)</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">count</span>(school_category)</span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(wwlist_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Task</strong>: Create <code>school_catv2</code> based on <code>school_category</code> with these categories:</p>
<ul>
<li>“regular”; “alternative”; “special”; “vocational”</li>
<li>This time use the <code>.default</code> argument to assign the value “regular”</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="ot">&lt;-</span> wwlist <span class="sc">%&gt;%</span> <span class="fu">select</span>(school_category) <span class="sc">%&gt;%</span> </span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">school_catv2 =</span> <span class="fu">recode</span>(school_category,</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Alternative Education School"</span> <span class="ot">=</span> <span class="st">"alternative"</span>,</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Alternative/other"</span> <span class="ot">=</span> <span class="st">"alternative"</span>,</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Special Education School"</span> <span class="ot">=</span> <span class="st">"special"</span>,</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Special program emphasis"</span> <span class="ot">=</span> <span class="st">"special"</span>,</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Vocational Education School"</span> <span class="ot">=</span> <span class="st">"vocational"</span>,</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">"regular"</span>)</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wwlist_temp<span class="sc">$</span>school_catv2)</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="sc">%&gt;%</span> <span class="fu">count</span>(school_catv2)</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">count</span>(school_category)</span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(wwlist_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Task</strong>: Create <code>school_catv2</code> based on <code>school_category</code> with these categories:</p>
<ul>
<li>This time create a numeric variable rather than character:
<ul>
<li><code>1</code> for “regular”; <code>2</code> for “alternative”; <code>3</code> for “special”; <code>4</code> for “vocational”</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="ot">&lt;-</span> wwlist <span class="sc">%&gt;%</span> <span class="fu">select</span>(school_category) <span class="sc">%&gt;%</span> </span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">school_catv2 =</span> <span class="fu">recode</span>(school_category,</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Alternative Education School"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Alternative/other"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Regular elementary or secondary"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Regular School"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Special Education School"</span> <span class="ot">=</span> <span class="dv">3</span>,</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Special program emphasis"</span> <span class="ot">=</span> <span class="dv">3</span>,</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Vocational Education School"</span> <span class="ot">=</span> <span class="dv">4</span>)</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wwlist_temp<span class="sc">$</span>school_catv2) <span class="co"># note: numeric variable now</span></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="sc">%&gt;%</span> <span class="fu">count</span>(school_catv2)</span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">count</span>(school_category)</span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(wwlist_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="student-exercise-using-recode-within-mutate" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="student-exercise-using-recode-within-mutate"><span class="header-section-number">4.5.1</span> Student exercise using <code>recode()</code> within <code>mutate()</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://github.com/ozanj/rclass/raw/master/data/recruiting/recruit_event_somevars.RData"</span>))</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df_event)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Using object <code>df_event</code>, assign new object <code>df_event_temp</code> and a numeric variable create <code>event_typev2</code> based on <code>event_type</code> with these categories:
<ul>
<li><code>1</code> for “2yr college”; <code>2</code> for “4yr college”; <code>3</code> for “other”; <code>4</code> for “private hs”; <code>5</code> for “public hs”</li>
</ul></li>
<li>This time use the <code>.default</code> argument to assign the value <code>5</code> for “public hs”</li>
</ol>
<details>
<summary>
<strong>Solutions using <code>recode()</code> within <code>mutate()</code></strong>
</summary>
<p>Check input variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df_event)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df_event<span class="sc">$</span>event_type)</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>df_event <span class="sc">%&gt;%</span> <span class="fu">count</span>(event_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Using object <code>df_event</code>, assign new object <code>df_event_temp</code> and create a numeric variable <code>event_typev2</code> based on <code>event_type</code> with these categories:
<ul>
<li><code>1</code> for “2yr college”; <code>2</code> for “4yr college”; <code>3</code> for “other”; <code>4</code> for “private hs”; <code>5</code> for “public hs”</li>
</ul></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>df_event_temp <span class="ot">&lt;-</span> df_event <span class="sc">%&gt;%</span> </span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(event_type) <span class="sc">%&gt;%</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event_typev2 =</span> <span class="fu">recode</span>(event_type,</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2yr college"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"4yr college"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"other"</span> <span class="ot">=</span> <span class="dv">3</span>,</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"private hs"</span> <span class="ot">=</span> <span class="dv">4</span>,</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"public hs"</span> <span class="ot">=</span> <span class="dv">5</span>)</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df_event_temp<span class="sc">$</span>event_typev2)</span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>df_event_temp <span class="sc">%&gt;%</span> <span class="fu">count</span>(event_typev2)</span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>df_event <span class="sc">%&gt;%</span> <span class="fu">count</span>(event_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>This time assign the value use the <code>.default</code> argument to assign the value <code>5</code> for “public hs”</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>df_event_temp <span class="ot">&lt;-</span> df_event <span class="sc">%&gt;%</span> <span class="fu">select</span>(event_type) <span class="sc">%&gt;%</span> </span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event_typev2 =</span> <span class="fu">recode</span>(event_type,</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2yr college"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"4yr college"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"other"</span> <span class="ot">=</span> <span class="dv">3</span>,</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"private hs"</span> <span class="ot">=</span> <span class="dv">4</span>,</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="dv">5</span>)</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df_event_temp<span class="sc">$</span>event_typev2)</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>df_event_temp <span class="sc">%&gt;%</span> <span class="fu">count</span>(event_typev2)</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>df_event <span class="sc">%&gt;%</span> <span class="fu">count</span>(event_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p><br></p>
</section>
</section>
<section id="using-case_when-function-within-mutate" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="using-case_when-function-within-mutate"><span class="header-section-number">4.6</span> Using case_when() function within mutate()</h2>
<p><code>case_when()</code> useful for creating variable that is a function of multiple “input” variables</p>
<p><strong>Usage (i.e., syntax)</strong>: <code>case_when(...)</code></p>
<p><strong>Arguments</strong> [from help file; see help file for more details]</p>
<ul>
<li><code>...</code>: A sequence of two-sided formulas.
<ul>
<li>The left hand side (LHS) determines which values match this case.
<ul>
<li>LHS must evaluate to a logical vector.<br>
</li>
</ul></li>
<li>The right hand side (RHS) provides the replacement value.</li>
</ul></li>
</ul>
<p><strong>Task</strong>: Using data frame <code>wwlist</code> and input vars <code>state</code> and <code>firstgen</code>, create a 4-category var with following categories:</p>
<ul>
<li>“instate_firstgen”; “instate_nonfirstgen”; “outstate_firstgen”; “outstate_nonfirstgen”</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="ot">&lt;-</span> wwlist <span class="sc">%&gt;%</span> <span class="fu">select</span>(state,firstgen) <span class="sc">%&gt;%</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_gen =</span> <span class="fu">case_when</span>(</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"WA"</span> <span class="sc">&amp;</span> firstgen <span class="sc">==</span><span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"instate_firstgen"</span>,</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"WA"</span> <span class="sc">&amp;</span> firstgen <span class="sc">==</span><span class="st">"N"</span> <span class="sc">~</span> <span class="st">"instate_nonfirstgen"</span>,</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">!=</span> <span class="st">"WA"</span> <span class="sc">&amp;</span> firstgen <span class="sc">==</span><span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"outstate_firstgen"</span>,</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">!=</span> <span class="st">"WA"</span> <span class="sc">&amp;</span> firstgen <span class="sc">==</span><span class="st">"N"</span> <span class="sc">~</span> <span class="st">"outstate_nonfirstgen"</span>)</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wwlist_temp<span class="sc">$</span>state_gen)</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="sc">%&gt;%</span> <span class="fu">count</span>(state_gen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a closer look at how values of inputs are coded into values of outputs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>wwlist <span class="sc">%&gt;%</span> <span class="fu">select</span>(state,firstgen) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(wwlist,state)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(wwlist,firstgen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="ot">&lt;-</span> wwlist <span class="sc">%&gt;%</span> <span class="fu">select</span>(state,firstgen) <span class="sc">%&gt;%</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_gen =</span> <span class="fu">case_when</span>(</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"WA"</span> <span class="sc">&amp;</span> firstgen <span class="sc">==</span><span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"instate_firstgen"</span>,</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"WA"</span> <span class="sc">&amp;</span> firstgen <span class="sc">==</span><span class="st">"N"</span> <span class="sc">~</span> <span class="st">"instate_nonfirstgen"</span>,</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">!=</span> <span class="st">"WA"</span> <span class="sc">&amp;</span> firstgen <span class="sc">==</span><span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"outstate_firstgen"</span>,</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">!=</span> <span class="st">"WA"</span> <span class="sc">&amp;</span> firstgen <span class="sc">==</span><span class="st">"N"</span> <span class="sc">~</span> <span class="st">"outstate_nonfirstgen"</span>)</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compare values of input vars to value of output var</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="sc">%&gt;%</span> <span class="fu">count</span>(state_gen)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(state)) <span class="sc">%&gt;%</span> <span class="fu">count</span>(state_gen)</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(firstgen)) <span class="sc">%&gt;%</span> <span class="fu">count</span>(state_gen)</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>wwlist_temp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(firstgen) <span class="sc">|</span> <span class="fu">is.na</span>(state)) <span class="sc">%&gt;%</span> <span class="fu">count</span>(state_gen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Take-away</strong>: by default var created by <code>case_when()</code> equals <code>NA</code> for obs where one of the inputs equals <code>NA</code></p>
<section id="student-exercise-using-case_when-within-mutate" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="student-exercise-using-case_when-within-mutate"><span class="header-section-number">4.6.1</span> Student exercise using <code>case_when()</code> within <code>mutate()</code></h3>
<ol type="1">
<li>Using the object <code>school_v2</code> and input vars <code>school_type</code>, and <code>state_code</code> , create a 4-category var <code>state_type</code> with following categories:
<ul>
<li>“instate_public”; “instate_private”; “outstate_public”; “outstate_private”</li>
<li>Note: We are referring to CA as in-state for this example</li>
</ul></li>
</ol>
<details>
<summary>
<strong>Solutions using <code>case_when()</code> within <code>mutate()</code></strong>
</summary>
<p>Investigate</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(state_code,school_type) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(school_v2,state_code)</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(state_code)) <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(school_v2,school_type)</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>school_v2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(school_type)) <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><p>Using the object <code>school_v2</code> and input vars <code>school_type</code>, and <code>state_code</code> , create a 4-category var <code>state_type</code> with following categories:</p>
<ul>
<li>“instate_public”; “instate_private”; “outstate_public”; “outstate_private”</li>
</ul></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>school_v2_temp <span class="ot">&lt;-</span> school_v2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(state_code,school_type) <span class="sc">%&gt;%</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>    state_code <span class="sc">==</span> <span class="st">"CA"</span> <span class="sc">&amp;</span> school_type <span class="sc">==</span> <span class="st">"public"</span>  <span class="sc">~</span> <span class="st">"instate_public"</span>,</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>    state_code <span class="sc">==</span> <span class="st">"CA"</span> <span class="sc">&amp;</span> school_type <span class="sc">==</span> <span class="st">"private"</span> <span class="sc">~</span> <span class="st">"instate_private"</span>,</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>    state_code <span class="sc">!=</span> <span class="st">"CA"</span> <span class="sc">&amp;</span> school_type <span class="sc">==</span> <span class="st">"public"</span> <span class="sc">~</span> <span class="st">"outstate_public"</span>,</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>    state_code <span class="sc">!=</span> <span class="st">"CA"</span> <span class="sc">&amp;</span> school_type <span class="sc">==</span> <span class="st">"private"</span> <span class="sc">~</span> <span class="st">"outstate_private"</span>)</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>school_v2_temp <span class="sc">%&gt;%</span> <span class="fu">count</span>(state_type)</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state_type           n</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;            &lt;int&gt;</span></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 instate_private    366</span></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 instate_public    1404</span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 outstate_private  3456</span></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 outstate_public  16075</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co">#school_v2_temp %&gt;% filter(is.na(state_code)) %&gt;% count(state_type) #no missing</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="co">#school_v2_temp %&gt;% filter(is.na(school_type)) %&gt;% count(state_type) #no missing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>