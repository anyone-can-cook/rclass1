<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">

<title>Tidy data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="tidy_data_files/libs/clipboard/clipboard.min.js"></script>
<script src="tidy_data_files/libs/quarto-html/quarto.js"></script>
<script src="tidy_data_files/libs/quarto-html/popper.min.js"></script>
<script src="tidy_data_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="tidy_data_files/libs/quarto-html/anchor.min.js"></script>
<link href="tidy_data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="tidy_data_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="tidy_data_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="tidy_data_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="tidy_data_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="tidy_data_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="tidy_data_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#libraries-and-datasets-we-will-use" id="toc-libraries-and-datasets-we-will-use" class="nav-link" data-scroll-target="#libraries-and-datasets-we-will-use"><span class="header-section-number">1.1</span> Libraries and datasets we will use</a></li>
  <li><a href="#lecture-overview" id="toc-lecture-overview" class="nav-link" data-scroll-target="#lecture-overview"><span class="header-section-number">1.2</span> Lecture overview</a></li>
  </ul></li>
  <li><a href="#data-structure-vs.-data-semantics" id="toc-data-structure-vs.-data-semantics" class="nav-link" data-scroll-target="#data-structure-vs.-data-semantics"><span class="header-section-number">2</span> Data structure vs.&nbsp;data semantics</a>
  <ul class="collapse">
  <li><a href="#dataset-structure" id="toc-dataset-structure" class="nav-link" data-scroll-target="#dataset-structure"><span class="header-section-number">2.1</span> Dataset structure</a></li>
  <li><a href="#dataset-semantics" id="toc-dataset-semantics" class="nav-link" data-scroll-target="#dataset-semantics"><span class="header-section-number">2.2</span> Dataset semantics</a>
  <ul class="collapse">
  <li><a href="#values-variables-and-observations" id="toc-values-variables-and-observations" class="nav-link" data-scroll-target="#values-variables-and-observations"><span class="header-section-number">2.2.1</span> Values, variables, and observations</a></li>
  </ul></li>
  <li><a href="#unit-of-analysis" id="toc-unit-of-analysis" class="nav-link" data-scroll-target="#unit-of-analysis"><span class="header-section-number">2.3</span> Unit of analysis</a>
  <ul class="collapse">
  <li><a href="#which-variables-uniquely-identify-rows-in-a-data-frame" id="toc-which-variables-uniquely-identify-rows-in-a-data-frame" class="nav-link" data-scroll-target="#which-variables-uniquely-identify-rows-in-a-data-frame"><span class="header-section-number">2.3.1</span> Which variable(s) uniquely identify rows in a data frame</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#tidy-vs.-untidy-data" id="toc-tidy-vs.-untidy-data" class="nav-link" data-scroll-target="#tidy-vs.-untidy-data"><span class="header-section-number">3</span> Tidy vs.&nbsp;untidy data</a>
  <ul class="collapse">
  <li><a href="#defining-tidy-data" id="toc-defining-tidy-data" class="nav-link" data-scroll-target="#defining-tidy-data"><span class="header-section-number">3.1</span> Defining tidy data</a></li>
  <li><a href="#diagnosing-untidy-data" id="toc-diagnosing-untidy-data" class="nav-link" data-scroll-target="#diagnosing-untidy-data"><span class="header-section-number">3.2</span> Diagnosing untidy data</a></li>
  <li><a href="#common-types-of-untidy-data" id="toc-common-types-of-untidy-data" class="nav-link" data-scroll-target="#common-types-of-untidy-data"><span class="header-section-number">3.3</span> Common types of untidy data</a>
  <ul class="collapse">
  <li><a href="#column-headers-are-values-not-variable-names" id="toc-column-headers-are-values-not-variable-names" class="nav-link" data-scroll-target="#column-headers-are-values-not-variable-names"><span class="header-section-number">3.3.1</span> Column headers are values, not variable names</a></li>
  <li><a href="#multiple-variables-are-stored-in-one-column" id="toc-multiple-variables-are-stored-in-one-column" class="nav-link" data-scroll-target="#multiple-variables-are-stored-in-one-column"><span class="header-section-number">3.3.2</span> Multiple variables are stored in one column</a></li>
  <li><a href="#column-contains-data-from-two-variables" id="toc-column-contains-data-from-two-variables" class="nav-link" data-scroll-target="#column-contains-data-from-two-variables"><span class="header-section-number">3.3.3</span> Column contains data from two variables</a></li>
  <li><a href="#single-variable-stored-in-multiple-columns" id="toc-single-variable-stored-in-multiple-columns" class="nav-link" data-scroll-target="#single-variable-stored-in-multiple-columns"><span class="header-section-number">3.3.4</span> Single variable stored in multiple columns</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#tidying-untidy-data" id="toc-tidying-untidy-data" class="nav-link" data-scroll-target="#tidying-untidy-data"><span class="header-section-number">4</span> Tidying untidy data</a>
  <ul class="collapse">
  <li><a href="#reshaping-wide-to-long-pivot_longer" id="toc-reshaping-wide-to-long-pivot_longer" class="nav-link" data-scroll-target="#reshaping-wide-to-long-pivot_longer"><span class="header-section-number">4.1</span> Reshaping wide to long: <code>pivot_longer()</code></a></li>
  <li><a href="#reshaping-long-to-wide-pivot_wider" id="toc-reshaping-long-to-wide-pivot_wider" class="nav-link" data-scroll-target="#reshaping-long-to-wide-pivot_wider"><span class="header-section-number">4.2</span> Reshaping long to wide: <code>pivot_wider()</code></a></li>
  </ul></li>
  <li><a href="#missing-values" id="toc-missing-values" class="nav-link" data-scroll-target="#missing-values"><span class="header-section-number">5</span> Missing values</a>
  <ul class="collapse">
  <li><a href="#explicit-vs.-implicit-missing-values" id="toc-explicit-vs.-implicit-missing-values" class="nav-link" data-scroll-target="#explicit-vs.-implicit-missing-values"><span class="header-section-number">5.1</span> Explicit vs.&nbsp;Implicit missing values</a></li>
  <li><a href="#making-implicit-missing-values-explicit" id="toc-making-implicit-missing-values-explicit" class="nav-link" data-scroll-target="#making-implicit-missing-values-explicit"><span class="header-section-number">5.2</span> Making implicit missing values explicit</a></li>
  <li><a href="#reshaping-long-to-wide-missing-values" id="toc-reshaping-long-to-wide-missing-values" class="nav-link" data-scroll-target="#reshaping-long-to-wide-missing-values"><span class="header-section-number">5.3</span> Reshaping long to wide: missing values</a></li>
  </ul></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix"><span class="header-section-number">6</span> Appendix</a>
  <ul class="collapse">
  <li><a href="#student-exercise-real-world-example-of-wide-to-long" id="toc-student-exercise-real-world-example-of-wide-to-long" class="nav-link" data-scroll-target="#student-exercise-real-world-example-of-wide-to-long"><span class="header-section-number">6.1</span> Student exercise: Real-world example of wide to long</a></li>
  <li><a href="#student-exercise-real-world-example-of-reshaping-long-to-wide" id="toc-student-exercise-real-world-example-of-reshaping-long-to-wide" class="nav-link" data-scroll-target="#student-exercise-real-world-example-of-reshaping-long-to-wide"><span class="header-section-number">6.2</span> Student exercise: real-world example of reshaping long to wide</a></li>
  <li><a href="#missing-variables-example-using-ipeds" id="toc-missing-variables-example-using-ipeds" class="nav-link" data-scroll-target="#missing-variables-example-using-ipeds"><span class="header-section-number">6.3</span> Missing variables example using IPEDS</a></li>
  <li><a href="#applying-complete-to-ipeds-dataset" id="toc-applying-complete-to-ipeds-dataset" class="nav-link" data-scroll-target="#applying-complete-to-ipeds-dataset"><span class="header-section-number">6.4</span> Applying complete() to IPEDS dataset</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tidy data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<section id="libraries-and-datasets-we-will-use" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="libraries-and-datasets-we-will-use"><span class="header-section-number">1.1</span> Libraries and datasets we will use</h2>
<p>Load packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(labelled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> Load datasets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NCES Digest Table 204.10</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">'https://github.com/anyone-can-cook/rclass1/raw/master/data/nces_digest/nces_digest_tbl_204_10.RData'</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># IPEDS EFFY Table</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>ipeds_table <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">'https://github.com/anyone-can-cook/rclass1/raw/master/data/ipeds/effy/ey15-16_hc.dta'</span>, <span class="at">encoding =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lecture-overview" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="lecture-overview"><span class="header-section-number">1.2</span> Lecture overview</h2>
<p>Creating analysis datasets often require <strong>changing the organizational structure</strong> of data. For example:</p>
<ul>
<li>You want analysis dataset to have one obs per student, but your data has one obs per student-course</li>
<li>You want analysis dataset to have one obs per institution, but enrollment data has one obs per institution-enrollment level</li>
</ul>
<p>Two common ways to change organizational structure of data:</p>
<ol type="1">
<li>Use <code>group_by()</code> to perform calculations separately within groups and then use <code>summarise()</code> to create an object with one observation per group.</li>
</ol>
<p><strong>Examples:</strong> - Creating objects containing summary statistics that are basis for tables and graphs - Creating student-transcript level GPA variable from student-transcript-course level data 2. <strong>Reshape</strong> your data – called <strong>tidying</strong> in the R tidyverse world – by transforming columns (variables) into rows (observations) and vice versa - This is the focus of this lecture, where we will look at transforming <strong>untidy</strong> data into <strong>tidy</strong> data.</p>
<p>Working with tidy data has many benefits:</p>
<ul>
<li>It is a consistent way of storing data</li>
<li>R is also well-suited for working with tidy data due to its vectorized nature. There’s also many packages in <code>tidyverse</code> that are designed to work with tidy data, such as <code>tidyr</code>.</li>
</ul>
<p>Show index and example datasets in <code>tidyr</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(<span class="at">package=</span><span class="st">"tidyr"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that example datasets (table1, table2, etc) are listed in the index alongside functions</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>tidyr<span class="sc">::</span>table1</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> table1</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df1)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>table2</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>table3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-structure-vs.-data-semantics" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data structure vs.&nbsp;data semantics</h1>
<p>Before we define “tidy data”, we will spend significant time defining and discussing some core terms/concepts about datasets. This discussion draws from the 2014 article <a href="https://www.jstatsoft.org/article/view/v059i10">Tidy Data</a> by Hadley Wickham.</p>
<p>Wickham (2014) distinguishes between <strong>data structure</strong> (<em>layout</em>) and <strong>data semantics</strong> (<em>concepts</em>).</p>
<section id="dataset-structure" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="dataset-structure"><span class="header-section-number">2.1</span> Dataset structure</h2>
<p><strong>Dataset structure</strong> refers to the “physical layout” of a dataset.</p>
<ul>
<li>Typically, datasets are “rectangular <strong>tables</strong> made up of <strong>rows</strong> and <strong>columns</strong>”</li>
<li>A <strong>cell</strong> is the intersection of one column and one row (think cells in Microsoft Excel or Google sheets)</li>
</ul>
<p>There are many alternative data structures to present the same underlying data.</p>
<p><br> <strong>Example</strong>: 2 different ways to structure the same data (rows and columns are transposed)</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Structure A: treatment as columns, names as rows</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">treatment_a</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">treatment_b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">John Smith</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jane Doe</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mary Johnson</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Structure B: treatment as rows, names as columns</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">John Smith</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Jane Doe</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mary Johnson</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">treatment_a</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">treatment_b</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
</section>
<section id="dataset-semantics" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="dataset-semantics"><span class="header-section-number">2.2</span> Dataset semantics</h2>
<p><strong>Data semantics</strong> refer to the underlying meaning of the data being displayed, or how we think of the data conceptually.</p>
<p>The difference between <strong>data structure</strong> and <strong>data semantics</strong>:</p>
<ul>
<li><strong>Data structure</strong> refers to the physical layout of the data (e.g., what are the rows and columns)</li>
<li><strong>Data semantics</strong> – which were introduced by Wickham (2014) – refer to the meaning of the data itself</li>
</ul>
<p><br> <strong>Example</strong>: Describing a dataset</p>
<p>Looking back at the previous example, we can see that although the data structure is different, the tables represent the same underlying data: <em>Each person can partake in any of multiple treatments and can have a result from each treatment.</em></p>
<p>In the next section, we’ll define some terms to make it easier to describe the semantics (meaning) of the data displayed in the tables.</p>
<section id="values-variables-and-observations" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="values-variables-and-observations"><span class="header-section-number">2.2.1</span> Values, variables, and observations</h3>
<blockquote class="blockquote">
<p>“A dataset is a collection of <em>values</em>, usually either numbers (if quantitative) or strings (if qualitative). Values are organized in two ways. Every value belongs to a <em>variable</em> and an <em>observation</em>.”</p>
</blockquote>
<p><em>Source: Wickham (2014, p.&nbsp;3)</em></p>
<p><br> <strong>Terminology</strong>:</p>
<ul>
<li><strong>Value</strong>: A single element within some data structure (e.g., vector, list)</li>
<li><strong>Variables</strong>: “A variable contains all values that measure the same underlying attribute (like height, temperature, duration) across units”</li>
<li><strong>Observations</strong>: “An observation contains all values measured on the same unit (e.g., corporation-year) across attributes (variables)”
<ul>
<li>e.g., unit is corporation-year and one observation contains values of revenue and expense variables for Google for the 2021 fiscal year</li>
</ul></li>
</ul>
<p><br> <strong>Example</strong>: Describing data semantics [revisited]</p>
<ul>
<li>The experimental design data has 3 <strong>variables</strong>:
<ul>
<li><code>person</code>, with 3 possible <em>values</em> (John Smith, Mary Johnson, Jane Doe)</li>
<li><code>treatment</code>, with 2 possible <em>values</em> (treatment_a, treatment_b)</li>
<li><code>result</code>, with 6 possible <em>values</em> (one of which is a missing value)</li>
</ul></li>
<li>Since measurements were taken for each <code>person</code> for each <code>experiment</code>, there are 6 <strong>observations</strong>:
<ul>
<li>3 people x 2 treatments = 6 <em>observations</em></li>
<li>For each observation, the same attribute (result) was measured</li>
</ul></li>
<li>There is a total of 18 <strong>values</strong>:
<ul>
<li>3 <em>variables</em> x 6 <em>observations</em> = 18 <em>values</em></li>
</ul></li>
</ul>
</section>
</section>
<section id="unit-of-analysis" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="unit-of-analysis"><span class="header-section-number">2.3</span> Unit of analysis</h2>
<p><strong>unit of analysis</strong> [my term, not Wickham’s]:</p>
<ul>
<li>What each row represents in a dataset (referring to physical layout of dataset).</li>
</ul>
<p>Examples of different units of analysis:</p>
<ul>
<li>if each row represents a student, you have student level data</li>
<li>if each row represents a student-course, you have student-course level data</li>
<li>if each row represents an organization-year, you have organization-year level data</li>
</ul>
<p><strong>Questions</strong>:</p>
<ul>
<li>What does each row represent in the data frame object <code>structure_a</code>?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>structure_a</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name         treatment_a treatment_b</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;              &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 John Smith            NA           2</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Jane Doe              16          11</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Mary Johnson           3           1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>What does each row represent in the data frame object <code>structure_b</code>?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>structure_b</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   treatment   `John Smith` `Jane Doe` `Mary Johnson`</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;              &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 treatment_a           NA         16              3</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 treatment_b            2         11              1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>What does each row represent in the data frame object <code>ipeds_hc_temp</code>?</p>
<ul>
<li>Below we load data on 12-month enrollment headcount for 2015-16 academic year from the Integrated Postsecondary Education Data System (IPEDS)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ipeds_hc_temp <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="at">file=</span><span class="st">"https://github.com/ozanj/rclass/raw/master/data/ipeds/effy/ey15-16_hc.dta"</span>, <span class="at">encoding=</span><span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(unitid,lstudy,efytotlt) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(unitid,lstudy)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ipeds_hc_temp</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 15,726 × 3</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    unitid lstudy                efytotlt</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;dbl&gt; &lt;dbl+lbl&gt;                &lt;dbl&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 100654   1 [Undergraduate]       4865</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 100654   3 [Graduate]            1292</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 100654 999 [Generated total]     6157</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 100663   1 [Undergraduate]      13440</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 100663   3 [Graduate]            8114</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 100663 999 [Generated total]    21554</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 100690   1 [Undergraduate]        415</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 100690   3 [Graduate]             415</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 100690 999 [Generated total]      830</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 100706   1 [Undergraduate]       6994</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 15,716 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#show variable labels and value labels</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#ipeds_hc_temp %&gt;% var_label()</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ipeds_hc_temp %&gt;% val_labels()</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#print a few obs, with value labels rather than variable values</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>ipeds_hc_temp <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">as_factor</span>()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 3</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    unitid lstudy          efytotlt</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;dbl&gt; &lt;fct&gt;              &lt;dbl&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 100654 Undergraduate       4865</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 100654 Graduate            1292</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 100654 Generated total     6157</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 100663 Undergraduate      13440</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 100663 Graduate            8114</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 100663 Generated total    21554</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 100690 Undergraduate        415</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 100690 Graduate             415</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 100690 Generated total      830</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 100706 Undergraduate       6994</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<section id="which-variables-uniquely-identify-rows-in-a-data-frame" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="which-variables-uniquely-identify-rows-in-a-data-frame"><span class="header-section-number">2.3.1</span> Which variable(s) uniquely identify rows in a data frame</h3>
<p>Identifying which combination of variables uniquely identifies rows in a data frame helps you identify the “unit of analysis” and understand the “structure” of your dataset</p>
<ul>
<li>Said differently: for each value of this variable (or combination of variables), there is only one row</li>
<li>Very important for reshaping/tidying data (this week) and very important for joining/merging data frames (next week)</li>
<li>Sometimes a codebook will explicitly tell you which vars uniquely identify rows</li>
<li>Sometimes you have to figure this out through investigation
<ul>
<li>focus on ID variables and categorical variables that identify what each row represents; not continuous numeric variables like <code>total_enrollment</code> or <code>family_income</code></li>
</ul></li>
</ul>
<p><strong>Task</strong>: Let’s try to identify the variable(s) that uniquely identify rows in <code>ipeds_hc_temp</code></p>
<ul>
<li>Multiple ways of doing this</li>
<li>I’ll give you some code for one approach; just try to follow along and understand</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ipeds_hc_temp)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "unitid"   "lstudy"   "efytotlt"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ipeds_hc_temp <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n=</span><span class="dv">10</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 3</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    unitid lstudy                efytotlt</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;dbl&gt; &lt;dbl+lbl&gt;                &lt;dbl&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 100654   1 [Undergraduate]       4865</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 100654   3 [Graduate]            1292</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 100654 999 [Generated total]     6157</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 100663   1 [Undergraduate]      13440</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 100663   3 [Graduate]            8114</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 100663 999 [Generated total]    21554</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 100690   1 [Undergraduate]        415</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 100690   3 [Graduate]             415</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 100690 999 [Generated total]      830</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 100706   1 [Undergraduate]       6994</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> First, Let’s investigate whether the ID variable <code>unitid</code> uniquely identifies rows in data frame <code>ipeds_hc_temp</code></p>
<ul>
<li>I’ll annotate code for each step</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ipeds_hc_temp <span class="sc">%&gt;%</span> <span class="co"># start with data frame object ipeds_hc_temp</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(unitid) <span class="sc">%&gt;%</span> <span class="co"># group by unitid</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_per_group=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="co"># create measure of number of obs per group</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> <span class="co"># ungroup (otherwise frequency table [next step] created) separately for each group (i.e., separate frequency table for each value of unitid)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_per_group) <span class="co"># frequency of number of observations per group</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   n_per_group     n</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1           2  5127</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2           3  1824</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What does above output tell us?</p>
<ul>
<li>There are 5,127 values of <code>unitid</code> that have 2 rows for that value of <code>unitid</code></li>
<li>There are 1,824 values of <code>unitid</code> that have 3 rows for that value of <code>unitid</code></li>
<li>Note: <code>2*5127+3*1824==</code> 15,726 which is the number of observations in <code>ipeds_hc_temp</code></li>
<li><strong>Conclusion</strong>: the variable <code>unitid</code> does not uniquely identify rows in the data frame <code>ipeds_hc_temp</code></li>
</ul>
<p><br> Second, Let’s investigate whether the combination of <code>unitid</code> and <code>lstudy</code> uniquely identifies rows in data frame <code>ipeds_hc_temp</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ipeds_hc_temp <span class="sc">%&gt;%</span> <span class="co"># start with data frame object ipeds_hc_temp</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(unitid,lstudy) <span class="sc">%&gt;%</span> <span class="co"># group by unitid and lstudy</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_per_group=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="co"># create measure of number of obs per group</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> <span class="co"># ungroup (otherwise frequency table [next step] created) separately for each group (i.e., separate frequency table for each value of unitid)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_per_group) <span class="co"># frequency of number of observations per group</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by 'unitid'. You can override using the</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `.groups` argument.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   n_per_group     n</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1           1 15726</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What does above output tell us?</p>
<ul>
<li>There is <code>1</code> row each unique combination of <code>unitid</code> and <code>lstudy</code></li>
<li><strong>Conclusion</strong>: the variables <code>unitid</code> and <code>lstudy</code> uniquely identify rows in the data frame <code>ipeds_hc_temp</code></li>
</ul>
<!--
What happens if we didn't ungroup?
::: {.cell}

```{.r .cell-code}
ipeds_hc_temp %>% # start with data frame object ipeds_hc_temp
  group_by(unitid,lstudy) %>% # group by unitid and lstudy
  summarise(n_per_group=n()) %>% # create measure of number of obs per group
  count(n_per_group) # frequency of number of observations per group
```
:::
-->
</section>
</section>
</section>
<section id="tidy-vs.-untidy-data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Tidy vs.&nbsp;untidy data</h1>
<section id="defining-tidy-data" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="defining-tidy-data"><span class="header-section-number">3.1</span> Defining tidy data</h2>
<blockquote class="blockquote">
<p>“<em>Tidy data</em> is a standard way of mapping the <em>meaning</em> of a dataset to its <em>structure</em>.”</p>
</blockquote>
<p><em>Source: Wickham (2014, p.&nbsp;4)</em></p>
<p><br> <strong>Tidy data</strong> always follow these 3 interrelated rules:</p>
<ol type="1">
<li>Each <strong>variable</strong> must have its own <strong>column</strong></li>
<li>Each <strong>observation</strong> must have its own <strong>row</strong></li>
<li>Each <strong>value</strong> must have its own <strong>cell</strong></li>
</ol>
<p><img src="http://r4ds.had.co.nz/images/tidy-1.png" class="img-fluid"></p>
<p><strong>Example</strong>: Representing data in tidy form</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Tidy data: `table1` from the `tidyr` package</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cases</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">745</td>
<td style="text-align: right;">19987071</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">2666</td>
<td style="text-align: right;">20595360</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">37737</td>
<td style="text-align: right;">172006362</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">80488</td>
<td style="text-align: right;">174504898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">212258</td>
<td style="text-align: right;">1272915272</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">213766</td>
<td style="text-align: right;">1280428583</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p>This table shows the same data from earlier, but now the data is in <strong>tidy</strong> form because it satisfies the 3 rules:</p>
<ol type="1">
<li>All 4 <strong>variables</strong> (<code>country</code>, <code>year</code>, <code>cases</code>, <code>population</code>) have its own column</li>
<li>All 6 <strong>observations</strong> (combination of <code>country</code>-<code>year</code>) have its own row</li>
<li>All 24 <strong>values</strong> have its own cell in the table</li>
</ol>
</section>
<section id="diagnosing-untidy-data" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="diagnosing-untidy-data"><span class="header-section-number">3.2</span> Diagnosing untidy data</h2>
<p><strong>Untidy data</strong> is any data that do not fully follow the 3 rules of tidy data defined previously.</p>
<p><br> <strong>Example</strong>: Tidy vs.&nbsp;untidy data</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Tidy data: `table1` from the `tidyr` package</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cases</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">745</td>
<td style="text-align: right;">19987071</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">2666</td>
<td style="text-align: right;">20595360</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">37737</td>
<td style="text-align: right;">172006362</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">80488</td>
<td style="text-align: right;">174504898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">212258</td>
<td style="text-align: right;">1272915272</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">213766</td>
<td style="text-align: right;">1280428583</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Untidy data: `table2` from the `tidyr` package</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">745</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">19987071</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">2666</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">20595360</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">37737</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">172006362</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">80488</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">174504898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">212258</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">1272915272</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">213766</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">1280428583</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p>The above tables show the same data, but <code>table1</code> is in <strong>tidy</strong> form while <code>table2</code> is <strong>untidy</strong> because it does not fully follow the 3 rules. Let’s diagnose the problems with <code>table2</code> by answering these questions:</p>
<ol type="1">
<li>Does each <strong>variable</strong> have its own <strong>column</strong>?
<ul>
<li>If not, how does the dataset violate this principle?</li>
<li>What <em>should</em> the variables be?</li>
</ul></li>
<li>Does each <strong>observation</strong> have its own <strong>row</strong>?
<ul>
<li>If not, how does the dataset violate this principle?</li>
<li>What does each row <em>actually</em> represent?</li>
<li>What <em>should</em> each row represent?</li>
</ul></li>
<li>Does each <strong>value</strong> have its own <strong>cell</strong>?
<ul>
<li>If not, how does the dataset violate this principle?</li>
</ul></li>
</ol>
<details>
<summary>
<strong>Solutions</strong>
</summary>
<ol type="1">
<li>Does each <strong>variable</strong> have its own <strong>column</strong>? <span style="color: red;">No</span>
<ul>
<li>If not, how does the dataset violate this principle? <span style="color: red;"><code>cases</code> and <code>population</code> should be two different variables because they are different attributes, but in <code>table2</code> these two attributes are recorded in the column <code>type</code> and the associated value for each type is recorded in the column <code>count</code>.</span></li>
<li>What <em>should</em> the variables be? <span style="color: red;"><code>country</code>, <code>year</code>, <code>cases</code>, <code>population</code></span></li>
</ul></li>
<li>Does each <strong>observation</strong> have its own <strong>row</strong>? <span style="color: red;">No</span>
<ul>
<li>If not, how does the dataset violate this principle? <span style="color: red;">There is one observation for each <code>country</code>-<code>year</code>-<code>type</code>. But the values of type (<code>cases</code>, <code>population</code>) represent attributes of a unit, which should be represented by distinct variables rather than rows. So <code>table2</code> has two rows per observation but it should have one row per observation.</span></li>
<li>What does each row <em>actually</em> represent? <span style="color: red;"><code>country</code>-<code>year</code>-<code>type</code></span></li>
<li>What <em>should</em> each row represent? <span style="color: red;"><code>country</code>-<code>year</code></span></li>
</ul></li>
<li>Does each <strong>value</strong> have its own <strong>cell</strong>? <span style="color: red;">Yes</span>
<ul>
<li>If not, how does the dataset violate this principle?</li>
</ul></li>
</ol>
</details>
<p><br></p>
</section>
<section id="common-types-of-untidy-data" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="common-types-of-untidy-data"><span class="header-section-number">3.3</span> Common types of untidy data</h2>
<p><strong>Tidy data</strong> can only have one organizational structure, while <strong>untidy data</strong> can come in various different forms. It is important to identify the most common types of untidy data, so that we can develop solutions for each.</p>
<p>Below are some of the common problems of untidy data.</p>
<section id="column-headers-are-values-not-variable-names" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="column-headers-are-values-not-variable-names"><span class="header-section-number">3.3.1</span> Column headers are values, not variable names</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>`table4b` from the `tidyr` package</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1999</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2000</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">19987071</td>
<td style="text-align: right;">20595360</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">172006362</td>
<td style="text-align: right;">174504898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">1272915272</td>
<td style="text-align: right;">1280428583</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p>Here, <code>1999</code> and <code>2000</code> are not names of variables, but values of a variable (i.e., <code>year</code>). This form results in:</p>
<ul>
<li>A single variable spreading over multiple columns (<em>both the last 2 columns contain values of country population</em>)</li>
<li>A single row containing multiple observations (e.g., <em>population in 1999 Afghanistan and population in 2000 Afghanistan should be different observations</em>)</li>
</ul>
</section>
<section id="multiple-variables-are-stored-in-one-column" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="multiple-variables-are-stored-in-one-column"><span class="header-section-number">3.3.2</span> Multiple variables are stored in one column</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>`table2` from the `tidyr` package</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">745</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">19987071</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">2666</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">20595360</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">37737</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">172006362</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">80488</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">174504898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">212258</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">1272915272</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">213766</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">1280428583</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><code>cases</code> and <code>population</code> are separate variables, but are stored here in the same column. This form results in:</p>
<ul>
<li>An observation being scattered across multiple rows (e.g., <em>1999 Afghanistan data should be a single observation/row</em>)</li>
<li>The values of a column not sharing the same units (<em>the <code>count</code> column contains both number of cases and number of people</em>)</li>
</ul>
</section>
<section id="column-contains-data-from-two-variables" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="column-contains-data-from-two-variables"><span class="header-section-number">3.3.3</span> Column contains data from two variables</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>`table3` from the `tidyr` package</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">745/19987071</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">2666/20595360</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">37737/172006362</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">80488/174504898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">212258/1272915272</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">213766/1280428583</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><code>745</code> and <code>19987071</code> in the <code>rate</code> column belong in separate columns.</p>
</section>
<section id="single-variable-stored-in-multiple-columns" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="single-variable-stored-in-multiple-columns"><span class="header-section-number">3.3.4</span> Single variable stored in multiple columns</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>`table5` from the `tidyr` package</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">century</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: left;">19</td>
<td style="text-align: left;">99</td>
<td style="text-align: left;">745/19987071</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">2666/20595360</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: left;">19</td>
<td style="text-align: left;">99</td>
<td style="text-align: left;">37737/172006362</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">80488/174504898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: left;">19</td>
<td style="text-align: left;">99</td>
<td style="text-align: left;">212258/1272915272</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">00</td>
<td style="text-align: left;">213766/1280428583</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p>The values in <code>century</code> and <code>year</code> should be combined to form a 4-digit <code>year</code> variable.</p>
</section>
</section>
</section>
<section id="tidying-untidy-data" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Tidying untidy data</h1>
<p>Approach the task of “tidying” data – or more generally, the task of “reshaping” data – as a two-step process</p>
<ol type="1">
<li>Conceptual task of understanding how the data are organized and how the data should be organized (in some order):
<ul>
<li>Define these concepts for your dataset
<ul>
<li><strong>variables</strong>: what variables <em>should</em> the resulting dataset have</li>
<li><strong>observations</strong>: each observation should represent what in the resulting dataset</li>
</ul></li>
<li>How is the dataset currently structured (columns represent what, rows represent what)
<ul>
<li>which rules of tidy data are violated; why?</li>
</ul></li>
<li>write out on a piece of scratch paper what the tidy dataset <em>should</em> look like</li>
</ul></li>
<li>Technical task of writing the code that reshapes/transforms the dataset from untidy to tidy
<ul>
<li><code>pivot_longer()</code> function reshapes data from “wide to long”
<ul>
<li>e.g., your dataset has separate variables for each year, but you should have one variable “year” that has rows for each value of year</li>
</ul></li>
<li><code>pivot_wider()</code> function reshapes data from “long to wide”</li>
</ul></li>
</ol>
<section id="reshaping-wide-to-long-pivot_longer" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="reshaping-wide-to-long-pivot_longer"><span class="header-section-number">4.1</span> Reshaping wide to long: <code>pivot_longer()</code></h2>
<p><br> Now that we have a better understanding of the differences between tidy and untidy data, let’s practice reshaping our data. In the next two sections we are introducing the <code>pivot_longer()</code> and <code>pivot_wider()</code> functions to reshape our data.</p>
<p><strong>The <code>pivot_longer()</code> function</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>?pivot_longer</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SYNTAX AND DEFAULT VALUES</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(data, cols, <span class="at">names_to =</span> <span class="st">"name"</span>, <span class="at">names_prefix =</span> <span class="cn">NULL</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">names_sep =</span> <span class="cn">NULL</span>, <span class="at">names_pattern =</span> <span class="cn">NULL</span>, <span class="at">names_ptypes =</span> <span class="fu">list</span>(),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">names_repair =</span> <span class="st">"check_unique"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">values_drop_na =</span> <span class="cn">FALSE</span>, <span class="at">values_ptypes =</span> <span class="fu">list</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Function: “lengthens” data, increasing the number of rows and decreasing the number of columns</li>
<li>Arguments (selected):
<ul>
<li><code>data</code>: Dataframe to pivot</li>
<li><code>cols</code>: Columns to pivot into longer format</li>
<li><code>names_to</code>: Name of the column to create from the data stored in the column names of <code>data</code></li>
<li><code>values_to</code>: Name of the column to create from the data stored in cell values</li>
<li><code>names_sep</code>: If <code>names_to</code> contains multiple values, these arguments control how the column name is broken up.</li>
</ul></li>
</ul>
<p><br> <strong>Example</strong>: Tidying <code>table4b</code> (reshaping wide to long)</p>
<p>As seen above, the first common reason for untidy data is that some of the column names are not names of variables, but values of a variable (e.g., <code>table4a</code>, <code>table4b</code>):</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1999</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2000</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">19987071</td>
<td style="text-align: right;">20595360</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">172006362</td>
<td style="text-align: right;">174504898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">1272915272</td>
<td style="text-align: right;">1280428583</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><br> The solution to this problem is to transform the untidy columns (which represent variable values) into rows. Thus, we want to transform <code>table4b</code> into something that looks like this:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">19987071</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">20595360</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">172006362</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">174504898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">1272915272</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">1280428583</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><br> This can be achieved using <code>pivot_longer()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>table4b</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country         `1999`     `2000`</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Afghanistan   19987071   20595360</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Brazil       172006362  174504898</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 China       1272915272 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>table4b <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">'1999'</span>, <span class="st">'2000'</span>),  <span class="co"># pivot `1999` and `2000` columns into longer format </span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">'year'</span>,         <span class="co"># name of column that holds the pivoted values</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">'population'</span>   <span class="co"># name of column that holds the original cell values</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country     year  population</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Afghanistan 1999    19987071</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Afghanistan 2000    20595360</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Brazil      1999   172006362</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Brazil      2000   174504898</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 China       1999  1272915272</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 China       2000  1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--
1. names of the set of columns that represent values, not variables in your untidy data 
    - These are existing columns of the untidy data
    - in table 4a these are the columns `1999` and `2000`
2. __names_to__ : variable name(s) you will assign to columns you are gathering from the untidy data
    - This var doesn't yet exist in untidy data, but will be a variable name in the tidy data
    - For the `table4a` example, we'll call this variable `year` because the values of this variable will be years
    - Said different: the variable(s) you will create whose values will be the column names from the untidy data. 
    - In using `gather()` this is the "key" variable
3. __values to__: The name of the variable that will contain values in the tidy dataset you create and whose values are spread across multiple columns in the untidy dataset
    - This var doesn't yet exist in untidy data, but will be a variable name in the tidy data
    - in the `table4a` example, we'll call the "value variable" `cases` because the values refer to number of cases

-->
<p><br></p>
<details>
<summary>
<strong>Example</strong>: Choosing which column not to pivot
</summary>
<p><br></p>
<p>Looking at the previous example, we could have also equivalently pivoted the table by specifying which column we want to keep unchanged:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>table4b <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>country,           <span class="co"># pivot all columns except `country`</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">'year'</span>,         <span class="co"># name of column that holds the pivoted values</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">'population'</span>   <span class="co"># name of column that holds the original cell values</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country     year  population</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Afghanistan 1999    19987071</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Afghanistan 2000    20595360</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Brazil      1999   172006362</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Brazil      2000   174504898</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 China       1999  1272915272</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 China       2000  1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p><br></p>
<details>
<summary>
<strong>Example</strong>: Renaming pivoted columns
</summary>
<p><br></p>
<p>Sometimes, the name of the columns we want to pivot contain additional information that we want to remove before transforming to tidy data. Consider the following example where the columns all contain the prefix <code>tot_</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>nces_table1</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 51 × 5</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    state                tot_2000 tot_2010 tot_2011 tot_2012</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;                   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Alabama                728351   730427   731556   740475</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Alaska                 105333   132104   131166   131483</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Arizona                877696  1067210  1024454   990378</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Arkansas               449959   482114   483114   486157</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 California            6050753  6169427  6202862  6178788</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Colorado               724349   842864   853610   863121</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Connecticut            562179   552919   543883   549295</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Delaware               114676   128342   128470   127791</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 District of Columbia    68380    71263    72329    75411</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Florida               2434755  2641555  2668037  2691881</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 41 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> If we pivot the table as is, we can see the <code>tot_</code> prefixes appearing in the <code>year</code> column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>nces_table1 <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>state,                <span class="co"># pivot all columns except `state`</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">'year'</span>,            <span class="co"># name of column that holds the pivoted values</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">'total_students'</span>  <span class="co"># name of column that holds the original cell values</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 204 × 3</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    state   year     total_students</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Alabama tot_2000         728351</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Alabama tot_2010         730427</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Alabama tot_2011         731556</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Alabama tot_2012         740475</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Alaska  tot_2000         105333</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Alaska  tot_2010         132104</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Alaska  tot_2011         131166</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Alaska  tot_2012         131483</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Arizona tot_2000         877696</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Arizona tot_2010        1067210</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 194 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> To fix this, we can specify the <code>names_prefix</code> argument in <code>pivot_longer()</code> to match and remove the part of the names that we don’t want to keep:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>nces_table1 <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>state,                </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">'year'</span>,            </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">'tot_'</span>,        <span class="co"># rename pivoted values by striping the prefix 'tot_'</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">'total_students'</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 204 × 3</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    state   year  total_students</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Alabama 2000          728351</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Alabama 2010          730427</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Alabama 2011          731556</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Alabama 2012          740475</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Alaska  2000          105333</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Alaska  2010          132104</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Alaska  2011          131166</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Alaska  2012          131483</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Arizona 2000          877696</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Arizona 2010         1067210</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 194 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p><br></p>
<details>
<summary>
<strong>Example</strong>: Pivoting columns by name pattern
</summary>
<p><br></p>
<p>Consider the following example where the columns we want to reshape belongs to multiple variables. As seen, the 4 columns starting with <code>tot_</code> shows total student enrollment while the 4 columns starting with <code>frl_</code> shows number of students on free/reduced lunch:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>nces_table2</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 51 × 9</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    state tot_2000 tot_2010 tot_2011 tot_2012 frl_2000 frl_2010 frl_2011 frl_2012</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Alab…   728351   730427   731556   740475   335143   402386  420447    429604</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Alas…   105333   132104   131166   131483    32468    50701   53238     53082</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Ariz…   877696  1067210  1024454   990378   274277   482044  511885    514193</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Arka…   449959   482114   483114   486157   205058   291608  294324    298573</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Cali…  6050753  6169427  6202862  6178788  2820611  3335885 3353964.  3478407</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Colo…   724349   842864   853610   863121   195148   336426  348896    358876</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Conn…   562179   552919   543883   549295   143030   190554  194339    201085</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Dela…   114676   128342   128470   127791    37766    61564   62774     66413</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Dist…    68380    71263    72329    75411    47839    52027   45199     46416</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Flor…  2434755  2641555  2668037  2691881  1079009  1479519 1535670   1576379</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 41 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Applying the same approach we used for <code>nces_table1</code> doesn’t give us the structure we want</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>nces_table2 <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>state,                </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">'year'</span>,            </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">'tot_'</span>,        <span class="co"># rename pivoted values by striping the prefix 'tot_'</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">'total_students'</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 408 × 3</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    state   year     total_students</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Alabama 2000             728351</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Alabama 2010             730427</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Alabama 2011             731556</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Alabama 2012             740475</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Alabama frl_2000         335143</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Alabama frl_2010         402386</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Alabama frl_2011         420447</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Alabama frl_2012         429604</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Alaska  2000             105333</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Alaska  2010             132104</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 398 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br><br></p>
<p>The goal is to keep enrollment and lunch data in separate columns and only pivot the years part. To do this, we can provide a character vector (instead of the usual string) for <code>names_to</code> and additionally specify the <code>names_sep</code> argument.</p>
<p>Here, we copy the full description of the <code>names_to</code> and <code>names_sep</code> arguments from the <code>pivot_longer()</code> helpfile</p>
<ul>
<li><code>names_sep</code>: If names_to contains multiple values, these arguments control how the column name is broken up.</li>
<li><code>names_to</code> A string specifying the name of the column to create from the data stored in the column names of data.
<ul>
<li>can be a character vector, creating multiple columns, if names_sep or names_pattern is provided. In this case, there are two special values you can take advantage of:
<ul>
<li><code>NA</code> will discard that component of the name.</li>
<li><code>.value</code> indicates that component of the name defines the name of the column containing the cell values, overriding values_to.</li>
</ul></li>
</ul></li>
</ul>
<p><br><br> How we will use these arguments to reshape <code>nces_table2</code>:</p>
<ul>
<li><code>names_sep</code> specifies the separator to use to separate the column names to 2 parts (e.g., the <code>tot</code>/<code>frl</code> measure part and the years part).</li>
<li><code>names_to</code> Then, we can specify how we want to treat each part inside the <code>names_to</code> vector:
<ul>
<li>Use <code>.value</code> to indicate the part that we want to retain as separate columns (this replaces the need for the <code>values_to</code> argument)</li>
<li>Provide a string to indicate the part to pivot to rows, where the string you provide will become the name of that column (like how we’d normally specify <code>names_to</code>)</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>nces_table2 <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n=</span><span class="dv">5</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 9</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state  tot_2000 tot_2010 tot_2011 tot_2012 frl_2000 frl_2010 frl_2011 frl_2012</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Alaba…   728351   730427   731556   740475   335143   402386  420447    429604</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Alaska   105333   132104   131166   131483    32468    50701   53238     53082</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Arizo…   877696  1067210  1024454   990378   274277   482044  511885    514193</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Arkan…   449959   482114   483114   486157   205058   291608  294324    298573</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Calif…  6050753  6169427  6202862  6178788  2820611  3335885 3353964.  3478407</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>nces_table2 <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>state,                          <span class="co"># pivot all columns except `state`</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">'_'</span>,                  <span class="co"># use '_' as column name separator    </span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">'.value'</span>, <span class="st">'year'</span>)  <span class="co"># keep `tot` &amp; `frl` as separate columns, pivot year values</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 204 × 4</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    state   year      tot    frl</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Alabama 2000   728351 335143</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Alabama 2010   730427 402386</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Alabama 2011   731556 420447</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Alabama 2012   740475 429604</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Alaska  2000   105333  32468</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Alaska  2010   132104  50701</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Alaska  2011   131166  53238</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Alaska  2012   131483  53082</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Arizona 2000   877696 274277</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Arizona 2010  1067210 482044</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 194 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> Note the difference if we used <code>.value</code> as the second element in <code>names_to</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>nces_table2 <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>state,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">'measure'</span>, <span class="st">'.value'</span>),  <span class="co"># pivot `tot`/`frl`, keep years as separate columns</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">'_'</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 102 × 6</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    state      measure  `2000`  `2010`   `2011`  `2012`</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Alabama    tot      728351  730427  731556   740475</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Alabama    frl      335143  402386  420447   429604</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Alaska     tot      105333  132104  131166   131483</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Alaska     frl       32468   50701   53238    53082</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Arizona    tot      877696 1067210 1024454   990378</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Arizona    frl      274277  482044  511885   514193</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Arkansas   tot      449959  482114  483114   486157</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Arkansas   frl      205058  291608  294324   298573</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 California tot     6050753 6169427 6202862  6178788</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 California frl     2820611 3335885 3353964. 3478407</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 92 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p><br> <strong>Practical example</strong> of using the <code>pivot_longer()</code> function <a href="#appendix">in the Appendix</a></p>
</section>
<section id="reshaping-long-to-wide-pivot_wider" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="reshaping-long-to-wide-pivot_wider"><span class="header-section-number">4.2</span> Reshaping long to wide: <code>pivot_wider()</code></h2>
<p><br> <strong>The <code>pivot_wider()</code> function</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>?pivot_wider</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SYNTAX AND DEFAULT VALUES</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(data, <span class="at">id_cols =</span> <span class="cn">NULL</span>, <span class="at">names_from =</span> name,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">names_prefix =</span> <span class="st">""</span>, <span class="at">names_sep =</span> <span class="st">"_"</span>, <span class="at">names_repair =</span> <span class="st">"check_unique"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">values_from =</span> value, <span class="at">values_fill =</span> <span class="cn">NULL</span>, <span class="at">values_fn =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Function: “widens” data, increasing the number of columns and decreasing the number of rows</li>
<li>Arguments:
<ul>
<li><code>data</code>: Dataframe to pivot</li>
<li><code>names_from</code>: Column(s) to get the name of the output column</li>
<li><code>values_from</code>: Column(s) to get the cell values from</li>
</ul></li>
</ul>
<p><br> <strong>Example</strong>: Tidying <code>table2</code> (reshaping long to wide)</p>
<p>As seen previously, the second common reason for untidy data is that multiple variables are stored in one column (e.g., <code>table2</code>):</p>
<ul>
<li>An observation is scattered across multiple rows</li>
<li>One column identifies variable type (e.g., <code>type</code>) and another column contains the values for each variable (e.g., <code>count</code>)</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">745</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">19987071</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">2666</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">20595360</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">37737</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">172006362</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">80488</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">174504898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">212258</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: right;">1999</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">1272915272</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">cases</td>
<td style="text-align: right;">213766</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">population</td>
<td style="text-align: right;">1280428583</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><br> This sort of data structure is very common “in the wild” (e.g., in data that you download), and it is up to you to tidy it before analyses.</p>
<p>The solution to this problem is to transform the untidy rows (which represent different variables) into columns. Thus, we want to transform <code>table2</code> into something that looks like this:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cases</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">745</td>
<td style="text-align: right;">19987071</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">2666</td>
<td style="text-align: right;">20595360</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">37737</td>
<td style="text-align: right;">172006362</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">80488</td>
<td style="text-align: right;">174504898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">China</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">212258</td>
<td style="text-align: right;">1272915272</td>
</tr>
<tr class="even">
<td style="text-align: left;">China</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">213766</td>
<td style="text-align: right;">1280428583</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><br> This can be achieved using <code>pivot_wider()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>table2</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 × 4</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    country      year type            count</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Afghanistan  1999 cases             745</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Afghanistan  1999 population   19987071</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Afghanistan  2000 cases            2666</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Afghanistan  2000 population   20595360</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Brazil       1999 cases           37737</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Brazil       1999 population  172006362</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Brazil       2000 cases           80488</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Brazil       2000 population  174504898</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 China        1999 cases          212258</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 China        1999 population 1272915272</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 China        2000 cases          213766</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12 China        2000 population 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>table2 <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> type,   <span class="co"># values in `type` become variable names</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> count  <span class="co"># values in `count` become values in the new `cases` and `population` cols</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country      year  cases population</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Afghanistan  1999    745   19987071</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Afghanistan  2000   2666   20595360</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Brazil       1999  37737  172006362</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Brazil       2000  80488  174504898</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 China        1999 212258 1272915272</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 China        2000 213766 1280428583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--
1. __names_from__. Column name(s) in the untidy data whose values will become variable names in the tidy data
    - this column name exists as a variable in the untidy data
    - in `table2` this is the `type` column; the values of `type`, `cases` and `population`, will become variable names in the tidy data 

1. __values_from__. Column name(s) in untidy data that contains values for the new variables that will be created in the tidy data
    - this is a varname that exists in the untidy data
    - in `table2` the value column is `count`; the values of `count` will become the values of the new variables `cases` and `population` in the tidy data
-->
<p><br></p>
<details>
<summary>
<strong>Example</strong>: Pivoting with multiple value variables
</summary>
<p><br></p>
<p>Sometimes, we want to spread a dataset that contains multiple value variables. Consider the following example where there are separate enrollment variables for total, men, and women:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ipeds_table1</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 15,726 × 5</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    unitid efytotlt efytotlm efytotlw level</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 100654     6157     2646     3511 all  </span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 100654     4865     2258     2607 ug   </span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 100654     1292      388      904 grad </span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 100663    21554     8383    13171 all  </span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 100663    13440     5552     7888 ug   </span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 100663     8114     2831     5283 grad </span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 100690      830      337      493 all  </span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 100690      415      177      238 ug   </span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 100690      415      160      255 grad </span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 100706     9206     5194     4012 all  </span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 15,716 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> The goal is to turn the values in <code>levels</code> into columns - but which of the enrollment variables should be used as the values for the new columns? The solution is to create columns for each of the enrollment variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ipeds_table1 <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> level,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(efytotlt, efytotlm, efytotlw)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6,951 × 10</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    unitid efytotlt_all efytotlt_ug efytotlt_grad efytotlm_all efytotlm_ug</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;         &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 100654         6157        4865          1292         2646        2258</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 100663        21554       13440          8114         8383        5552</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 100690          830         415           415          337         177</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 100706         9206        6994          2212         5194        3983</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 100724         6101        5373           728         2321        2105</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 100751        41507       35199          6308        18526       15946</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 100760         2379        2379            NA         1027        1027</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 100812         4124        4124            NA         1478        1478</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 100830         5996        5072           924         2158        1847</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 100858        29237       22953          6284        14893       11871</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 6,941 more rows</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 4 more variables: efytotlm_grad &lt;dbl&gt;, efytotlw_all &lt;dbl&gt;,</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   efytotlw_ug &lt;dbl&gt;, efytotlw_grad &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p><br></p>
<p><br> <strong>Practical example</strong> of using the <code>pivot_wider()</code> function <a href="#appendix">in the Appendix</a></p>
</section>
</section>
<section id="missing-values" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Missing values</h1>
<section id="explicit-vs.-implicit-missing-values" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="explicit-vs.-implicit-missing-values"><span class="header-section-number">5.1</span> Explicit vs.&nbsp;Implicit missing values</h2>
<p>There are two types of missing values:</p>
<ul>
<li><strong>Explicit missing values</strong>: variable has the value <code>NA</code> for a particular row</li>
<li><strong>Implicit missing values</strong>: the row is simply not present in the data</li>
</ul>
<p><br> <strong>Example</strong>: Identifying explicit and implicit missing values</p>
<p>Consider the following dataset, which shows stock <code>return</code> for each year and quarter for some hypothetical company:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">qtr</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">return</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.88</td>
</tr>
<tr class="even">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.59</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.35</td>
</tr>
<tr class="even">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.92</td>
</tr>
<tr class="even">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.17</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2.66</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p>The variable <code>return</code> has:</p>
<ul>
<li><strong>1 explicit missing value</strong>: There is an <code>NA</code> in the 4th quarter of 2015</li>
<li><strong>1 implicit missing value</strong>: Data for the 1st quarter of 2016 simply does not exist</li>
</ul>
<p><br> <strong>Practical example</strong> of identifying explicit and implicit missing values <a href="#appendix">in the Appendix</a></p>
</section>
<section id="making-implicit-missing-values-explicit" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="making-implicit-missing-values-explicit"><span class="header-section-number">5.2</span> Making implicit missing values explicit</h2>
<p>An implicit missing value is the result of a row not existing. In order to make an implicit missing value explicit, we need to make the non-existent row exist. This can be done using the <code>complete()</code> function within <code>tidyr</code>.</p>
<p><br> <strong>The <code>complete()</code> function</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>?complete</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SYNTAX AND DEFAULT VALUES</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">complete</span>(data, ..., <span class="at">fill =</span> <span class="fu">list</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Function: Turns implicit missing values into explicit missing values</li>
<li>Arguments:
<ul>
<li><code>data</code>: A dataframe</li>
<li><code>...</code>: Variables to expand on</li>
</ul></li>
<li>Returns: A dataframe object that has all unique combinations of the specified variables, including those not found in the original dataframe</li>
</ul>
<p><br> <strong>Example</strong>: Making implicit missing values explicit</p>
<p>Recall the stocks dataset from the previous example. There was 1 <strong>implicit missing value</strong> for the 1st quarter of 2016 - that row simply did not exist.</p>
<p>If we want to turn that into an <strong>explicit missing value</strong>, then we need the row for the 1st quarter of 2016 to exist. The result would look like this:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">qtr</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">return</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.88</td>
</tr>
<tr class="even">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.59</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.35</td>
</tr>
<tr class="even">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.92</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.17</td>
</tr>
<tr class="even">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2.66</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><br> We can achieve this by using the <code>complete()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>stocks</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 7 × 3</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    year   qtr return</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  2015     1   1.88</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  2015     2   0.59</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  2015     3   0.35</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  2015     4  NA   </span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  2016     2   0.92</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  2016     3   0.17</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7  2016     4   2.66</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>stocks <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(year, qtr)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 8 × 3</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    year   qtr return</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  2015     1   1.88</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  2015     2   0.59</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  2015     3   0.35</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  2015     4  NA   </span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  2016     1  NA   </span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  2016     2   0.92</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7  2016     3   0.17</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8  2016     4   2.66</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> Should you make <strong>implicit</strong> missing values <strong>explicit</strong>?</p>
<ul>
<li>No clear-cut answer - it depends on many context-specific things about your project</li>
<li>The important thing is to be aware of the presence of implicit missing values (both in the “input” datasets you read in and the datasets you create from the inputs) and be purposeful about how you deal with implicit missing values</li>
<li>Recommendation for the stage of creating analysis datasets from input data:
<ul>
<li>If you feel unsure about making implicit values explicit, then make them explicit</li>
<li>This forces you to be more fully aware of patterns of missing data and helps you avoid careless mistakes down the road</li>
<li>After making implicit missing values explicit, you can drop these rows once you are sure you don’t need them</li>
</ul></li>
</ul>
<p><br> <strong>Practical example</strong> of using the <code>complete()</code> function <a href="#appendix">in the Appendix</a></p>
</section>
<section id="reshaping-long-to-wide-missing-values" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="reshaping-long-to-wide-missing-values"><span class="header-section-number">5.3</span> Reshaping long to wide: missing values</h2>
<p>Let’s take a look at what happens with missing values when we reshape from long to wide. Recall the <code>stocks</code> dataset from the earlier example, where we have 1 explicit missing value (2015 4th quarter) and 1 implicit missing value (2016 1st quarter):</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">qtr</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">return</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.88</td>
</tr>
<tr class="even">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.59</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.35</td>
</tr>
<tr class="even">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.92</td>
</tr>
<tr class="even">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.17</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2.66</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><br> When we reshape it from long to wide using <code>pivot_wider()</code>, notice that both implicit and explicit missing values appear as <code>NA</code>. In other words, implicit missing values are automatically turned into explicit missing values. Therefore, there is no need to use <code>complete()</code> prior to pivoting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>stocks <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> qtr,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> return</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1.88</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">2.66</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<p><br> Note that we can no longer tell whether the <code>NA</code>s used to be implicit or explicit missing values, as they are now all explicit. One way to be able to distinguish between them is by specifying the <code>values_fill</code> argument when calling <code>pivot_wider()</code>. This will fill in the previously implicit values with any value of your choice, meaning any <code>NA</code> you see after reshaping must be from the previously explicit missing values. In other words, explicit missing values stay explicit while implicit missing values are filled.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>stocks <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> qtr,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> return,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_fill =</span> <span class="fu">list</span>(<span class="at">return =</span> <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<div class="table-responsive">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1.88</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">-99.00</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">2.66</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
</section>
</section>
<section id="appendix" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Appendix</h1>
<section id="student-exercise-real-world-example-of-wide-to-long" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="student-exercise-real-world-example-of-wide-to-long"><span class="header-section-number">6.1</span> Student exercise: Real-world example of wide to long</h2>
<p>[In the task I present below, fine to just work through solution I have created or try doing on your own before you look at solution]</p>
<p>The following dataset is drawn from Table 204.10 of the NCES Digest for Education Statistics.</p>
<ul>
<li>The table shows change over time in the number and percentage of K-12 students on free/reduced lunch for selected years.</li>
<li><a href="http://nces.ed.gov/programs/digest/d14/tables/dt14_204.10.asp">LINK to website with data</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's take a look at the data (we read in the data in the wide vs long section)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(nces_table)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 51</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Columns: 13</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ state      &lt;chr&gt; "Alabama", "Alaska", "Arizona", "Arkansas", "California", "…</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ tot_2000   &lt;dbl&gt; 728351, 105333, 877696, 449959, 6050753, 724349, 562179, 11…</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ tot_2010   &lt;dbl&gt; 730427, 132104, 1067210, 482114, 6169427, 842864, 552919, 1…</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ tot_2011   &lt;dbl&gt; 731556, 131166, 1024454, 483114, 6202862, 853610, 543883, 1…</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ tot_2012   &lt;dbl&gt; 740475, 131483, 990378, 486157, 6178788, 863121, 549295, 12…</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ frl_2000   &lt;dbl&gt; 335143, 32468, 274277, 205058, 2820611, 195148, 143030, 377…</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ frl_2010   &lt;dbl&gt; 402386, 50701, 482044, 291608, 3335885, 336426, 190554, 615…</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ frl_2011   &lt;dbl&gt; 420447.00, 53238.00, 511885.00, 294324.00, 3353963.72, 3488…</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ frl_2012   &lt;dbl&gt; 429604, 53082, 514193, 298573, 3478407, 358876, 201085, 664…</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ p_frl_2000 &lt;dbl&gt; 46.01394, 30.82415, 31.24966, 45.57260, 46.61587, 26.94116,…</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ p_frl_2010 &lt;dbl&gt; 55.08915, 38.37961, 45.16862, 60.48528, 54.07123, 39.91462,…</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ p_frl_2011 &lt;dbl&gt; 57.47298, 40.58826, 49.96662, 60.92227, 54.07123, 40.87300,…</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ p_frl_2012 &lt;dbl&gt; 58.01735, 40.37176, 51.91886, 61.41493, 56.29594, 41.57887,…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Create smaller version of data frame for purpose of student exercise</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>total<span class="ot">&lt;-</span> nces_table <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state,p_frl_2000,p_frl_2010,p_frl_2011,p_frl_2012)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(total)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 5</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   state      p_frl_2000 p_frl_2010 p_frl_2011 p_frl_2012</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;           &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Alabama          46.0       55.1       57.5       58.0</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Alaska           30.8       38.4       40.6       40.4</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Arizona          31.2       45.2       50.0       51.9</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Arkansas         45.6       60.5       60.9       61.4</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 California       46.6       54.1       54.1       56.3</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Colorado         26.9       39.9       40.9       41.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Task (using the data frame <code>total</code>)</strong>:</p>
<ol type="1">
<li>Diagnose the problem with the data frame <code>total</code></li>
<li>Sketch out what the tidy data should look like<br>
</li>
<li>Transform untidy to tidy. hint: use <code>names_prefix</code></li>
</ol>
<p><br></p>
<details>
<summary>
<strong>Solution to student exercise:</strong>
</summary>
<p><br></p>
<ol type="1">
<li>Diagnose the problem with the data frame <code>total</code>
<ul>
<li>Column names <code>p_frl_2000</code>, <code>p_frl_2010</code>, etc. are not variables; rather they refer to values of the variable <code>year</code></li>
<li>Currently each observation represents a state with separate number of students on FRL variables for each year.</li>
<li>Each observation <em>should</em> be a state-year, with only one variable for FRL</li>
</ul></li>
<li>Sketch out what the tidy data should look like<br>
</li>
<li>Transform untidy to tidy
<ul>
<li><strong>names</strong> of the set of columns that represent values, not variables in your untidy data
<ul>
<li><code>p_frl_2000,p_frl_2010,p_frl_2011,p_frl_2012</code></li>
</ul></li>
<li><strong>names_to</strong> : variable name you will assign to columns you are gathering from the untidy data
<ul>
<li>This var doesn’t yet exist in untidy data, but will be a variable name in the tidy data</li>
<li>In this example, it’s year</li>
</ul></li>
<li><strong>values_to</strong>: The name of the variable that will contain values in the tidy dataset you create and whose values are spread across multiple columns in the untidy dataset
<ul>
<li>This var doesn’t yet exist in untidy data, but will be a variable name in the tidy data</li>
<li>in this example, the value variable is frl_students</li>
</ul></li>
</ul></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>total <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"p_frl_"</span>),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> (<span class="st">"p_frl_"</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"pct_frl"</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 204 × 3</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    state   year  pct_frl</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Alabama 2000     46.0</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Alabama 2010     55.1</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Alabama 2011     57.5</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Alabama 2012     58.0</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Alaska  2000     30.8</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Alaska  2010     38.4</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Alaska  2011     40.6</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Alaska  2012     40.4</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Arizona 2000     31.2</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Arizona 2010     45.2</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 194 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</section>
<section id="student-exercise-real-world-example-of-reshaping-long-to-wide" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="student-exercise-real-world-example-of-reshaping-long-to-wide"><span class="header-section-number">6.2</span> Student exercise: real-world example of reshaping long to wide</h2>
<p>[In the task I present below, fine to just work through solution I have created or try doing on your own before you look at solution]</p>
<p><br> The Integrated Postsecondary Education Data System (IPEDS) collects data on colleges and universities</p>
<ul>
<li>Below we load IPEDS data on 12-month enrollment headcount for 2015-16 academic year</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load these libraries if you haven't already</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">#library(haven)</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#library(labelled)</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ipeds_table &lt;- read_dta(file="https://github.com/ozanj/rclass/raw/master/data/ipeds/effy/ey15-16_hc.dta", encoding=NULL)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create smaller version of dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ipeds_hc &lt;- ipeds_table %&gt;% select(instnm,unitid,lstudy,efytotlt,efytotlm,efytotlw)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>ipeds_hc <span class="ot">&lt;-</span> ipeds_table <span class="sc">%&gt;%</span> <span class="fu">select</span>(instnm,unitid,lstudy,efytotlt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Get to know data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ipeds_hc)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   instnm                              unitid lstudy                efytotlt</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;dbl&gt; &lt;dbl+lbl&gt;                &lt;dbl&gt;</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Alabama A &amp; M University            100654 999 [Generated total]     6157</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Alabama A &amp; M University            100654   1 [Undergraduate]       4865</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Alabama A &amp; M University            100654   3 [Graduate]            1292</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 University of Alabama at Birmingham 100663 999 [Generated total]    21554</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 University of Alabama at Birmingham 100663   1 [Undergraduate]      13440</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 University of Alabama at Birmingham 100663   3 [Graduate]            8114</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ipeds_hc)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; tibble [15,726 × 4] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ instnm  : chr [1:15726] "Alabama A &amp; M University" "Alabama A &amp; M University" "Alabama A &amp; M University" "University of Alabama at Birmingham" ...</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, "label")= chr "Institution (entity) name"</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, "format.stata")= chr "%91s"</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ unitid  : num [1:15726] 100654 100654 100654 100663 100663 ...</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, "label")= chr "Unique identification number of the institution"</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, "format.stata")= chr "%12.0g"</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ lstudy  : dbl+lbl [1:15726] 999,   1,   3, 999,   1,   3, 999,   1,   3, 999,   ...</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    ..@ label       : chr "Original level of study on survey form"</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    ..@ format.stata: chr "%15.0g"</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    ..@ labels      : Named num [1:3] 1 3 999</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    .. ..- attr(*, "names")= chr [1:3] "Undergraduate" "Graduate" "Generated total"</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ efytotlt: num [1:15726] 6157 4865 1292 21554 13440 ...</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, "label")= chr "Grand total"</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, "format.stata")= chr "%12.0g"</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, "label")= chr "dct_s2015_is"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Variable labels</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>ipeds_hc <span class="sc">%&gt;%</span> <span class="fu">var_label</span>()</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $instnm</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "Institution (entity) name"</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $unitid</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "Unique identification number of the institution"</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $lstudy</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "Original level of study on survey form"</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $efytotlt</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "Grand total"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Only the variable lstudy has value labels</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>ipeds_hc <span class="sc">%&gt;%</span> <span class="fu">select</span>(lstudy) <span class="sc">%&gt;%</span> <span class="fu">val_labels</span>()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $lstudy</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Undergraduate        Graduate Generated total </span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               1               3             999</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Student Task</strong>:</p>
<ol type="1">
<li>Diagnose the problem with the data frame <code>ipeds_hc</code> (why is it untidy?)</li>
<li>Sketch out what the tidy data should look like<br>
</li>
<li>Transform untidy to tidy</li>
</ol>
<p><br></p>
<details>
<summary>
<strong>Solution to student task:</strong>
</summary>
<p><br></p>
<p><strong>1. Diagnose the problem with the data frame</strong> - First, let’s investigate the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>ipeds_hc <span class="ot">&lt;-</span> ipeds_hc <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(unitid, lstudy)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ipeds_hc, <span class="at">n=</span><span class="dv">20</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 20 × 4</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    instnm                              unitid lstudy                efytotlt</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;                                &lt;dbl&gt; &lt;dbl+lbl&gt;                &lt;dbl&gt;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Alabama A &amp; M University            100654   1 [Undergraduate]       4865</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Alabama A &amp; M University            100654   3 [Graduate]            1292</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Alabama A &amp; M University            100654 999 [Generated total]     6157</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 University of Alabama at Birmingham 100663   1 [Undergraduate]      13440</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 University of Alabama at Birmingham 100663   3 [Graduate]            8114</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 University of Alabama at Birmingham 100663 999 [Generated total]    21554</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Amridge University                  100690   1 [Undergraduate]        415</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Amridge University                  100690   3 [Graduate]             415</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Amridge University                  100690 999 [Generated total]      830</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 University of Alabama in Huntsville 100706   1 [Undergraduate]       6994</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 University of Alabama in Huntsville 100706   3 [Graduate]            2212</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12 University of Alabama in Huntsville 100706 999 [Generated total]     9206</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13 Alabama State University            100724   1 [Undergraduate]       5373</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14 Alabama State University            100724   3 [Graduate]             728</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15 Alabama State University            100724 999 [Generated total]     6101</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16 The University of Alabama           100751   1 [Undergraduate]      35199</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 17 The University of Alabama           100751   3 [Graduate]            6308</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 18 The University of Alabama           100751 999 [Generated total]    41507</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 19 Central Alabama Community College   100760   1 [Undergraduate]       2379</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 20 Central Alabama Community College   100760 999 [Generated total]     2379</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#code to investigate what each observation represents</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#I'll break this code down next week when we talk about joining data frames</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>ipeds_hc <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(unitid,lstudy) <span class="sc">%&gt;%</span> <span class="co"># group_by our candidate</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_per_id=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="co"># calculate number of obs per group</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="co"># ungroup the data</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_per_id<span class="sc">==</span><span class="dv">1</span>) <span class="co"># count "true that only one obs per group"</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   `n_per_id == 1`     n</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;lgl&gt;           &lt;int&gt;</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 TRUE            15726</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Summary of problems with the data frame:</p>
<ul>
<li>In the untidy data frame, each row represents college-level_of_study
<ul>
<li>there are separate rows for each value of level of study (<code>undergraduate</code>, <code>graduate</code>, <code>generated total</code>)</li>
<li>so three rows for each college</li>
</ul></li>
<li>the values of the column <code>lstudy</code> represent different attributes (<code>undergraduate</code>, <code>graduate</code>, <code>generated total</code>)
<ul>
<li>each of these attributes should be its own variable</li>
</ul></li>
</ul>
<p><strong>2. Sketch out what the tidy data should look like</strong> (sketch out on your own)</p>
<ul>
<li>What tidy data should look like:
<ul>
<li>Each observation (row) should be a college</li>
<li>There should be separate variables for each level of study, with each variable containing enrollment for that level of study</li>
</ul></li>
</ul>
<p><strong>3. Transform untidy to tidy</strong></p>
<ul>
<li><strong>names_from</strong>. Column name in the untidy data whose values will become variable names in the tidy data that contains variable names
<ul>
<li>this variable name exists in the untidy data</li>
<li>in <code>ipeds_hc</code> the key column is <code>lstudy</code>; the values of <code>lstudy</code>, will become variable names in the tidy data</li>
</ul></li>
<li><strong>values_from</strong>. Column name in untidy data that contains values for the new variables that will be created in the tidy data
<ul>
<li>this is a varname that exists in the untidy data</li>
<li>in <code>ipeds_hc</code> the value column is <code>efytotlt</code>; the values of <code>efytotlt</code> will become the values of the new variables in the tidy data</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ipeds_hc <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> lstudy, <span class="at">values_from =</span> efytotlt) <span class="co">#notice it uses the underlying data not labels</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6,951 × 5</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    instnm                              unitid   `1`   `3` `999`</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;                                &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Alabama A &amp; M University            100654  4865  1292  6157</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 University of Alabama at Birmingham 100663 13440  8114 21554</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Amridge University                  100690   415   415   830</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 University of Alabama in Huntsville 100706  6994  2212  9206</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Alabama State University            100724  5373   728  6101</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 The University of Alabama           100751 35199  6308 41507</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Central Alabama Community College   100760  2379    NA  2379</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Athens State University             100812  4124    NA  4124</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Auburn University at Montgomery     100830  5072   924  5996</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Auburn University                   100858 22953  6284 29237</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 6,941 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p><br></p>
<details>
<summary>
<strong>Alternative solution:</strong>
</summary>
<p><br></p>
<p>Helpful to create a character version of variable lstudy prior to spreading</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>ipeds_hc <span class="sc">%&gt;%</span> <span class="fu">select</span>(lstudy) <span class="sc">%&gt;%</span> <span class="fu">val_labels</span>()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $lstudy</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Undergraduate        Graduate Generated total </span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               1               3             999</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ipeds_hc<span class="sc">$</span>lstudy)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  dbl+lbl [1:15726]   1,   3, 999,   1,   3, 999,   1,   3, 999,   1,   3, 9...</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  @ label       : chr "Original level of study on survey form"</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  @ format.stata: chr "%15.0g"</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  @ labels      : Named num [1:3] 1 3 999</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, "names")= chr [1:3] "Undergraduate" "Graduate" "Generated total"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>ipeds_hcv2 <span class="ot">&lt;-</span> ipeds_hc <span class="sc">%&gt;%</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">level =</span> <span class="fu">recode</span>(<span class="fu">as.integer</span>(lstudy),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"ug"</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">3</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"grad"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">999</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"all"</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>lstudy) <span class="co"># drop variable lstudy</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ipeds_hcv2)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   instnm                              unitid efytotlt level</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Alabama A &amp; M University            100654     4865 ug   </span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Alabama A &amp; M University            100654     1292 grad </span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Alabama A &amp; M University            100654     6157 all  </span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 University of Alabama at Birmingham 100663    13440 ug   </span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 University of Alabama at Birmingham 100663     8114 grad </span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 University of Alabama at Birmingham 100663    21554 all</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>ipeds_hcv2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(instnm,unitid,level,efytotlt) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> level, <span class="at">values_from =</span> efytotlt) <span class="co">#nicer!</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6,951 × 5</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    instnm                              unitid    ug  grad   all</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;                                &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Alabama A &amp; M University            100654  4865  1292  6157</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 University of Alabama at Birmingham 100663 13440  8114 21554</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Amridge University                  100690   415   415   830</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 University of Alabama in Huntsville 100706  6994  2212  9206</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Alabama State University            100724  5373   728  6101</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 The University of Alabama           100751 35199  6308 41507</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Central Alabama Community College   100760  2379    NA  2379</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Athens State University             100812  4124    NA  4124</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Auburn University at Montgomery     100830  5072   924  5996</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Auburn University                   100858 22953  6284 29237</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 6,941 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</section>
<section id="missing-variables-example-using-ipeds" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="missing-variables-example-using-ipeds"><span class="header-section-number">6.3</span> Missing variables example using IPEDS</h2>
<p>This section deals with missing variables and tidying data.</p>
<p>But first, it is helpful to create a new version of the IPEDS enrollment dataset as follows:</p>
<ul>
<li><p>keeps observations for for-profit colleges</p></li>
<li><p>keeps the following enrollment variables:</p>
<ul>
<li>total enrollment</li>
<li>enrollment of students who identify as “Black or African American”</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>ipeds_hc_na <span class="ot">&lt;-</span> ipeds_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sector <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>)) <span class="sc">%&gt;%</span> <span class="co">#keep only for-profit colleges</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(instnm,unitid,lstudy,efytotlt,efybkaam) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">level =</span> <span class="fu">recode</span>(<span class="fu">as.integer</span>(lstudy), <span class="co"># create recoded version of lstudy</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"ug"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">3</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"grad"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">999</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"all"</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(instnm,unitid,level,efytotlt,efybkaam) <span class="sc">%&gt;%</span> </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(unitid,<span class="fu">desc</span>(level))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<p>Now, let’s print some rows</p>
<ul>
<li>There is one row for each college-level_of_study</li>
<li>Some colleges have three rows of data (ug, grad, all)</li>
<li>Colleges that don’t have any undergraduates or don’t have any graduate students only have two rows of data</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ipeds_hc_na</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6,265 × 5</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    instnm                               unitid level efytotlt efybkaam</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;                                 &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 South University-Montgomery          101116 ug         777      122</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 South University-Montgomery          101116 grad       218       40</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 South University-Montgomery          101116 all        995      162</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 New Beginning College of Cosmetology 101277 ug         132        0</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 New Beginning College of Cosmetology 101277 all        132        0</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Herzing University-Birmingham        101365 ug         675       73</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Herzing University-Birmingham        101365 grad        15        5</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Herzing University-Birmingham        101365 all        690       78</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Prince Institute-Southeast           101958 ug          34        0</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Prince Institute-Southeast           101958 all         34        0</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 6,255 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s create new versions of the enrollment variables, that replace <code>0</code> with <code>NA</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>ipeds_hc_na <span class="ot">&lt;-</span> ipeds_hc_na <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">efytotltv2 =</span> <span class="fu">ifelse</span>(efytotlt <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, efytotlt),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">efybkaamv2 =</span> <span class="fu">ifelse</span>(efybkaam <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, efybkaam)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(instnm,unitid,level,efytotlt,efytotltv2,efybkaam,efybkaamv2)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>ipeds_hc_na <span class="sc">%&gt;%</span> <span class="fu">select</span>(unitid,level,efytotlt,efytotltv2,efybkaam,efybkaamv2)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6,265 × 6</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    unitid level efytotlt efytotltv2 efybkaam efybkaamv2</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 101116 ug         777        777      122        122</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 101116 grad       218        218       40         40</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 101116 all        995        995      162        162</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 101277 ug         132        132        0         NA</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 101277 all        132        132        0         NA</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 101365 ug         675        675       73         73</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 101365 grad        15         15        5          5</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 101365 all        690        690       78         78</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 101958 ug          34         34        0         NA</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 101958 all         34         34        0         NA</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 6,255 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create dataset that drops the original enrollment variables, keeps enrollment vars that replace <code>0</code> with <code>NA</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>ipeds_hc_nav2 <span class="ot">&lt;-</span> ipeds_hc_na <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>efytotlt,<span class="sc">-</span>efybkaam)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can introduce the concepts of <em>explicit</em> and <em>implicit</em> missing values</p>
<p>There are two types of missing values:</p>
<ul>
<li><strong>Explicit missing values</strong>: variable has the value <code>NA</code> for a parcitular row</li>
<li><strong>Implicit missing values</strong>: the row is simply not present in the data</li>
</ul>
<p>Let’s print data for the first two colleges</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>ipeds_hc_nav2 <span class="sc">%&gt;%</span> <span class="fu">head</span>( <span class="at">n=</span><span class="dv">5</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 5</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   instnm                               unitid level efytotltv2 efybkaamv2</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                 &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 South University-Montgomery          101116 ug           777        122</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 South University-Montgomery          101116 grad         218         40</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 South University-Montgomery          101116 all          995        162</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 New Beginning College of Cosmetology 101277 ug           132         NA</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 New Beginning College of Cosmetology 101277 all          132         NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>South University-Montgomery</code> has three rows:</p>
<ul>
<li>variable <code>efytotltv2</code> has <code>0</code> explicit missing values and <code>0</code> implicit missing values</li>
<li>variable <code>efybkaamv2</code> has <code>0</code> explicit missing values and <code>0</code> implicit missing values</li>
</ul>
<p><code>New Beginning College of Cosmetology</code> has two rows (because they have no graduate students):</p>
<ul>
<li>variable <code>efytotltv2</code> has <code>0</code> explicit missing values and <code>1</code> implicit missing values (no row for grad students)</li>
<li>variable <code>efybkaamv2</code> has <code>2</code> explicit missing values and <code>1</code> implicit missing values (no row for grad students)</li>
</ul>
</section>
<section id="applying-complete-to-ipeds-dataset" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="applying-complete-to-ipeds-dataset"><span class="header-section-number">6.4</span> Applying complete() to IPEDS dataset</h2>
<p>Let’s apply <code>complete()</code> to our IPEDS dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>ipeds_hc_nav2</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6,265 × 5</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    instnm                               unitid level efytotltv2 efybkaamv2</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;                                 &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 South University-Montgomery          101116 ug           777        122</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 South University-Montgomery          101116 grad         218         40</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 South University-Montgomery          101116 all          995        162</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 New Beginning College of Cosmetology 101277 ug           132         NA</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 New Beginning College of Cosmetology 101277 all          132         NA</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Herzing University-Birmingham        101365 ug           675         73</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Herzing University-Birmingham        101365 grad          15          5</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Herzing University-Birmingham        101365 all          690         78</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Prince Institute-Southeast           101958 ug            34         NA</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Prince Institute-Southeast           101958 all           34         NA</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 6,255 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>ipeds_complete <span class="ot">&lt;-</span> ipeds_hc_nav2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(unitid,level,efytotltv2,efybkaamv2) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(unitid, level)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>ipeds_complete</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 9,063 × 4</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    unitid level efytotltv2 efybkaamv2</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 101116 all          995        162</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 101116 grad         218         40</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 101116 ug           777        122</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 101277 all          132         NA</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 101277 grad          NA         NA</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 101277 ug           132         NA</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 101365 all          690         78</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 101365 grad          15          5</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 101365 ug           675         73</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 101958 all           34         NA</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 9,053 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Confirm that the "complete" dataset always has three observations per unitid</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>ipeds_complete <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(unitid) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">count</span>(n)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Storing counts in `nn`, as `n` already present in input</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n    nn</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     3  3021</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Note that previous dataset did not</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>ipeds_hc_nav2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(unitid) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">count</span>(n)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Storing counts in `nn`, as `n` already present in input</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       n    nn</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     2  2798</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     3   223</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--
### Tables and observational unit

A particular project or data collection (e.g., longitudinal survey tracking student achievement from high school through college), may require several data sources:

- data on student characteristics (e.g., name, date of birth) with one observation per student
- data on the high school the student attends with one observation per school
- transcript data with one observation per student-course, etc.

Each of these data sources may use a different "level of observation" and each requiring a different "table" (i.e., dataframe):

- "Table" is the term database people use for what we would refer to as a "dataset" or a "data frame"
- We talk more about "tables" next week, which is about joining/merging data frames

<br>
__Observational unit/observational level__ [Wickham's term, not mine]

> "In a given analysis, there may be multiple __levels of observations__. For example, in a trial of new allergy medication we might have three observational types: demographic data collected from each person (age, sex, race), medical data collected from each person on each day (number of sneezes, redness of eyes), and meteorological data collected on each day (temperature,pollen count) (Wickham 2014, p. 4)"

<br>
So Wickham defines __observational unit/observational level__ as what each row __should__ represent in an appropriately structured data frame

### Summary/parting thoughts

These data concepts (e.g., value, variable, observation) seem easy on first glance, but can feel slippery on closer inspection. 

In particular, when you confronted with a particular dataset, sometimes it can feel confusing what the variables/observations/unit of analysis __are__ (data structure) and what they __should be__ (data concepts).


## Student exercise:

For each of the following datasets -- `table1`, `table3`, `table4a`, and `table5` -- answer the following questions:

1. Does each variable have its own column?
    - if not, how does the dataset violate this principle?
    - what _should_ the variables be?
1. Does each observation have its own row?
    - if not, how does the dataset violate this principle?
    - what does each row represent _actually_ represent?
    - what _should_ each row represent?
1. Does each value  have its own cell."
    - if not, how does the dataset violate this principle?

We'll give you ~15 minutes for this

<br>
__ANSWERS TO STUDENT EXERCISE BELOW__:

### `table1`
::: {.cell}

```{.r .cell-code}
table1
#> # A tibble: 6 × 4
#>   country      year  cases population
#>   <chr>       <dbl>  <dbl>      <dbl>
#> 1 Afghanistan  1999    745   19987071
#> 2 Afghanistan  2000   2666   20595360
#> 3 Brazil       1999  37737  172006362
#> 4 Brazil       2000  80488  174504898
#> 5 China        1999 212258 1272915272
#> 6 China        2000 213766 1280428583
```
:::
1. Does each variable have its own column? YES
1. Does each observation have its own row? YES
    - what does each row represent _actually_ represent? COUNTRY-YEAR
    - what _should_ each row represent? COUNTERY-YEAR
1. Does each value  have its own cell." YES

### `table3`
::: {.cell}

```{.r .cell-code}
table3
#> # A tibble: 6 × 3
#>   country      year rate             
#>   <chr>       <dbl> <chr>            
#> 1 Afghanistan  1999 745/19987071     
#> 2 Afghanistan  2000 2666/20595360    
#> 3 Brazil       1999 37737/172006362  
#> 4 Brazil       2000 80488/174504898  
#> 5 China        1999 212258/1272915272
#> 6 China        2000 213766/1280428583
```
:::

1. Does each variable have its own column? __No__
    - if not, how does the dataset violate this principle? __The column `rate` contains two variables, `cases` and `population`__
    - what _should_ the variables be? __country, year, cases, population__
1. Does each observation have its own row? __Yes__
    - what does each row represent _actually_ represent? __country-year__
    - what _should_ each row represent? __country-year__
1. Does each value  have its own cell." __No__
    - if not, how does the dataset violate this principle? __In the `rate` column, each cell contains two values, a value for `cases` and a value for `population`__
    
### `table4a`
::: {.cell}

```{.r .cell-code}
table4a
#> # A tibble: 3 × 3
#>   country     `1999` `2000`
#>   <chr>        <dbl>  <dbl>
#> 1 Afghanistan    745   2666
#> 2 Brazil       37737  80488
#> 3 China       212258 213766
```
:::
1. Does each variable have its own column? __No__
    - if not, how does the dataset violate this principle? __The variable `cases` is spread over two columns and the variable `year` is also spread over two columns__
    - what _should_ the variables be? __country, year, cases__
1. Does each observation have its own row? __No__
    - if not, how does the dataset violate this principle? __There are two country-year observations on each row__
    - what does each row represent _actually_ represent? __country__
    - what _should_ each row represent? __country-year__
1. Does each value  have its own cell." __Yes__

### `table4b` [not required to answer]
::: {.cell}

```{.r .cell-code}
table4b
#> # A tibble: 3 × 3
#>   country         `1999`     `2000`
#>   <chr>            <dbl>      <dbl>
#> 1 Afghanistan   19987071   20595360
#> 2 Brazil       172006362  174504898
#> 3 China       1272915272 1280428583
```
:::
Answers pretty much the same as `table4a`, except `table4b` shows data for `population` rather than `cases'

### `table5`
::: {.cell}

```{.r .cell-code}
table5
#> # A tibble: 6 × 4
#>   country     century year  rate             
#>   <chr>       <chr>   <chr> <chr>            
#> 1 Afghanistan 19      99    745/19987071     
#> 2 Afghanistan 20      00    2666/20595360    
#> 3 Brazil      19      99    37737/172006362  
#> 4 Brazil      20      00    80488/174504898  
#> 5 China       19      99    212258/1272915272
#> 6 China       20      00    213766/1280428583
```
:::
1. Does each variable have its own column? __No__
    - if not, how does the dataset violate this principle? __Two problems. First, the single variable `year' is spread across two columns `century` and `year`. Second, the `rate` column contains the two variables `cases` and `population`__
    - what _should_ the variables be? __country, year, cases, population__
1. Does each observation have its own row? __Yes__
    - what does each row represent _actually_ represent? __country, year__
    - what _should_ each row represent?  __country, year__
1. Does each value  have its own cell?" __No__
    - if not, how does the dataset violate this principle? __Two problems. First, the each value of `year' is spread across two cells. Second, the each cell of the `rate` column contains two values, one for `cases` and one for `population`__

## Revisiting definitions of variables and observations

Worthwhile to revisit Wickham's (2014) defintions of _variables_, and _observations_ in light of what we now know about tidy vs. untidy data.

Whenever I work with datasets I tend to think of observations as being synonomous with rows and variables as being synonomous with columns. But if we use Wickham's definitions of observations and variables, this is not true.

- Wickham definition of __variables__: "A variable contains all values that measure the same underlying attribute (like height, temperature, duration) across units"
    - In a tidy dataset, variables and columns are the same thing. 
    - In an untidy dataset, variables and columns are not the same thing; a single variable (i.e., attribute) may be represented by two columns 
        - For example, in `table2` the attribute `population` was represented by two columns, `type` and `count`
- Wickham definition of __observations__: "An observation contains all values measured on the same unit (like a person, or a day)...across attributes"
    - In a tidy dataset, an observations is the same thing as a row
    - In an untidy dataset, the values for a particular unit may be spread across multiple rows. 
        - For example, in `table1` and `table2` Wickham would think of `country-year` as the proper __observational unit__. `table1` has one row per `country-year` (tidy) but `table2` has two rows per `country-year` (untidy). 
        
<br>
__"Observational unit" (data concept) vs. "unit of analysis" (my term; data structure)__

- __observational unit__. Wickham tends to think of observational unit as what each observation should represent (e.g., a person, a person-year) in a tidy dataset
- __unit of analysis__. By contrast (right or wrong), I tend to think of "unit of analysis" as what each row of data _actually_ represents (e.g., country-year-type)

<br>
__Takeways from this discussion of formal data concepts and tidy vs. untidy data__

- In everyday usage, the terms _variable_ and _observation_ refer to data structure, with :
    - variables=columns
    - observations=rows
- In Wickham's definition, the terms _variables_ and _observation_ refer to data contents, with:
    - A variable containing all values of one attribute for all _units_
    - An observation contains the value of all attributes for one _unit_ 
- Can think of Wickham's definitions of variables and observations as belonging only to tidy datasets.
    - Based on Wickham's definition, variables=columns and observations=rows __only__ if the dataset is tidy
    - Can think of Wickham's definitions of variables and observations as what _should be_. 
    
<br>
In real world, we encounter many untidy datasets. We can still equate variables with columns and rows with observations. 

- Just be mindful that you are using the "everyday" definitions of variables and observations rather than the Wickham definitions.


## Why tidy data 

Why should you create tidy datasets before conducting analyses?

1. If you have a consistent organizational structure for analysis datasets, easier to learn tools for analyzing data

2. tidy datasets are optimal for R
- Base R functions and tidyverse functions are designed to work with vectors of values
- In a tidy dataset, each column is the vector of values for a given variable, as shown below

::: {.cell}

```{.r .cell-code}
str(table1)
#> tibble [6 × 4] (S3: tbl_df/tbl/data.frame)
#>  $ country   : chr [1:6] "Afghanistan" "Afghanistan" "Brazil" "Brazil" ...
#>  $ year      : num [1:6] 1999 2000 1999 2000 1999 ...
#>  $ cases     : num [1:6] 745 2666 37737 80488 212258 ...
#>  $ population: num [1:6] 2.00e+07 2.06e+07 1.72e+08 1.75e+08 1.27e+09 ...
```

```{.r .cell-code}
str(table1$country)
#>  chr [1:6] "Afghanistan" "Afghanistan" "Brazil" "Brazil" "China" "China"
```

```{.r .cell-code}
str(table1$cases)
#>  num [1:6] 745 2666 37737 80488 212258 ...
```
:::
<br>
__Example__:

- how would you calculate `rate` variable (`=cases/population*10000`) for `table1` (tidy) and `table2` (untidy)

::: {.cell}

```{.r .cell-code}
table1
#> # A tibble: 6 × 4
#>   country      year  cases population
#>   <chr>       <dbl>  <dbl>      <dbl>
#> 1 Afghanistan  1999    745   19987071
#> 2 Afghanistan  2000   2666   20595360
#> 3 Brazil       1999  37737  172006362
#> 4 Brazil       2000  80488  174504898
#> 5 China        1999 212258 1272915272
#> 6 China        2000 213766 1280428583
```

```{.r .cell-code}
table1 %>% 
  mutate(rate = cases / population * 10000)
#> # A tibble: 6 × 5
#>   country      year  cases population  rate
#>   <chr>       <dbl>  <dbl>      <dbl> <dbl>
#> 1 Afghanistan  1999    745   19987071 0.373
#> 2 Afghanistan  2000   2666   20595360 1.29 
#> 3 Brazil       1999  37737  172006362 2.19 
#> 4 Brazil       2000  80488  174504898 4.61 
#> 5 China        1999 212258 1272915272 1.67 
#> 6 China        2000 213766 1280428583 1.67
```

```{.r .cell-code}

#Just looking at table2, obvious that calculating rate is much harder
table2
#> # A tibble: 12 × 4
#>    country      year type            count
#>    <chr>       <dbl> <chr>           <dbl>
#>  1 Afghanistan  1999 cases             745
#>  2 Afghanistan  1999 population   19987071
#>  3 Afghanistan  2000 cases            2666
#>  4 Afghanistan  2000 population   20595360
#>  5 Brazil       1999 cases           37737
#>  6 Brazil       1999 population  172006362
#>  7 Brazil       2000 cases           80488
#>  8 Brazil       2000 population  174504898
#>  9 China        1999 cases          212258
#> 10 China        1999 population 1272915272
#> 11 China        2000 cases          213766
#> 12 China        2000 population 1280428583
```
:::

### Caveat: But tidy data not always best

Datasets are often stored in an untidy structure rather than a tidy structure when the untidy structure has a smaller file size than the tidy structure

- smaller file-size leads to faster processing time, which is very important for web applications (e.g., facebook) and data visualizations (e.g., interactive maps)

## Legacy concepts: "Long" vs. "wide" data

Prior to Wickham (2014) and the creation of the "tidyverse," the concepts of "tidy"/"untidy" (adjective) data and "tidying" (verb) did not exist.  

Instead, researchers would "reshape" (verb) data from "long" (adjective) to "wide" (adjective) and vice-versa

Think "wide" and "long" as alternative presentations of the exact same data.ß

__"wide" data__ represented with fewer rows and more columns  
__"long" data__ represented with more rows and fewer columns

Example, Table 204.10 of the Digest for Education Statistics shows changer over time in the number and percentage of K-12 students on free/reduced lunch [LINK](http://nces.ed.gov/programs/digest/d14/tables/dt14_204.10.asp)

- Wide form display of data:
::: {.cell}

```{.r .cell-code}
#load("data/nces_digest/nces_digest_table_204_10.RData")
load(url("https://github.com/ozanj/rclass/raw/master/data/nces_digest/nces_digest_table_204_10.RData"))
table204_10
#> # A tibble: 51 × 13
#>    state tot_2000 tot_2010 tot_2011 tot_2012 frl_2000 frl_2010 frl_2011 frl_2012
#>    <chr>    <dbl>    <dbl>    <dbl>    <dbl>    <dbl>    <dbl>    <dbl>    <dbl>
#>  1 Alab…   728351   730427   731556   740475   335143   402386  420447    429604
#>  2 Alas…   105333   132104   131166   131483    32468    50701   53238     53082
#>  3 Ariz…   877696  1067210  1024454   990378   274277   482044  511885    514193
#>  4 Arka…   449959   482114   483114   486157   205058   291608  294324    298573
#>  5 Cali…  6050753  6169427  6202862  6178788  2820611  3335885 3353964.  3478407
#>  6 Colo…   724349   842864   853610   863121   195148   336426  348896    358876
#>  7 Conn…   562179   552919   543883   549295   143030   190554  194339    201085
#>  8 Dela…   114676   128342   128470   127791    37766    61564   62774     66413
#>  9 Dist…    68380    71263    72329    75411    47839    52027   45199     46416
#> 10 Flor…  2434755  2641555  2668037  2691881  1079009  1479519 1535670   1576379
#> # ℹ 41 more rows
#> # ℹ 4 more variables: p_frl_2000 <dbl>, p_frl_2010 <dbl>, p_frl_2011 <dbl>,
#> #   p_frl_2012 <dbl>
```
:::
__Task__: Reshape `table204_10`from wide to long

`gather()` from G&W can't deal with complex variable names and can't reshape multiple columns (will discuss this shortly): 
::: {.cell}

```{.r .cell-code}
total <- table204_10 %>%
  select(state,tot_2000,tot_2010,tot_2011,tot_2012) #subset and assign to new object
names(total)<-c("state","2000","2010","2011","2012") #change names for year "tot_2010" -> "2010"

total_long <- total %>% 
  gather(`2000`,`2010`,`2011`,`2012`,key=year,value=total_students) %>% 
  arrange(state, year) #arrange by state and year

head(total_long, n=10) #view 10 obs
#> # A tibble: 10 × 3
#>    state                         year  total_students
#>    <chr>                         <chr>          <dbl>
#>  1 Alabama ....................  2000          728351
#>  2 Alabama ....................  2010          730427
#>  3 Alabama ....................  2011          731556
#>  4 Alabama ....................  2012          740475
#>  5 Alaska ..................     2000          105333
#>  6 Alaska ..................     2010          132104
#>  7 Alaska ..................     2011          131166
#>  8 Alaska ..................     2012          131483
#>  9 Arizona ..................... 2000          877696
#> 10 Arizona ..................... 2010         1067210
```
:::

`pivot_longer` can do the same task, but it can handle reshaping multiple columns and complex patterns at the same time (although, you won't be able handle complicated patterns until you learn regular expressions)
::: {.cell}

```{.r .cell-code}

total %>%
  pivot_longer(
    cols = (c("2000","2010", "2011", "2012")),
    names_to = "year",
    values_to = "total_students"
  )
#> # A tibble: 204 × 3
#>    state                         year  total_students
#>    <chr>                         <chr>          <dbl>
#>  1 Alabama ....................  2000          728351
#>  2 Alabama ....................  2010          730427
#>  3 Alabama ....................  2011          731556
#>  4 Alabama ....................  2012          740475
#>  5 Alaska ..................     2000          105333
#>  6 Alaska ..................     2010          132104
#>  7 Alaska ..................     2011          131166
#>  8 Alaska ..................     2012          131483
#>  9 Arizona ..................... 2000          877696
#> 10 Arizona ..................... 2010         1067210
#> # ℹ 194 more rows
```
:::



Note that the concepts "wide" vs. "long" are relative rather than absolute

- For example, comparing `table4a` and `table1`: `table4a` is wide and `table1` is long
::: {.cell}

```{.r .cell-code}
table4a
#> # A tibble: 3 × 3
#>   country     `1999` `2000`
#>   <chr>        <dbl>  <dbl>
#> 1 Afghanistan    745   2666
#> 2 Brazil       37737  80488
#> 3 China       212258 213766
```

```{.r .cell-code}
table1
#> # A tibble: 6 × 4
#>   country      year  cases population
#>   <chr>       <dbl>  <dbl>      <dbl>
#> 1 Afghanistan  1999    745   19987071
#> 2 Afghanistan  2000   2666   20595360
#> 3 Brazil       1999  37737  172006362
#> 4 Brazil       2000  80488  174504898
#> 5 China        1999 212258 1272915272
#> 6 China        2000 213766 1280428583
```
:::
- But comparing `table1` and `table2`: `table1` is wide and `table2` is long
::: {.cell}

```{.r .cell-code}
table1
#> # A tibble: 6 × 4
#>   country      year  cases population
#>   <chr>       <dbl>  <dbl>      <dbl>
#> 1 Afghanistan  1999    745   19987071
#> 2 Afghanistan  2000   2666   20595360
#> 3 Brazil       1999  37737  172006362
#> 4 Brazil       2000  80488  174504898
#> 5 China        1999 212258 1272915272
#> 6 China        2000 213766 1280428583
```

```{.r .cell-code}
table2
#> # A tibble: 12 × 4
#>    country      year type            count
#>    <chr>       <dbl> <chr>           <dbl>
#>  1 Afghanistan  1999 cases             745
#>  2 Afghanistan  1999 population   19987071
#>  3 Afghanistan  2000 cases            2666
#>  4 Afghanistan  2000 population   20595360
#>  5 Brazil       1999 cases           37737
#>  6 Brazil       1999 population  172006362
#>  7 Brazil       2000 cases           80488
#>  8 Brazil       2000 population  174504898
#>  9 China        1999 cases          212258
#> 10 China        1999 population 1272915272
#> 11 China        2000 cases          213766
#> 12 China        2000 population 1280428583
```
:::


-->
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>